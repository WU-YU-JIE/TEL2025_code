{"path": "aim.py", "extension": ".py", "size_bytes": 3587, "modified_time": "2025-10-17 22:06:04", "sha256": "3db447343ca5f5710c28884c5920ddf3778c561cb2e9a6a6882912ddd1bd6ccd", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "# aim.py\n# å³æ–æ¡¿æ¡ã€Œå¾®èª¿ã€ï¼ˆç›¸å°ä½ç§»ï¼‰ï¼Œéçµ•å°è§’åº¦ï¼š\n#   æ¯å¹€ Î”è§’åº¦ = stick * SENS_DEG_PER_S * Î”tï¼›å¤¾é™åˆ° [min,max]\n#   é€å‡º \"1,<xdeg>\" / \"2,<ydeg>\"\nfrom __future__ import annotations\nfrom typing import Optional, TYPE_CHECKING, Tuple\nimport time\n\ntry:\n    import serial as pyserial\nexcept Exception:\n    pyserial = None  # type: ignore[assignment]\n\nif TYPE_CHECKING:\n    from serial import Serial as SerialT\nelse:\n    class SerialT: pass\n\ndef _clamp(x, a, b): return a if x < a else b if x > b else x\n\n\nclass Aimer:\n    def __init__(self, port=\"COM18\", baud=115200, send_interval_ms=80, verbose=True,\n                 x_min_deg=-30.0, x_max_deg=+30.0, y_min_deg=+10.0, y_max_deg=+80.0,\n                 x_sens_deg_s=60.0, y_sens_deg_s=60.0):\n        self.port, self.baud, self.verbose = port, baud, verbose\n        self._ser: Optional[SerialT] = None\n        self._interval = send_interval_ms / 1000.0\n        self._last_send = 0.0\n        self._x_rng = (float(x_min_deg), float(x_max_deg))\n        self._y_rng = (float(y_min_deg), float(y_max_deg))\n        self._x = (x_min_deg + x_max_deg) / 2.0\n        self._y = (y_min_deg + y_max_deg) / 2.0\n        self._last_xy: Tuple[float, float] = (9999, 9999)\n        self._sx = float(x_sens_deg_s)\n        self._sy = float(y_sens_deg_s)\n        self._connect()\n\n    # ---- serial ----\n    def _connect(self):\n        if pyserial is None:\n            if self.verbose: print(\"[AIM] pyserial æœªå®‰è£ï¼Œdryrun\")\n            return\n        try:\n            self._ser = pyserial.Serial(self.port, self.baud, timeout=0.02)\n            if self.verbose: print(f\"[AIM] OPEN {self.port} @ {self.baud}\")\n            time.sleep(1.5)\n        except Exception as e:\n            self._ser = None\n            if self.verbose: print(f\"[AIM] é–‹å•Ÿå¤±æ•—ï¼š{e}ï¼ˆdryrunï¼‰\")\n\n    def _send_line(self, s: str):\n        if not s.endswith(\"\\n\"): s += \"\\n\"\n        if self._ser:\n            try: self._ser.write(s.encode(\"utf-8\"))\n            except Exception as e:\n                if self.verbose: print(f\"[AIM] å¯«å…¥å¤±æ•—ï¼š{e}\")\n        else:\n            if self.verbose: print(f\"[AIM] (drysend) {s.strip()}\")\n\n    # ---- ç›¸å°å¾®èª¿ ----\n    def nudge_from_stick(self, rx: float, ry: float, dt: float):\n        \"\"\"rx, ry âˆˆ [-1,1]ï¼›dt ç§’ï¼›ä¸Šæ¨ç‚ºæ­£ â†’ y å–åè™Ÿ\"\"\"\n        if dt <= 0: return\n        dx = float(rx) * self._sx * dt\n        dy = float(-ry) * self._sy * dt\n        self._x = _clamp(self._x + dx, *self._x_rng)\n        self._y = _clamp(self._y + dy, *self._y_rng)\n        self._maybe_send()\n\n    def _maybe_send(self):\n        now = time.time()\n        if now - self._last_send < self._interval:\n            return\n        cur = (round(self._x, 3), round(self._y, 3))\n        if cur == self._last_xy:\n            return\n        self._last_send = now\n        self._last_xy = cur\n        self._send_line(f\"1,{cur[0]:.3f}\")\n        self._send_line(f\"2,{cur[1]:.3f}\")\n\n    # å¯é¸ï¼šç½®ä¸­ / ç›´æ¥è¨­è§’åº¦\n    def home_center(self):\n        self._x = sum(self._x_rng) * 0.5\n        self._y = sum(self._y_rng) * 0.5\n        self._maybe_send()\n\n    def set_xy_deg(self, x_deg: float, y_deg: float):\n        self._x = _clamp(float(x_deg), *self._x_rng)\n        self._y = _clamp(float(y_deg), *self._y_rng)\n        self._maybe_send()\n\n    def close(self):\n        if self._ser:\n            try: self._ser.close()\n            finally: self._ser = None\n            if self.verbose: print(\"[AIM] CLOSED\")\n    "}
{"path": "ALL_TEXTS.txt", "extension": ".txt", "size_bytes": 0, "modified_time": "2025-10-18 21:23:57", "sha256": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855", "is_text": true, "encoding": "utf-8", "truncated": false, "content": ""}
{"path": "files_content.jsonl", "extension": ".jsonl", "size_bytes": 0, "modified_time": "2025-10-18 21:23:57", "sha256": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855", "is_text": true, "encoding": "utf-8", "truncated": false, "content": ""}
{"path": "files_report.csv", "extension": ".csv", "size_bytes": 0, "modified_time": "2025-10-18 21:23:57", "sha256": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855", "is_text": true, "encoding": "utf-8", "truncated": false, "content": ""}
{"path": "files_tree.txt", "extension": ".txt", "size_bytes": 347, "modified_time": "2025-10-17 21:16:44", "sha256": "623e3fb2f26f1bb64b3ff4ff748184bac7e310b8fa65eee13880bd93708b3df7", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "TEL2025_MainCode\nâ””â”€ ALL_TEXTS.txt\nâ””â”€ XboxGUI_V1.ui\nâ””â”€ XboxGUI_V2.ui\nâ””â”€ aim.py\nâ””â”€ files_content.jsonl\nâ””â”€ files_report.csv\nâ””â”€ files_tree.txt\nâ””â”€ main.py\nâ””â”€ mega1_controller.py\nâ””â”€ scan_folder.py\nâ””â”€ xboxGUI.py\nâ””â”€ aim\n    â””â”€ aim.ino\nâ””â”€ chassis_shooter\n    â””â”€ chassis_shooter.ino"}
{"path": "main.py", "extension": ".py", "size_bytes": 2271, "modified_time": "2025-10-17 22:25:17", "sha256": "c763fa1633ebe76736a742f1ed7f6000246ce594fcc76634e38f6035065cf0f3", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "# main.py\n# å°‡ xboxGUI çš„ 6 è»¸/6 éµäº‹ä»¶ â†’ MegaController / Aimer\n# è¦æ ¼ï¼š\n#   é€²æ–™=Rã€é€€æ–™=Fã€ä½é€Ÿ=-50ã€é«˜é€Ÿ=-100\n#   å‰å¾Œ=å·¦æ–æ¡¿ Yï¼ˆvxï¼‰ã€å·¦å³=å·¦æ–æ¡¿ Xï¼ˆvyï¼‰\n#   æ—‹è½‰=AXIS5(å³) - AXIS4(å·¦) â†’ [-100..100]\n#   BTN4(LB)=Aim_X lockã€BTN5(RB)=Aim_Y lockï¼ˆæŒ‰ä½é–å®šè©²è»¸ç‚º 0ï¼‰\n\nimport time\nimport xboxGUI\nfrom mega1_controller import MegaController\nfrom aim import Aimer\n\n# ===== é€£ç·šåƒæ•¸ =====\nMEGA_PORT = \"COM19\"\nAIM_PORT  = \"COM18\"\nBAUD      = 115200\n\n# æ¯”ä¾‹ï¼ˆå¯ä¾éœ€è¦èª¿æ•´ï¼‰\nSCALE_FWD  = 100.0  # å‰å¾Œç™¾åˆ†æ¯” = ly * SCALE_FWD\nSCALE_MOVE = 100.0  # å·¦å³ç™¾åˆ†æ¯” = lx * SCALE_MOVE\nSCALE_ROT  = 100.0  # è‡ªæ—‹ç™¾åˆ†æ¯” = (rot_r_pos - rot_l_pos) * SCALE_ROT\n\ndef _to_pos(v):  # è§¸ç™¼éµ [-1..+1] â†’ [0..1]\n    return (float(v) + 1.0) * 0.5\n\nmega  = MegaController(port=MEGA_PORT, baud=BAUD, send_interval_s=0.08, verbose=True)\naimer = Aimer(port=AIM_PORT,  baud=BAUD, send_interval_ms=80,  verbose=True)\n\naim_x_locked = False\naim_y_locked = False\n_last_t = time.monotonic()\n\ndef on_axis(lx, ly, rx, ry, rot_l, rot_r):\n    global _last_t\n    now = time.monotonic()\n    dt  = max(0.0, now - _last_t)\n    _last_t = now\n\n    # å‰å¾Œ & å·¦å³\n    mega.move_forward(int(-ly * SCALE_FWD))\n    mega.move_XY(int(lx * SCALE_MOVE))\n\n    # æ—‹è½‰ï¼ˆAXIS5 - AXIS4ï¼‰\n    rot_percent = int((_to_pos(rot_r) - _to_pos(rot_l)) * SCALE_ROT)\n    mega.rotate(rot_percent)\n\n    # Aimï¼šé–å®šæ™‚æŠŠå°æ‡‰è»¸è¦–ç‚º 0ï¼ˆä¸å¾®èª¿ï¼‰\n    rx_eff = 0.0 if aim_x_locked else rx\n    ry_eff = 0.0 if aim_y_locked else ry\n    aimer.nudge_from_stick(rx_eff, ry_eff, dt)\n\ndef on_buttons(a, b, x, y, lb, rb):\n    global aim_x_locked, aim_y_locked\n    # å°„æ‰‹ï¼ˆR/F/-50/-100ï¼‰\n    if b: mega.feed()        # R\n    if x: mega.reverse()     # F\n    if a: mega.set_neo(-50)\n    if y: mega.set_neo(-100)\n\n    # é–å®šï¼šæŒ‰ä½å³é–ï¼ˆé¬†é–‹å³è§£é™¤ï¼‰\n    aim_x_locked = bool(lb)  # BTN4\n    aim_y_locked = bool(rb)  # BTN5\n\ndef main():\n    try:\n        xboxGUI.run({\"on_axis\": on_axis, \"on_buttons\": on_buttons})\n    finally:\n        try: mega.close()\n        except: pass\n        try: aimer.close()\n        except: pass\n\nif __name__ == \"__main__\":\n    main()\n"}
{"path": "mega1_controller.py", "extension": ".py", "size_bytes": 4373, "modified_time": "2025-10-17 22:18:25", "sha256": "d899d7f3b0797841d9e6c18f029a9b88d8551ab7b35ae2e484107fbed8bf16c0", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "# mega1_controller.py\n# CHASSIS: é€±æœŸé€ \"vx,vy,wz\\n\"ï¼ˆvx/å‰å¾Œã€vy/å·¦å³ã€wz/è‡ªæ—‹ï¼‰\n# SHOOTER: \"R\"/\"F\"/æ•´æ•¸ -100..100\nfrom __future__ import annotations\nimport threading, time\nfrom typing import Optional, TYPE_CHECKING\n\ntry:\n    import serial as pyserial\nexcept Exception:\n    pyserial = None  # type: ignore[assignment]\n\nif TYPE_CHECKING:\n    from serial import Serial as SerialT\nelse:\n    class SerialT: pass\n\n\nclass MegaController:\n    MODE_CHASSIS = \"CHASSIS\"\n    MODE_SHOOTER = \"SHOOTER\"\n\n    def __init__(self, port=\"COM19\", baud=115200, send_interval_s=0.08, verbose=True):\n        self.port, self.baud, self.verbose = port, baud, verbose\n        self._ser: Optional[SerialT] = None\n        self._vx = 0.0; self._vy = 0.0; self._wz = 0.0\n        self._interval = max(0.01, float(send_interval_s))\n        self._mode = self.MODE_CHASSIS\n        self._stop = threading.Event()\n        self._lock = threading.Lock()\n        self._connect()\n        self._start_tx_loop()\n\n    # ---- serial ----\n    def _connect(self):\n        if pyserial is None:\n            if self.verbose: print(\"[Mega] pyserial æœªå®‰è£ï¼Œdryrun\")\n            return\n        try:\n            self._ser = pyserial.Serial(self.port, self.baud, timeout=0.0, write_timeout=0.0)\n            if self.verbose: print(f\"[Mega] OPEN {self.port} @ {self.baud}\")\n            time.sleep(1.5)\n            self._send_line(f\"MODE {self._mode}\")\n        except Exception as e:\n            self._ser = None\n            if self.verbose: print(f\"[Mega] é–‹å•Ÿå¤±æ•—ï¼š{e}ï¼ˆdryrunï¼‰\")\n\n    def _close(self):\n        if self._ser:\n            try: self._ser.close()\n            finally: self._ser = None\n            if self.verbose: print(\"[Mega] CLOSED\")\n\n    def _send_line(self, s: str):\n        if not s.endswith(\"\\n\"): s += \"\\n\"\n        if self._ser:\n            try: self._ser.write(s.encode(\"ascii\"))\n            except Exception as e:\n                if self.verbose: print(f\"[Mega] å¯«å…¥å¤±æ•—ï¼š{e}\")\n        else:\n            if self.verbose: print(f\"[Mega] (drysend) {s.strip()}\")\n\n    # ---- èƒŒæ™¯å»£æ’­ï¼ˆåƒ… CHASSISï¼‰----\n    def _start_tx_loop(self):\n        def loop():\n            next_t = 0.0\n            while not self._stop.is_set():\n                now = time.monotonic()\n                if now >= next_t:\n                    with self._lock:\n                        mode, vx, vy, wz = self._mode, self._vx, self._vy, self._wz\n                    if mode == self.MODE_CHASSIS:\n                        self._send_line(f\"{vx:.2f},{vy:.2f},{wz:.2f}\")\n                    next_t = now + self._interval\n                time.sleep(0.002)\n        threading.Thread(target=loop, daemon=True).start()\n\n    # ---- å…¬é–‹ API ----\n    def move_forward(self, percent: int):\n        \"\"\"å‰å¾Œï¼ˆ-100..100 â†’ vx -1..1ï¼‰\"\"\"\n        p = max(-100, min(100, int(percent)))\n        with self._lock:\n            self._vx = p / 100.0\n        if abs(p) > 0: self.set_mode(self.MODE_CHASSIS)\n\n    def move_XY(self, percent: int):\n        \"\"\"å·¦å³ï¼ˆ-100..100 â†’ vy -1..1ï¼‰\"\"\"\n        p = max(-100, min(100, int(percent)))\n        with self._lock:\n            self._vy = p / 100.0\n        if abs(p) > 0: self.set_mode(self.MODE_CHASSIS)\n    move_xy = move_XY  # åˆ¥å\n\n    def rotate(self, percent: int):\n        \"\"\"è‡ªæ—‹ï¼ˆ-100..100 â†’ wz -1..1ï¼‰\"\"\"\n        p = max(-100, min(100, int(percent)))\n        with self._lock:\n            self._wz = p / 100.0\n        if abs(p) > 0: self.set_mode(self.MODE_CHASSIS)\n\n    # å°„æ‰‹ç«¯\n    def feed(self):       # 'R'\n        self.set_mode(self.MODE_SHOOTER)\n        self._send_line(\"R\")\n\n    def reverse(self):    # 'F'\n        self.set_mode(self.MODE_SHOOTER)\n        self._send_line(\"F\")\n\n    def set_neo(self, speed: int):  # -100..100\n        v = int(max(-100, min(100, speed)))\n        self.set_mode(self.MODE_SHOOTER)\n        self._send_line(str(v))\n\n    def set_mode(self, mode: str):\n        if mode not in (self.MODE_CHASSIS, self.MODE_SHOOTER): return\n        with self._lock:\n            if mode == self._mode: return\n            self._mode = mode\n        self._send_line(f\"MODE {mode}\")\n        time.sleep(0.2)  # åˆ‡æ¨¡å¼ä¿éšªç·©è¡\n\n    def close(self):\n        self._stop.set(); time.sleep(0.05); self._close()\n"}
{"path": "scan_folder.py", "extension": ".py", "size_bytes": 8729, "modified_time": "2025-10-17 20:01:49", "sha256": "51c9239d09651ed92a43be09f9cbd14a76b6c69c00b30187ef9bca8cd7d8bb15", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "# scan_folder.py\n# -*- coding: utf-8 -*-\nimport os, sys, csv, time, json, base64, hashlib\nfrom collections import defaultdict\n\nDEFAULT_TARGET = r\"C:\\Users\\user\\OneDrive - ä¸­åŸå¤§å­¸\\æ¡Œé¢\\å¤§å­¸ä½œå“é›†\\æ±äº¬å¨åŠ›\\TEL2025_MainCode\"\n\n# ç•¥éçš„è³‡æ–™å¤¾\nSKIP_DIRS = {\n    \".git\",\"__pycache__\",\"node_modules\",\".venv\",\"venv\",\"env\",\n    \"build\",\"dist\",\".idea\",\".vscode\",\".pytest_cache\",\".mypy_cache\",\".cache\"\n}\n\n# ç•¶ä½œæ–‡å­—æª”è™•ç†ï¼ˆå°å¯«å‰¯æª”åï¼‰\nTEXT_EXTS = {\n    \".py\",\".c\",\".cpp\",\".h\",\".hpp\",\".java\",\".js\",\".ts\",\".sh\",\".bat\",\".ps1\",\".ino\",\n    \".go\",\".rb\",\".php\",\".swift\",\".kt\",\".m\",\".cs\",\".json\",\".yml\",\".yaml\",\".toml\",\n    \".ini\",\".md\",\".txt\",\".csv\",\".xml\",\".html\",\".css\"\n}\n\n# å…§å®¹è¼¸å‡ºæ§åˆ¶\nMAX_TEXT_BYTES = 512 * 1024      # å–®ä¸€æ–‡å­—æª”æœ€å¤šè®€ 512 KB å…§å®¹\nMAX_BINARY_BYTES = 0             # äºŒé€²ä½æª”æ˜¯å¦è¼¸å‡º base64ï¼ˆ0=ä¸è¼¸å‡ºï¼Œåªè¨˜éŒ„é›œæ¹Šèˆ‡ä¸­ç¹¼è³‡æ–™ï¼‰\nENCODING = \"utf-8\"               # æ–‡å­—è®€å–ç·¨ç¢¼ï¼ˆå¤±æ•—å‰‡ç”¨ errors='replace'ï¼‰\n\ndef is_probably_binary(path, ext) -> bool:\n    if ext.lower() in TEXT_EXTS:\n        return False\n    try:\n        with open(path, \"rb\") as f:\n            head = f.read(4096)\n        # æœ‰ NUL æˆ–å¤ªå¤šéå¯åˆ—å°æ§åˆ¶å­— â†’ è¦–ç‚ºäºŒé€²ä½\n        if b\"\\x00\" in head:\n            return True\n        nontext = sum(1 for b in head if b < 9 or (13 < b < 32) or b == 127)\n        return nontext / max(1, len(head)) > 0.30\n    except Exception:\n        return True\n\ndef human_size(n: int) -> str:\n    units = [\"B\",\"KB\",\"MB\",\"GB\",\"TB\"]\n    i, f = 0, float(n)\n    while f >= 1024 and i < len(units)-1:\n        f /= 1024; i += 1\n    return f\"{f:.2f} {units[i]}\"\n\ndef sha256_file(path: str) -> str:\n    h = hashlib.sha256()\n    with open(path, \"rb\") as f:\n        for chunk in iter(lambda: f.read(1024 * 1024), b\"\"):\n            h.update(chunk)\n    return h.hexdigest()\n\ndef gen_tree(root: str, skip_dirs=SKIP_DIRS, max_files_per_dir=200) -> str:\n    lines = []\n    root = os.path.abspath(root)\n    for current_root, dirs, files in os.walk(root):\n        rel = os.path.relpath(current_root, root)\n        depth = 0 if rel == \".\" else rel.count(os.sep) + 1\n        indent = \"    \" * depth\n        lines.append((os.path.basename(root) if rel == \".\" else f\"{'    '*(depth-1)}â””â”€ {os.path.basename(current_root)}\"))\n        dirs[:] = [d for d in dirs if d not in skip_dirs]\n        shown = 0\n        for name in sorted(files):\n            if shown >= max_files_per_dir:\n                lines.append(f\"{indent}â””â”€ ... ({len(files)-shown} more files)\")\n                break\n            lines.append(f\"{indent}â””â”€ {name}\")\n            shown += 1\n    return \"\\n\".join(lines)\n\ndef main():\n    target = sys.argv[1] if len(sys.argv) >= 2 else DEFAULT_TARGET\n    target = os.path.abspath(os.path.expanduser(target))\n    if not os.path.isdir(target):\n        print(f\"âŒ æ‰¾ä¸åˆ°è³‡æ–™å¤¾ï¼š{target}\")\n        sys.exit(1)\n\n    out_csv  = os.path.join(target, \"files_report.csv\")\n    out_tree = os.path.join(target, \"files_tree.txt\")\n    out_jsonl = os.path.join(target, \"files_content.jsonl\")\n    out_alltxt = os.path.join(target, \"ALL_TEXTS.txt\")\n\n    by_ext_count = defaultdict(int)\n    by_ext_size = defaultdict(int)\n    total_files = total_bytes = 0\n\n    # å…ˆå¯« CSVï¼ˆä¸­ç¹¼è³‡æ–™ï¼‰\n    with open(out_csv, \"w\", newline=\"\", encoding=\"utf-8-sig\") as fcsv, \\\n         open(out_jsonl, \"w\", encoding=\"utf-8\") as fjsonl, \\\n         open(out_alltxt, \"w\", encoding=\"utf-8\", errors=\"replace\") as falltxt:\n\n        writer = csv.writer(fcsv)\n        writer.writerow([\n            \"relative_path\", \"extension\", \"size_bytes\", \"size_human\",\n            \"modified_time\", \"is_text\", \"line_count\", \"sha256\"\n        ])\n\n        for root_dir, dirs, files in os.walk(target):\n            dirs[:] = [d for d in dirs if d not in SKIP_DIRS]\n            for fname in files:\n                fpath = os.path.join(root_dir, fname)\n                rel = os.path.relpath(fpath, target)\n                ext = os.path.splitext(fname)[1].lower()\n\n                try:\n                    stat = os.stat(fpath)\n                except OSError:\n                    continue\n\n                size = stat.st_size\n                mtime = time.strftime(\"%Y-%m-%d %H:%M:%S\", time.localtime(stat.st_mtime))\n                is_bin = is_probably_binary(fpath, ext)\n                sha256 = sha256_file(fpath)\n\n                line_count = \"\"\n                text_preview = \"\"\n                encoding_used = None\n\n                if not is_bin:\n                    # è®€éƒ¨åˆ†æ–‡å­—å…§å®¹ï¼ˆé™åˆ¶å¤§å°ï¼‰\n                    try:\n                        with open(fpath, \"r\", encoding=ENCODING, errors=\"replace\") as fr:\n                            content = fr.read(min(MAX_TEXT_BYTES, size))\n                            encoding_used = ENCODING\n                            text_preview = content\n                            line_count = content.count(\"\\n\") + (1 if content and not content.endswith(\"\\n\") else 0)\n                    except Exception:\n                        pass\n\n                    # å¯«å…¥ ALL_TEXTS åŒ¯ç¸½\n                    falltxt.write(\"\\n\" + \"=\"*80 + \"\\n\")\n                    falltxt.write(f\"FILE: {rel}\\n\")\n                    falltxt.write(\"=\"*80 + \"\\n\")\n                    if text_preview:\n                        falltxt.write(text_preview)\n                        if size > MAX_TEXT_BYTES:\n                            falltxt.write(\"\\n[... TRUNCATED ...]\\n\")\n                    else:\n                        falltxt.write(\"[[EMPTY OR UNREADABLE TEXT]]\\n\")\n\n                    # JSONLï¼šæ–‡å­—\n                    json.dump({\n                        \"path\": rel,\n                        \"extension\": ext or \"(noext)\",\n                        \"size_bytes\": size,\n                        \"modified_time\": mtime,\n                        \"sha256\": sha256,\n                        \"is_text\": True,\n                        \"encoding\": encoding_used or \"utf-8\",\n                        \"truncated\": bool(size > MAX_TEXT_BYTES),\n                        \"content\": text_preview\n                    }, fjsonl, ensure_ascii=False)\n                    fjsonl.write(\"\\n\")\n\n                else:\n                    # JSONLï¼šäºŒé€²ä½ï¼ˆé è¨­ä¸å«å…§å®¹ï¼Œåªè¨˜é›œæ¹Šèˆ‡ä¸­ç¹¼è³‡æ–™ï¼›éœ€è¦å¯æ”¹ MAX_BINARY_BYTESï¼‰\n                    b64 = None\n                    if MAX_BINARY_BYTES > 0:\n                        try:\n                            with open(fpath, \"rb\") as fb:\n                                raw = fb.read(min(MAX_BINARY_BYTES, size))\n                            b64 = base64.b64encode(raw).decode(\"ascii\")\n                        except Exception:\n                            b64 = None\n\n                    json.dump({\n                        \"path\": rel,\n                        \"extension\": ext or \"(noext)\",\n                        \"size_bytes\": size,\n                        \"modified_time\": mtime,\n                        \"sha256\": sha256,\n                        \"is_text\": False,\n                        \"base64_bytes\": b64,\n                        \"truncated\": bool(size > MAX_BINARY_BYTES) if MAX_BINARY_BYTES > 0 else None\n                    }, fjsonl)\n                    fjsonl.write(\"\\n\")\n\n                # CSVï¼ˆä¸­ç¹¼è³‡æ–™ä¸€è¦½ï¼‰\n                writer.writerow([\n                    rel, ext or \"(noext)\", size, human_size(size), mtime,\n                    int(not is_bin), line_count, sha256\n                ])\n\n                by_ext_count[ext] += 1\n                by_ext_size[ext] += size\n                total_files += 1\n                total_bytes += size\n\n    # ç”¢ç”Ÿæ¨¹ç‹€\n    with open(out_tree, \"w\", encoding=\"utf-8\") as ftree:\n        ftree.write(gen_tree(target))\n\n    # æ‘˜è¦\n    print(\"ğŸ“ æƒæå®Œæˆï¼š\", target)\n    print(f\"   æª”æ¡ˆç¸½æ•¸ï¼š{total_files}\")\n    print(f\"   ç¸½å¤§å°  ï¼š{human_size(total_bytes)}\")\n    print(\"   ä¾å‰¯æª”åçµ±è¨ˆï¼ˆå‰ 15 åï¼‰ï¼š\")\n    top = sorted(by_ext_count.items(), key=lambda kv: by_ext_size[kv[0]], reverse=True)[:15]\n    for ext, cnt in top:\n        print(f\"   {ext or '(noext)':>8}  {cnt:>6} æª”  {human_size(by_ext_size[ext]):>10}\")\n\n    print(f\"\\nâœ… å·²è¼¸å‡ºï¼š\\n  - {out_csv}\\n  - {out_tree}\\n  - {out_jsonl}\\n  - {out_alltxt}\")\n    print(\"\\nâš™ï¸ åƒæ•¸ï¼šMAX_TEXT_BYTES={}, MAX_BINARY_BYTES={}ï¼ˆå¯åœ¨æª”é ­èª¿æ•´ï¼‰\".format(MAX_TEXT_BYTES, MAX_BINARY_BYTES))\n    print(\"ğŸ’¡ JSONL å¯è¢« jq / pandas / BigQuery / Elasticsearch ç­‰ç›´æ¥ä½¿ç”¨ï¼›ALL_TEXTS.txt æ–¹ä¾¿äººå·¥æª¢è¦–ã€‚\")\n\nif __name__ == \"__main__\":\n    main()\n"}
{"path": "xboxGUI.py", "extension": ".py", "size_bytes": 2581, "modified_time": "2025-10-17 22:18:38", "sha256": "402b015d6eddd4c8ab764644e5ad395bb49df3513ead7a75ee08b360c9d62f36", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "# xboxGUI.py\n# å°å¤– APIï¼šrun(handlers)\n# handlers = {\n#   \"on_axis\":    callable(lx, ly, rx, ry, rot_l, rot_r),  # floats in [-1,1]\n#   \"on_buttons\": callable(a,b,x,y,lb,rb),                 # bools\n# }\n\nimport pygame\n\n# å¸¸è¦‹ XInput æ˜ å°„ï¼ˆå¦‚èˆ‡ä½ æ‰‹æŠŠä¸åŒå¯åœ¨æ­¤èª¿æ•´ï¼‰\nAX_LX, AX_LY, AX_RX, AX_RY, AX_ROT_L, AX_ROT_R = 0, 1, 2, 3, 4, 5\nBTN_A, BTN_B, BTN_X, BTN_Y, BTN_LB, BTN_RB = 0, 1, 2, 3, 4, 5\n\ndef _dead(v, dz=0.15):\n    return 0.0 if abs(v) < dz else float(v)\n\ndef run(handlers: dict, fps: int = 120):\n    on_axis = handlers.get(\"on_axis\")\n    on_btn  = handlers.get(\"on_buttons\")\n\n    pygame.init()\n    pygame.joystick.init()\n\n    js = None\n    if pygame.joystick.get_count() > 0:\n        js = pygame.joystick.Joystick(0); js.init()\n        print(f\"[xboxGUI] Joystick: {js.get_name()}\")\n    else:\n        print(\"[xboxGUI] æ‰¾ä¸åˆ°æ–æ¡¿ï¼Œä»å•Ÿå‹•è¿´åœˆï¼ˆå›å‚³å…¨ 0ï¼‰ã€‚\")\n\n    clock = pygame.time.Clock()\n    a = b = x = y = lb = rb = False\n\n    while True:\n        for e in pygame.event.get():\n            if e.type == pygame.QUIT:\n                return\n            if e.type == pygame.JOYBUTTONDOWN:\n                if e.button == BTN_A: a = True\n                elif e.button == BTN_B: b = True\n                elif e.button == BTN_X: x = True\n                elif e.button == BTN_Y: y = True\n                elif e.button == BTN_LB: lb = True\n                elif e.button == BTN_RB: rb = True\n            if e.type == pygame.JOYBUTTONUP:\n                if e.button == BTN_A: a = False\n                elif e.button == BTN_B: b = False\n                elif e.button == BTN_X: x = False\n                elif e.button == BTN_Y: y = False\n                elif e.button == BTN_LB: lb = False\n                elif e.button == BTN_RB: rb = False\n\n        if js:\n            lx     = _dead(js.get_axis(AX_LX))\n            ly     = _dead(js.get_axis(AX_LY))\n            rx     = _dead(js.get_axis(AX_RX))\n            ry     = _dead(js.get_axis(AX_RY))\n            rot_l  = float(js.get_axis(AX_ROT_L))  # å¤šæ•¸è§¸ç™¼éµï¼šé¬†é–‹â‰ˆ-1ã€å£“åˆ°åº•â‰ˆ+1\n            rot_r  = float(js.get_axis(AX_ROT_R))\n        else:\n            lx = ly = rx = ry = rot_l = rot_r = 0.0\n\n        if on_axis:\n            try: on_axis(lx, ly, rx, ry, rot_l, rot_r)\n            except Exception as e: print(f\"[xboxGUI] on_axis error: {e}\")\n        if on_btn:\n            try: on_btn(a, b, x, y, lb, rb)\n            except Exception as e: print(f\"[xboxGUI] on_buttons error: {e}\")\n\n        clock.tick(fps)\n"}
{"path": "XboxGUI_V1.ui", "extension": ".ui", "size_bytes": 7033, "modified_time": "2025-10-17 16:28:46", "sha256": "c9d4ce43947f17b3b79866116d178e127666698723d5b705dc37e2cb72d1b32d", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<ui version=\"4.0\">\n <class>Form</class>\n <widget class=\"QWidget\" name=\"Form\">\n  <property name=\"geometry\">\n   <rect>\n    <x>0</x>\n    <y>0</y>\n    <width>999</width>\n    <height>575</height>\n   </rect>\n  </property>\n  <property name=\"windowTitle\">\n   <string>Form</string>\n  </property>\n  <widget class=\"QSlider\" name=\"Move_X\">\n   <property name=\"geometry\">\n    <rect>\n     <x>80</x>\n     <y>420</y>\n     <width>160</width>\n     <height>22</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Horizontal</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Move_Y\">\n   <property name=\"geometry\">\n    <rect>\n     <x>150</x>\n     <y>350</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Left_rotation\">\n   <property name=\"geometry\">\n    <rect>\n     <x>150</x>\n     <y>70</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Right_rotation\">\n   <property name=\"geometry\">\n    <rect>\n     <x>440</x>\n     <y>70</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton\">\n   <property name=\"geometry\">\n    <rect>\n     <x>110</x>\n     <y>240</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Aim_X lock</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_2\">\n   <property name=\"geometry\">\n    <rect>\n     <x>410</x>\n     <y>240</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Aim_Y lock</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label\">\n   <property name=\"geometry\">\n    <rect>\n     <x>120</x>\n     <y>50</y>\n     <width>71</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Left rotation</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_2\">\n   <property name=\"geometry\">\n    <rect>\n     <x>410</x>\n     <y>50</y>\n     <width>81</width>\n     <height>20</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Right rotation</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_3\">\n   <property name=\"geometry\">\n    <rect>\n     <x>130</x>\n     <y>520</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Move_Y</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_4\">\n   <property name=\"geometry\">\n    <rect>\n     <x>20</x>\n     <y>420</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Move_X</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_5\">\n   <property name=\"geometry\">\n    <rect>\n     <x>420</x>\n     <y>520</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Aim_Y</string>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Aim_X\">\n   <property name=\"geometry\">\n    <rect>\n     <x>370</x>\n     <y>420</y>\n     <width>160</width>\n     <height>22</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Horizontal</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Aim_Y\">\n   <property name=\"geometry\">\n    <rect>\n     <x>440</x>\n     <y>350</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_6\">\n   <property name=\"geometry\">\n    <rect>\n     <x>310</x>\n     <y>420</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Aim_X</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_3\">\n   <property name=\"geometry\">\n    <rect>\n     <x>610</x>\n     <y>160</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"mouseTracking\">\n    <bool>false</bool>\n   </property>\n   <property name=\"text\">\n    <string>ä½è½‰é€Ÿ</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_4\">\n   <property name=\"geometry\">\n    <rect>\n     <x>840</x>\n     <y>160</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>é«˜è½‰é€Ÿ</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_5\">\n   <property name=\"geometry\">\n    <rect>\n     <x>730</x>\n     <y>250</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>åæ–™</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_6\">\n   <property name=\"geometry\">\n    <rect>\n     <x>730</x>\n     <y>70</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>é€²æ–™</string>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Left_rotation_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>200</x>\n     <y>50</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Right_rotation_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>490</x>\n     <y>50</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Move_X_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>10</x>\n     <y>440</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Move_Y_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>190</x>\n     <y>520</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Aim_X_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>300</x>\n     <y>440</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Aim_Y_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>470</x>\n     <y>520</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n </widget>\n <resources/>\n <connections/>\n</ui>\n"}
{"path": "XboxGUI_V2.ui", "extension": ".ui", "size_bytes": 13635, "modified_time": "2025-10-18 21:16:59", "sha256": "3e2d91a3c8aecf783b4fe3519a28cfc964e3b0a222768d1cc86531b80e5e4ef0", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<ui version=\"4.0\">\n <class>Form</class>\n <widget class=\"QWidget\" name=\"Form\">\n  <property name=\"geometry\">\n   <rect>\n    <x>0</x>\n    <y>0</y>\n    <width>953</width>\n    <height>560</height>\n   </rect>\n  </property>\n  <property name=\"windowTitle\">\n   <string>Xbox Controller GUI</string>\n  </property>\n  <property name=\"styleSheet\">\n   <string>/* ===== ä¸»èƒŒæ™¯ ===== */\nQWidget {\n    background: qlineargradient(x1:0, y1:0, x2:1, y2:1, stop:0 #212d7aff, stop:0.5 #000001, stop:1 #000000);\n}\n\n/* ===== æ°´å¹³æ»‘æ¡¿ ===== */\nQSlider::groove:horizontal {\n    border: 1px solid #ffffffff;\n    height: 10px;\n    background: #0a0a0a;\n    border-radius: 5px;\n}\nQSlider::handle:horizontal {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #16d946, stop:1 #0aa62c);\n    border: 2px solid #ffffffff;\n    width: 18px;\n    margin: -5px 0;\n    border-radius: 9px;\n}\nQSlider::handle:horizontal:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #2dc759, stop:1 #16d946);\n    border: 2px solid #16d946;\n}\n\n/* ===== å‚ç›´æ»‘æ¡¿ ===== */\nQSlider::groove:vertical {\n    border: 1px solid #ffffffff;\n    width: 10px;\n    background: #0a0a0a;\n    border-radius: 5px;\n}\nQSlider::handle:vertical {\n    background: qlineargradient(x1:0, y1:0, x2:1, y2:0, stop:0 #16d946, stop:1 #0aa62c);\n    border: 2px solid #ffffffff;\n    height: 18px;\n    margin: 0 -5px;\n    border-radius: 9px;\n}\nQSlider::handle:vertical:hover {\n    background: qlineargradient(x1:0, y1:0, x2:1, y2:0, stop:0 #2dc759, stop:1 #16d946);\n    border: 2px solid #16d946;\n}\n\n/* ===== æ¨™ç±¤ ===== */\nQLabel {\n    color: #16d946;\n    font-weight: bold;\n    font-size: 11px;\n}\n\n/* ===== LCD æ•¸å­—é¡¯ç¤º ===== */\nQLCDNumber {\n    background: #0a0a0a;\n    color: #16d946;\n    border: 2px solid #ffffffff;\n    border-radius: 4px;\n    font-weight: bold;\n}</string>\n  </property>\n  <widget class=\"QSlider\" name=\"Move_X\">\n   <property name=\"geometry\">\n    <rect>\n     <x>80</x>\n     <y>420</y>\n     <width>160</width>\n     <height>22</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Orientation::Horizontal</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Move_Y\">\n   <property name=\"geometry\">\n    <rect>\n     <x>150</x>\n     <y>350</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Orientation::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Left_rotation\">\n   <property name=\"geometry\">\n    <rect>\n     <x>150</x>\n     <y>70</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Orientation::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Right_rotation\">\n   <property name=\"geometry\">\n    <rect>\n     <x>440</x>\n     <y>70</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Orientation::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton\">\n   <property name=\"geometry\">\n    <rect>\n     <x>100</x>\n     <y>240</y>\n     <width>131</width>\n     <height>41</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>12</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"styleSheet\">\n    <string>/* Aim_X lock - ç´…è‰²ç³» */\nQPushButton {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #f69797ff, stop:1 #e81828);\n    border: 2px solid #ff4444;\n    color: #ffffff;\n    border-radius: 6px;\n    font-weight: bold;\n}\nQPushButton:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #ff7777, stop:1 #f69797ff);\n    border: 2px solid #ffaaaa;\n}\nQPushButton:pressed {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #c40c0c, stop:1 #a00808);\n    border: 2px solid #ff0000;\n}</string>\n   </property>\n   <property name=\"text\">\n    <string>Aim_X lock</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_2\">\n   <property name=\"geometry\">\n    <rect>\n     <x>380</x>\n     <y>240</y>\n     <width>141</width>\n     <height>41</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>12</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"styleSheet\">\n    <string>/* Aim_Y lock - ç´…è‰²ç³» */\nQPushButton {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #f69797ff, stop:1 #e81828);\n    border: 2px solid #ff4444;\n    color: #ffffff;\n    border-radius: 6px;\n    font-weight: bold;\n}\nQPushButton:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #ff7777, stop:1 #f69797ff);\n    border: 2px solid #ffaaaa;\n}\nQPushButton:pressed {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #c40c0c, stop:1 #a00808);\n    border: 2px solid #ff0000;\n}</string>\n   </property>\n   <property name=\"text\">\n    <string>Aim_Y lock</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label\">\n   <property name=\"geometry\">\n    <rect>\n     <x>120</x>\n     <y>50</y>\n     <width>71</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>-1</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"text\">\n    <string>Left rotation</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_2\">\n   <property name=\"geometry\">\n    <rect>\n     <x>410</x>\n     <y>50</y>\n     <width>81</width>\n     <height>20</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>-1</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"text\">\n    <string>Right rotation</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_3\">\n   <property name=\"geometry\">\n    <rect>\n     <x>130</x>\n     <y>520</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>-1</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"text\">\n    <string>Move_Y</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_4\">\n   <property name=\"geometry\">\n    <rect>\n     <x>20</x>\n     <y>420</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>-1</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"text\">\n    <string>Move_X</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_5\">\n   <property name=\"geometry\">\n    <rect>\n     <x>420</x>\n     <y>520</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>-1</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"text\">\n    <string>Aim_Y</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_6\">\n   <property name=\"geometry\">\n    <rect>\n     <x>310</x>\n     <y>420</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>-1</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"text\">\n    <string>Aim_X</string>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Aim_X\">\n   <property name=\"geometry\">\n    <rect>\n     <x>370</x>\n     <y>420</y>\n     <width>160</width>\n     <height>22</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Orientation::Horizontal</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Aim_Y\">\n   <property name=\"geometry\">\n    <rect>\n     <x>440</x>\n     <y>350</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Orientation::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_3\">\n   <property name=\"geometry\">\n    <rect>\n     <x>610</x>\n     <y>160</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>æ¨™æ¥·é«”</family>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"mouseTracking\">\n    <bool>true</bool>\n   </property>\n   <property name=\"styleSheet\">\n    <string>/* ä½è½‰é€Ÿ - ç¶ è‰²ç³»ï¼ˆè£œçµ¦é¡ï¼‰ */\nQPushButton {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #22dd55, stop:1 #16d946);\n    border: 2px solid #16d946;\n    color: #ffffff;\n    border-radius: 6px;\n    font-weight: bold;\n}\nQPushButton:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #2dc759, stop:1 #22dd55);\n    border: 2px solid #2dc759;\n}\nQPushButton:pressed {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #0d5a0d, stop:1 #0a450a);\n    border: 2px solid #ffffffff;\n}</string>\n   </property>\n   <property name=\"text\">\n    <string>ä½è½‰é€Ÿ</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_4\">\n   <property name=\"geometry\">\n    <rect>\n     <x>840</x>\n     <y>160</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>æ¨™æ¥·é«”</family>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"styleSheet\">\n    <string>/* é«˜è½‰é€Ÿ - é»ƒè‰²ç³»ï¼ˆå‹•åŠ›é¡ï¼‰ */\nQPushButton {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #ffee22, stop:1 #ffc400);\n    border: 2px solid #ffff00;\n    color: #000000;\n    border-radius: 6px;\n    font-weight: bold;\n}\nQPushButton:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #ffff44, stop:1 #ffee22);\n    border: 2px solid #ffff88;\n}\nQPushButton:pressed {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #ff9d00, stop:1 #ff8800);\n    border: 2px solid #ff6600;\n}</string>\n   </property>\n   <property name=\"text\">\n    <string>é«˜è½‰é€Ÿ</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_5\">\n   <property name=\"geometry\">\n    <rect>\n     <x>730</x>\n     <y>250</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>æ¨™æ¥·é«”</family>\n     <pointsize>10</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"styleSheet\">\n    <string>/* é€€å½ˆ - è—è‰²ç³»ï¼ˆç™¼å°„é¡ï¼‰ */\nQPushButton {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #0088ff, stop:1 #0066cc);\n    border: 2px solid #0066cc;\n    color: #ffffff;\n    border-radius: 6px;\n    font-weight: bold;\n}\nQPushButton:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #33aaff, stop:1 #0088ff);\n    border: 2px solid #33aaff;\n}\nQPushButton:pressed {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #000aa6, stop:1 #000578);\n    border: 2px solid #0033ff;\n}</string>\n   </property>\n   <property name=\"text\">\n    <string>é€€å½ˆ</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_6\">\n   <property name=\"geometry\">\n    <rect>\n     <x>730</x>\n     <y>70</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>æ¨™æ¥·é«”</family>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"styleSheet\">\n    <string>/* é€²å½ˆ - è—ç¶ è‰²ç³»ï¼ˆæç¤ºä¸åŒåŠŸèƒ½ï¼‰ */\nQPushButton {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #00dd99, stop:1 #00b388);\n    border: 2px solid #00cc88;\n    color: #ffffff;\n    border-radius: 6px;\n    font-weight: bold;\n}\nQPushButton:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #00ffaa, stop:1 #00dd99);\n    border: 2px solid #00ffaa;\n}\nQPushButton:pressed {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #008866, stop:1 #005544);\n    border: 2px solid #009977;\n}</string>\n   </property>\n   <property name=\"text\">\n    <string>é€²å½ˆ</string>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Left_rotation_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>200</x>\n     <y>50</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Right_rotation_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>490</x>\n     <y>50</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Move_X_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>10</x>\n     <y>440</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Move_Y_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>190</x>\n     <y>520</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Aim_X_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>300</x>\n     <y>440</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Aim_Y_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>470</x>\n     <y>520</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n </widget>\n <resources/>\n <connections/>\n</ui>\n"}
{"path": "aim\\aim.ino", "extension": ".ino", "size_bytes": 3006, "modified_time": "2025-10-11 16:32:04", "sha256": "77e2e2933d9fb065b980b3426ab6fca43a54d8f333472dcab54a759d4c454ec6", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "/*******************************************************\n * Arduinoï¼šé›™è»¸æ­¥é€²ï¼ˆåªæ”¯æ´ 1,è§’åº¦ / 2,è§’åº¦ï¼‰\n * M1: 42667 æ­¥/åœˆ\n * M2: 57600 æ­¥/åœˆ\n * ç¯„ä¾‹ï¼š1,45.0   æˆ–   2,90\n *******************************************************/\n#include <Arduino.h>\n\nstruct StepperAxis {\n  int PUL, DIR, ENA;\n  bool DIR_INVERT;        // true=åå‘ï¼ˆè‹¥æ–¹å‘é¡›å€’ï¼Œæ”¹é€™å€‹ï¼‰\n  bool ENA_ACTIVE_HIGH;   // true=HIGHç‚ºä½¿èƒ½\n  float currentAngle;     // ç›®å‰è§’åº¦(åº¦)\n  long stepsPerRev;       // æ¯åœˆæ­¥æ•¸(å«ç´°åˆ†/æ¸›é€Ÿ)\n  int speed_us;           // åŠè„ˆè¡å»¶é²(Î¼s)ï¼Œè¶Šå°è¶Šå¿«\n};\n\n// === è…³ä½ï¼ˆä¾ä½ å‰å…©ä»½ç¨‹å¼ï¼‰ ===\nconst int M1_PUL = 13, M1_DIR = 12, M1_ENA = 11;  // è»¸1\nconst int M2_PUL = 10, M2_DIR = 9,  M2_ENA = 8;   // è»¸2\n\n// === æ¯åœˆæ­¥æ•¸ï¼ˆå·²ä¾ä½ æä¾›è¨­å®šï¼‰ ===\nconst long M1_STEPS_PER_REV = 42667L;\nconst long M2_STEPS_PER_REV = 57600L;\n\n// === åƒæ•¸ ===\nStepperAxis m1 = { M1_PUL, M1_DIR, M1_ENA, true,  true, 0.0, M1_STEPS_PER_REV, 25 };\nStepperAxis m2 = { M2_PUL, M2_DIR, M2_ENA, true,  true, 0.0, M2_STEPS_PER_REV, 25 };\n\nstatic inline void holdEnable(const StepperAxis& ax, bool on) {\n  digitalWrite(ax.ENA, on ? (ax.ENA_ACTIVE_HIGH ? HIGH : LOW)\n                          : (ax.ENA_ACTIVE_HIGH ? LOW  : HIGH));\n}\n\nvoid setupAxis(const StepperAxis& ax) {\n  pinMode(ax.PUL, OUTPUT);\n  pinMode(ax.DIR, OUTPUT);\n  pinMode(ax.ENA, OUTPUT);\n  holdEnable(ax, true); // ä½¿èƒ½ä¿æŒé–ä½\n}\n\nvoid setup() {\n  Serial.begin(115200);\n  setupAxis(m1);\n  setupAxis(m2);\n  Serial.println(F(\"å°±ç·’ï¼šåªæ¥å— 1,è§’åº¦ æˆ– 2,è§’åº¦\"));\n  Serial.println(F(\"M1=42667 æ­¥/åœˆ, M2=57600 æ­¥/åœˆ\"));\n}\n\nvoid loop() {\n  if (!Serial.available()) return;\n  String cmd = Serial.readStringUntil('\\n');\n  cmd.trim();\n  if (!cmd.length()) return;\n\n  int comma = cmd.indexOf(',');\n  if (comma <= 0) {\n    Serial.println(F(\"âŒ æ ¼å¼éŒ¯èª¤ï¼šè«‹è¼¸å…¥ 1,è§’åº¦ æˆ– 2,è§’åº¦\"));\n    return;\n  }\n\n  int axisId = cmd.substring(0, comma).toInt();\n  float targetAngle = cmd.substring(comma + 1).toFloat();\n\n  if (axisId == 1) {\n    moveToAngle(m1, targetAngle);\n    Serial.println(F(\"M1 OK\"));\n  } else if (axisId == 2) {\n    moveToAngle(m2, targetAngle);\n    Serial.println(F(\"M2 OK\"));\n  } else {\n    Serial.println(F(\"âŒ é¦¬é”ç·¨è™Ÿåªæ¥å— 1 æˆ– 2\"));\n  }\n}\n\nvoid moveToAngle(StepperAxis& ax, float targetAngle) {\n  float diff = targetAngle - ax.currentAngle;\n  // è‡ªè¡Œå››æ¨äº”å…¥ä»¥é¿å… lround å¸¶ä¾†çš„é¡å¤–é«”ç©\n  long stepsToMove = (long)(fabs(diff) * ((double)ax.stepsPerRev / 360.0) + 0.5);\n  if (stepsToMove <= 0) { ax.currentAngle = targetAngle; return; }\n\n  bool dirLogical = (diff >= 0);\n  if (ax.DIR_INVERT) dirLogical = !dirLogical;\n  digitalWrite(ax.DIR, dirLogical ? HIGH : LOW);\n\n  holdEnable(ax, true); // ç¢ºä¿ä¿æŒ\n\n  for (long i = 0; i < stepsToMove; i++) {\n    digitalWrite(ax.PUL, HIGH);\n    delayMicroseconds(ax.speed_us);\n    digitalWrite(ax.PUL, LOW);\n    delayMicroseconds(ax.speed_us);\n  }\n  ax.currentAngle = targetAngle;\n}\n"}
{"path": "chassis_shooter\\chassis_shooter.ino", "extension": ".ino", "size_bytes": 12950, "modified_time": "2025-10-16 21:02:21", "sha256": "d2d3872e83eed4a61fe9b119252e77c80d7a9f294e285794cece208a9f95aa0e", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "// Mega_Mux_NoToken.ino\n// å–®ä¸€éŸŒé«”ï¼Œæ¿ä¸Šåˆ†æµå…©ç¨®æ¨¡å¼ä»¥é™ä½è² è·ï¼š\n//   æ¨¡å¼ CHASSISï¼šåªè·‘éº¥è¼ªåº•ç›¤ï¼ˆvx,vy,wzï¼‰\n//   æ¨¡å¼ SHOOTERï¼šåªè·‘ NEO + æ­¥é€²ï¼ˆæ•´æ•¸ -100..100, F/R/Sï¼‰\n//\n// ä¸²åˆ—æŒ‡ä»¤ (ç„¡ TOKENï¼›ç›¸å®¹èˆŠæœ‰ <11323310> å‰ç¶´æœƒè‡ªå‹•å‰é™¤) ï¼š\n//   MODE CHASSIS          åˆ‡æ›åˆ°åº•ç›¤æ¨¡å¼ï¼ˆä¸¦é—œé–‰ç™¼å°„æ¨¡çµ„ï¼‰\n//   MODE SHOOTER          åˆ‡æ›åˆ°ç™¼å°„æ¨¡å¼ï¼ˆä¸¦é—œé–‰åº•ç›¤ï¼‰\n//   STATUS                é¡¯ç¤ºç›®å‰æ¨¡å¼èˆ‡è©²æ¨¡å¼çš„ç‹€æ…‹\n//   STOP                  ä¾æ¨¡å¼åœç•¶å‰å­ç³»çµ±ï¼šCHASSIS åœè»Šï¼›SHOOTER åœæ­¥é€²+NEO=0\n//   vx,vy,wz              åƒ… CHASSIS æ¨¡å¼æœ‰æ•ˆ (ç¯„åœå»ºè­° -1..1)\n//   F / R / S             åƒ… SHOOTER æ¨¡å¼æœ‰æ•ˆï¼ˆæ­¥é€² å‰/å/åœ(æŠ±æ­»)ï¼‰\n//   -100..100             åƒ… SHOOTER æ¨¡å¼æœ‰æ•ˆï¼ˆNEO é€Ÿåº¦ï¼‰\n//\n// é™è² è·é‡é»ï¼š\n//  - åƒ…åœ¨ CHASSIS æ¨¡å¼åŸ·è¡Œ rampUpdateAndApply() èˆ‡åº•ç›¤ telemetry\n//  - åƒ…åœ¨ SHOOTER æ¨¡å¼åŸ·è¡Œ serviceStepper()ï¼ˆæ­¥é€²è„ˆè¡ï¼‰èˆ‡ NEO Servoï¼ˆattachï¼‰\n//  - åˆ‡åˆ° CHASSIS æœƒ detach Servoï¼ˆé‡‹æ”¾è¨ˆæ™‚å™¨ä¸­æ–·ï¼‰ï¼Œæ­¥é€² ENA=HIGHï¼ˆæŠ±æ­»ã€åœè„ˆè¡ï¼‰\n//  - åˆ‡åˆ° SHOOTER æœƒ stopAll() é—œé–‰æ‰€æœ‰åº•ç›¤ PWM\n//  - Telemetry åƒ…è¼¸å‡ºç•¶å‰æ¨¡å¼çš„å¿…è¦è³‡è¨Š\n\n#include <Arduino.h>\n#include <math.h>\n#include <Servo.h>\n\n// ================== æ¨¡å¼å®šç¾© ==================\nenum Mode { MODE_CHASSIS = 0, MODE_SHOOTER = 1 };\nvolatile Mode g_mode = MODE_CHASSIS;\n\n// ================== CHASSISï¼ˆéº¥è¼ªï¼‰ ==================\n// Pins (MEGA)\nconst uint8_t M1_PWM_A_PIN = 2;  // å‰å·¦ index 0\nconst uint8_t M1_PWM_B_PIN = 3;\nconst uint8_t M2_PWM_A_PIN = 4;  // å·¦å¾Œ index 1\nconst uint8_t M2_PWM_B_PIN = 5;\nconst uint8_t M3_PWM_A_PIN = 7;  // å³å‰ index 2\nconst uint8_t M3_PWM_B_PIN = 6;\nconst uint8_t M4_PWM_A_PIN = 8;  // å³å¾Œ index 3\nconst uint8_t M4_PWM_B_PIN = 9;\n\nconst int   MIN_PWM   = 80;\nconst int   MAX_PWM   = 255;\nconst float RAMP_STEP = 6.0;\nconst float DEAD_BAND = 0.02;\nconst float K_OMEGA   = 0.5;\n\nfloat currentPWMvals[4] = {0,0,0,0};\nfloat targetPWMvals[4]  = {0,0,0,0};\nbool  motorActive       = false;\n\n// ================== SHOOTERï¼ˆNEO + æ­¥é€²ï¼‰ ==================\nServo sparkMax;\nconst int SPARK_PWM_PIN = 13;     // NEO (Spark MAX) PWM\nbool servoAttached = false;\nint  neoSpeed = 0;                // -100..100ï¼ˆåƒ…ä½œç‹€æ…‹è¨˜éŒ„ï¼‰\n\nconst int PUL = 53;\nconst int DIR = 52;\nconst int ENA = 51;\nconst unsigned int PULSE_US = 25;\n\nenum StepState { STEP_STOP=0, STEP_FWD, STEP_REV };\nvolatile StepState stepState = STEP_STOP;\nunsigned long lastToggleMicros = 0;\nbool pulseLevel = false;\n\n// ================== å…±ç”¨ ==================\nString serialBuf = \"\";\nunsigned long lastTelemetryMs = 0;\nconst unsigned long TELE_CHASSIS_MS = 200UL;\nconst unsigned long TELE_SHOOTER_MS = 400UL; // ç™¼å°„ç«¯è³‡è¨Šè¼ƒå°‘ï¼Œé »ç‡å¯æ”¾æ…¢\nunsigned long lastTeleBudgetMs = 0;\n\nbool equalsIgnoreCase(const String& a, const char* b) {\n  String t=a; t.toUpperCase(); String u=String(b); u.toUpperCase(); return t==u;\n}\n\n// ------------------ CHASSIS å‡½å¼ ------------------\nvoid stopAllChassis() {\n  analogWrite(M1_PWM_A_PIN,0); analogWrite(M1_PWM_B_PIN,0);\n  analogWrite(M2_PWM_A_PIN,0); analogWrite(M2_PWM_B_PIN,0);\n  analogWrite(M3_PWM_A_PIN,0); analogWrite(M3_PWM_B_PIN,0);\n  analogWrite(M4_PWM_A_PIN,0); analogWrite(M4_PWM_B_PIN,0);\n  for (int i=0;i<4;i++){ currentPWMvals[i]=0; targetPWMvals[i]=0; }\n  motorActive=false;\n  Serial.println(\"ğŸ›‘ CHASSIS stop\");\n}\n\nvoid applyMotorDirect(int idx, int pwm_abs, bool forward) {\n  switch(idx){\n    case 0: if(forward){ analogWrite(M1_PWM_A_PIN,pwm_abs); analogWrite(M1_PWM_B_PIN,0);} else { analogWrite(M1_PWM_A_PIN,0); analogWrite(M1_PWM_B_PIN,pwm_abs);} break;\n    case 1: if(forward){ analogWrite(M2_PWM_A_PIN,pwm_abs); analogWrite(M2_PWM_B_PIN,0);} else { analogWrite(M2_PWM_A_PIN,0); analogWrite(M2_PWM_B_PIN,pwm_abs);} break;\n    case 2: if(forward){ analogWrite(M3_PWM_A_PIN,pwm_abs); analogWrite(M3_PWM_B_PIN,0);} else { analogWrite(M3_PWM_A_PIN,0); analogWrite(M3_PWM_B_PIN,pwm_abs);} break;\n    case 3: if(forward){ analogWrite(M4_PWM_A_PIN,pwm_abs); analogWrite(M4_PWM_B_PIN,0);} else { analogWrite(M4_PWM_A_PIN,0); analogWrite(M4_PWM_B_PIN,pwm_abs);} break;\n  }\n}\n\nvoid applyWheelCommand(float w0,float w1,float w2,float w3){\n  float a[4]={w0,w1,w2,w3}; float maxv=0.0001f;\n  // å›ºå®šåå‘ï¼ˆä¾ä½ çš„æ¥ç·šï¼‰ï¼šå‰å·¦ã€å³å‰åå‘\n  a[0]=-a[0]; a[2]=-a[2];\n  for(int i=0;i<4;i++){ if(fabs(a[i])<DEAD_BAND) a[i]=0; if(fabs(a[i])>maxv) maxv=fabs(a[i]); }\n  if(maxv>1.0f) for(int i=0;i<4;i++) a[i]/=maxv;\n  for(int i=0;i<4;i++){\n    float mag=fabs(a[i]);\n    if(mag<DEAD_BAND) targetPWMvals[i]=0;\n    else {\n      float pwm=MIN_PWM+(MAX_PWM-MIN_PWM)*mag;\n      targetPWMvals[i]=(a[i]>=0)?pwm:-pwm;\n    }\n  }\n  motorActive=true;\n}\n\nvoid rampUpdateAndApply(){\n  if (g_mode != MODE_CHASSIS) return; // éåº•ç›¤æ¨¡å¼ï¼Œä¸åšä»»ä½• PWM æ›´æ–°\n  for(int i=0;i<4;i++){\n    float cur=currentPWMvals[i], tgt=targetPWMvals[i];\n    if (fabs(tgt-cur)<=RAMP_STEP) cur=tgt; else cur += (tgt>cur)?RAMP_STEP:-RAMP_STEP;\n    currentPWMvals[i]=cur;\n    if (fabs(cur)<1.0){\n      switch(i){\n        case 0: analogWrite(M1_PWM_A_PIN,0); analogWrite(M1_PWM_B_PIN,0); break;\n        case 1: analogWrite(M2_PWM_A_PIN,0); analogWrite(M2_PWM_B_PIN,0); break;\n        case 2: analogWrite(M3_PWM_A_PIN,0); analogWrite(M3_PWM_B_PIN,0); break;\n        case 3: analogWrite(M4_PWM_A_PIN,0); analogWrite(M4_PWM_B_PIN,0); break;\n      }\n    }else{\n      applyMotorDirect(i,(int)fabs(cur),(cur>0));\n    }\n  }\n}\n\nvoid mecanum_from_cmd(float vx,float vy,float wz,float out[4]){\n  // æ©Ÿé«”æœå‘è£œå„Ÿï¼šç­‰æ•ˆé †æ™‚é‡ +90Â° â†’ (vx_r,vy_r)=(-vy, vx)\n  float vx_r=-vy, vy_r=vx;\n  float wFL=vx_r - vy_r - K_OMEGA*wz;\n  float wFR=vx_r + vy_r + K_OMEGA*wz;\n  float wRL=vx_r + vy_r - K_OMEGA*wz;\n  float wRR=vx_r - vy_r + K_OMEGA*wz;\n  float m=max(max(fabs(wFL),fabs(wFR)),max(fabs(wRL),fabs(wRR)));\n  if(m>1.0f){ wFL/=m; wFR/=m; wRL/=m; wRR/=m; }\n  out[0]=wFL; out[1]=wFR; out[2]=wRL; out[3]=wRR;\n}\n\n// ------------------ SHOOTER å‡½å¼ ------------------\nvoid ensureServo(bool wantAttach){\n  if (wantAttach && !servoAttached){\n    sparkMax.attach(SPARK_PWM_PIN);\n    servoAttached = true;\n  } else if (!wantAttach && servoAttached){\n    sparkMax.detach();\n    servoAttached = false;\n  }\n}\n\nvoid setSparkSpeed(int speed){\n  neoSpeed = speed;\n  if (!servoAttached) return; // é SHOOTER æ¨¡å¼æ™‚ä¸é€è„ˆè¡\n  int us = map(speed, -100, 100, 1000, 2000);\n  sparkMax.writeMicroseconds(us);\n  Serial.print(\"NEO=\"); Serial.print(speed);\n  Serial.print(\" pwm(us)=\"); Serial.println(us);\n}\n\nvoid startForward(){ digitalWrite(DIR,HIGH); stepState=STEP_FWD; Serial.println(\"STEP=F\"); }\nvoid startReverse(){ digitalWrite(DIR,LOW);  stepState=STEP_REV; Serial.println(\"STEP=R\"); }\nvoid stopStepper(){ stepState=STEP_STOP; pulseLevel=false; digitalWrite(PUL,LOW); digitalWrite(ENA,HIGH); Serial.println(\"STEP=S (hold)\"); }\n\nvoid serviceStepper(){\n  if (g_mode != MODE_SHOOTER) return;           // éç™¼å°„æ¨¡å¼ï¼Œä¸ç”¢ç”Ÿè„ˆè¡\n  if (stepState == STEP_STOP) return;           // åœæ­¢ç‹€æ…‹ä¸å ç”¨ CPU\n  unsigned long now=micros();\n  if ((unsigned long)(now - lastToggleMicros) >= PULSE_US){\n    pulseLevel=!pulseLevel;\n    digitalWrite(PUL, pulseLevel?HIGH:LOW);\n    lastToggleMicros=now;\n  }\n}\n\n// ------------------ Telemetry ------------------\nvoid tele_chassis(){\n  Serial.print(\"TELE-CH: cur[\");\n  for(int i=0;i<4;i++){ if(i) Serial.print(\",\"); Serial.print(currentPWMvals[i],1); }\n  Serial.print(\"] tgt[\");\n  for(int i=0;i<4;i++){ if(i) Serial.print(\",\"); Serial.print(targetPWMvals[i],1); }\n  Serial.println(\"]\");\n}\nvoid tele_shooter(){\n  Serial.print(\"TELE-SH: NEO=\"); Serial.print(neoSpeed);\n  Serial.print(\" STEP=\");\n  Serial.println(stepState==STEP_STOP?\"STOP\":(stepState==STEP_FWD?\"FWD\":\"REV\"));\n}\n\n// ------------------ æ¨¡å¼åˆ‡æ› ------------------\nvoid enterChassisMode(){\n  // é—œé–‰ç™¼å°„å­ç³»çµ±\n  stopStepper();                 // ENA=HIGH æŠ±æ­»\n  ensureServo(false);            // detach Servoï¼Œé‡‹æ”¾è¨ˆæ™‚å™¨ä¸­æ–·\n  setSparkSpeed(0);              // æ›´æ–°é‚è¼¯å€¼ï¼Œå¯¦éš›è¼¸å‡ºå› å·² detach ä¸æœƒé€\n  // åº•ç›¤å®‰å…¨æ­¸é›¶\n  stopAllChassis();\n  g_mode = MODE_CHASSIS;\n  lastTelemetryMs = millis();\n  Serial.println(\">> MODE=CHASSIS\");\n}\n\nvoid enterShooterMode(){\n  // é—œé–‰åº•ç›¤è¼¸å‡º\n  stopAllChassis();\n  // å•Ÿå‹•ç™¼å°„å­ç³»çµ±\n  ensureServo(true);             // attach Servo\n  digitalWrite(ENA,HIGH);        // ä¸Šé›»é è¨­æŠ±æ­»\n  g_mode = MODE_SHOOTER;\n  lastTelemetryMs = millis();\n  Serial.println(\">> MODE=SHOOTER\");\n}\n\n// ------------------ ç‹€æ…‹å°å‡º ------------------\nvoid print_status(){\n  Serial.println(\"=== STATUS ===\");\n  Serial.print(\"MODE: \"); Serial.println(g_mode==MODE_CHASSIS?\"CHASSIS\":\"SHOOTER\");\n  if (g_mode==MODE_CHASSIS){\n    Serial.print(\"motorActive: \"); Serial.println(motorActive?\"YES\":\"NO\");\n    for (int i=0;i<4;i++){\n      Serial.print(\"cur[\");Serial.print(i);Serial.print(\"]=\");Serial.print(currentPWMvals[i],1);\n      Serial.print(\" tgt[\");Serial.print(i);Serial.print(\"]=\");Serial.println(targetPWMvals[i],1);\n    }\n  } else {\n    Serial.print(\"NEO speed: \"); Serial.println(neoSpeed);\n    Serial.print(\"STEP state: \"); Serial.println(stepState==STEP_STOP?\"STOP\":(stepState==STEP_FWD?\"FWD\":\"REV\"));\n  }\n  Serial.println(\"=============\");\n}\n\n// ------------------ æŒ‡ä»¤è™•ç† ------------------\nvoid process_cmd_vel(String &msg){\n  // åƒ… CHASSIS æ¨¡å¼æœ‰æ•ˆ\n  if (g_mode != MODE_CHASSIS) { Serial.println(\"IGNORED: vx,vy,wz (MODE!=CHASSIS)\"); return; }\n  char buf[128]; msg.toCharArray(buf,sizeof(buf));\n  char *p=strtok(buf,\",\"); float vx=0,vy=0,wz=0;\n  if(p) vx=atof(p);\n  p=strtok(NULL,\",\"); if(p) vy=atof(p);\n  p=strtok(NULL,\",\"); if(p) wz=atof(p);\n  float out[4]; mecanum_from_cmd(vx,vy,wz,out); applyWheelCommand(out[0],out[1],out[2],out[3]);\n}\n\nvoid handle_line(String line){\n  line.trim();\n  if (!line.length()) return;\n\n  // ç›¸å®¹èˆŠ TOKENï¼šè‹¥å‰ç¶´ <11323310>ï¼Œå‰æ‰\n  const String LEGACY = \"<11323310>\";\n  if (line.startsWith(LEGACY)) { line = line.substring(LEGACY.length()); line.trim(); }\n\n  // æ¨¡å¼åˆ‡æ›\n  if (line.equalsIgnoreCase(\"MODE CHASSIS\")) { enterChassisMode(); return; }\n  if (line.equalsIgnoreCase(\"MODE SHOOTER\")) { enterShooterMode(); return; }\n\n  // é€šç”¨\n  if (line.equalsIgnoreCase(\"STATUS\")) { print_status(); return; }\n  if (line.equalsIgnoreCase(\"STOP\")) {\n    if (g_mode==MODE_CHASSIS) stopAllChassis();\n    else { stopStepper(); setSparkSpeed(0); if (servoAttached) sparkMax.writeMicroseconds(1500); }\n    Serial.println(\"ğŸ›‘ STOP (current mode)\");\n    return;\n  }\n\n  // ä¾æ¨¡å¼è§£è­¯\n  if (g_mode==MODE_CHASSIS){\n    // åªè™•ç† vx,vy,wz\n    if (line.indexOf(',')>=0) { process_cmd_vel(line); return; }\n    Serial.println(\"IGNORED (CHASSIS): not vx,vy,wz\");\n    return;\n  } else {\n    // SHOOTERï¼šF/R/S / æ•´æ•¸\n    if (equalsIgnoreCase(line,\"F\")) { startForward(); return; }\n    if (equalsIgnoreCase(line,\"R\")) { startReverse(); return; }\n    if (equalsIgnoreCase(line,\"S\")) { stopStepper();  return; }\n    // å…¶é¤˜è¦–ç‚º NEO é€Ÿåº¦\n    long spd = line.toInt();\n    if (spd>100) spd=100; if (spd<-100) spd=-100;\n    setSparkSpeed((int)spd);\n    return;\n  }\n}\n\n// ================== setup / loop ==================\nvoid setup(){\n  Serial.begin(115200);\n  delay(200);\n  Serial.println(\"\\n=== MEGA Multiplex (CHASSIS / SHOOTER) NoToken ===\");\n\n  // åº•ç›¤è…³ä½\n  pinMode(M1_PWM_A_PIN, OUTPUT); pinMode(M1_PWM_B_PIN, OUTPUT);\n  pinMode(M2_PWM_A_PIN, OUTPUT); pinMode(M2_PWM_B_PIN, OUTPUT);\n  pinMode(M3_PWM_A_PIN, OUTPUT); pinMode(M3_PWM_B_PIN, OUTPUT);\n  pinMode(M4_PWM_A_PIN, OUTPUT); pinMode(M4_PWM_B_PIN, OUTPUT);\n\n  // æ­¥é€²è…³ä½\n  pinMode(PUL,OUTPUT); pinMode(DIR,OUTPUT); pinMode(ENA,OUTPUT);\n  digitalWrite(PUL,LOW); digitalWrite(ENA,HIGH); // å…ˆæŠ±æ­»\n\n  // åˆå§‹é€² CHASSISï¼Œä¸¦ç¢ºä¿ç™¼å°„å­ç³»çµ±é—œé–‰\n  ensureServo(false);\n  enterChassisMode();\n\n  Serial.println(\"ç”¨æ³•ï¼šMODE CHASSIS / MODE SHOOTER / STATUS / STOP / vx,vy,wz / F/R/S / -100..100\");\n}\n\nvoid loop(){\n  // åªè·‘ç•¶å‰æ¨¡å¼çš„æœå‹™\n  if (g_mode==MODE_CHASSIS){\n    // ç„¡éœ€è™•ç†æ­¥é€²ï¼›NEO Servo å·² detach\n  } else {\n    // ç™¼å°„æ¨¡å¼ï¼šè™•ç†æ­¥é€²è„ˆè¡\n    serviceStepper();\n  }\n\n  // æ”¶æŒ‡ä»¤ï¼ˆ\\n ç‚ºä¸€è¡Œï¼‰\n  while (Serial.available()){\n    char c=(char)Serial.read(); if (c=='\\r') continue;\n    if (c=='\\n'){ String line=serialBuf; serialBuf=\"\"; handle_line(line); }\n    else {\n      serialBuf += c;\n      if (serialBuf.length()>200) serialBuf=serialBuf.substring(serialBuf.length()-200);\n    }\n  }\n\n  // åƒ…åœ¨ CHASSIS æ¨¡å¼æ›´æ–° PWM\n  if (g_mode==MODE_CHASSIS) rampUpdateAndApply();\n\n  // Telemetryï¼ˆå„æ¨¡å¼å„è‡ªé »ç‡ï¼‰\n  unsigned long now = millis();\n  if (g_mode==MODE_CHASSIS){\n    if (now - lastTelemetryMs >= TELE_CHASSIS_MS){ lastTelemetryMs = now; tele_chassis(); }\n  } else {\n    if (now - lastTelemetryMs >= TELE_SHOOTER_MS){ lastTelemetryMs = now; tele_shooter(); }\n  }\n}\n"}
