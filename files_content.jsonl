{"path": "ALL_TEXTS.txt", "extension": ".txt", "size_bytes": 0, "modified_time": "2025-11-25 19:46:55", "sha256": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855", "is_text": true, "encoding": "utf-8", "truncated": false, "content": ""}
{"path": "files_content.jsonl", "extension": ".jsonl", "size_bytes": 0, "modified_time": "2025-11-25 19:46:55", "sha256": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855", "is_text": true, "encoding": "utf-8", "truncated": false, "content": ""}
{"path": "files_report.csv", "extension": ".csv", "size_bytes": 0, "modified_time": "2025-11-25 19:46:55", "sha256": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855", "is_text": true, "encoding": "utf-8", "truncated": false, "content": ""}
{"path": "files_tree.txt", "extension": ".txt", "size_bytes": 347, "modified_time": "2025-10-18 21:23:57", "sha256": "623e3fb2f26f1bb64b3ff4ff748184bac7e310b8fa65eee13880bd93708b3df7", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "TEL2025_MainCode\n└─ ALL_TEXTS.txt\n└─ XboxGUI_V1.ui\n└─ XboxGUI_V2.ui\n└─ aim.py\n└─ files_content.jsonl\n└─ files_report.csv\n└─ files_tree.txt\n└─ main.py\n└─ mega1_controller.py\n└─ scan_folder.py\n└─ xboxGUI.py\n└─ aim\n    └─ aim.ino\n└─ chassis_shooter\n    └─ chassis_shooter.ino"}
{"path": "onnxTran.py", "extension": ".py", "size_bytes": 1041, "modified_time": "2025-11-25 17:31:15", "sha256": "1a5402372a28a938a265919a9b2e79d18f9ed8c41050bff31d41b5d6e6df54bc", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "from ultralytics import YOLO\n\n# 1. 設定模型路徑 (使用 raw string r\"...\" 避免路徑錯誤)\nmodel_path = r\"C:\\Users\\user\\OneDrive - 中原大學\\桌面\\大學作品集\\東京威力\\TEL.v2i\\runs\\detect\\train16\\weights\\best.pt\"\n\nprint(f\"正在載入模型：{model_path}\")\n\n# 2. 載入 PyTorch 模型\ntry:\n    model = YOLO(model_path)\nexcept Exception as e:\n    print(f\"找不到模型，請確認路徑。\\n錯誤訊息: {e}\")\n    exit()\n\nprint(\"模型載入成功，開始轉換為 ONNX 格式...\")\n\n# 3. 執行轉檔 (export)\n# format='onnx': 指定轉出格式\n# opset=12: 這是 ONNX 的版本，12 對樹莓派相容性較好，若報錯可改用預設值\n# simplify=True: 簡化模型結構，讓推論更快 (需要安裝 onnx-simplifier，若失敗可改 False)\ntry:\n    path = model.export(format='onnx', opset=12)\n    print(f\"\\n轉檔成功！檔案已儲存於: {path}\")\nexcept Exception as e:\n    print(f\"\\n轉檔失敗: {e}\")\n    print(\"請嘗試安裝必要套件: pip install onnx onnxruntime\")"}
{"path": "pc_remote_client_gui.py", "extension": ".py", "size_bytes": 22599, "modified_time": "2025-11-19 11:08:00", "sha256": "462dba7ac4a173c8fe99d01f4349fec83efd5065e65cf0c7f686d916ab3df083", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "# pc_remote_client_gui.py\n# 筆電端遙控程式：\n# - 透過 TCP 連到 Raspberry Pi 上的 pi_remote_server.py\n# - 底盤：W / A / S / D + 左右方向鍵 控制 CHASSIS vx vy wz\n# - Shooter：F / R / X 控 STEP F/R/S，1 / 2 / 3 控 SERVO S1/S2/S3，NEO 速度輸入\n# - AIM：\n#     L / J 控 M1 (軸1) ±1°\n#     I / K 控 M2 (軸2) ±1°\n#   並提供：\n#     M1 設為原點 / M1 回原點\n#     M2 設為原點 / M2 回原點\n#   預設角度：\n#     9 個檔案槽 → presets/preset_1.json ~ preset_9.json\n#     10 個參數按鈕 → 每檔第 1~10 筆 [M1,M2]\n#     按 P 鍵：直接載入 + 立即送出（若已連線）\n\nimport socket\nimport threading\nimport tkinter as tk\nfrom tkinter import ttk, scrolledtext, messagebox\nimport os\nimport json\n\nDEFAULT_HOST = \"10.254.97.208\"\nDEFAULT_PORT = 5000\nPRESET_DIR   = \"presets\"   # JSON 放這裡（與此程式同層的 presets 資料夾）\n\n\nclass RemoteClient:\n    def __init__(self):\n        self.sock = None\n        self.lock = threading.Lock()\n        self.running = False\n        self.on_recv = None  # callback(str)\n\n    def connect(self, host, port):\n        self.close()\n        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        s.settimeout(5.0)\n        s.connect((host, port))\n        s.settimeout(None)\n        self.sock = s\n        self.running = True\n        t = threading.Thread(target=self._recv_loop, daemon=True)\n        t.start()\n\n    def _recv_loop(self):\n        try:\n            f = self.sock.makefile(\"r\")\n            for line in f:\n                line = line.rstrip(\"\\r\\n\")\n                if self.on_recv:\n                    self.on_recv(line)\n            if self.on_recv:\n                self.on_recv(\"[INFO] Server closed connection\")\n        except Exception as e:\n            if self.on_recv:\n                self.on_recv(f\"[ERR] recv: {e}\")\n        finally:\n            self.close()\n\n    def send_line(self, text):\n        with self.lock:\n            if not self.sock:\n                raise RuntimeError(\"not connected\")\n            data = (text.strip() + \"\\n\").encode(\"utf-8\")\n            self.sock.sendall(data)\n\n    def close(self):\n        with self.lock:\n            if self.sock:\n                try:\n                    self.sock.close()\n                except:\n                    pass\n            self.sock = None\n            self.running = False\n\n\nclass App(tk.Tk):\n    def __init__(self):\n        super().__init__()\n        self.title(\"Laptop Remote Controller -> Pi\")\n        self.geometry(\"820x760\")\n        self.resizable(False, False)\n\n        self.client = RemoteClient()\n        self.client.on_recv = self._on_recv\n\n        # 狀態\n        self.connected = False\n        self.host_var = tk.StringVar(value=DEFAULT_HOST)\n        self.port_var = tk.IntVar(value=DEFAULT_PORT)\n        self.speed_scale = tk.DoubleVar(value=0.6)  # 底盤速度倍率 (0~1)\n\n        # 底盤鍵盤狀態\n        self.keys = {\n            \"w\": False,\n            \"a\": False,\n            \"s\": False,\n            \"d\": False,\n            \"left\": False,\n            \"right\": False\n        }\n        self.vx = 0.0\n        self.vy = 0.0\n        self.wz = 0.0\n\n        # Shooter\n        self.neo_var = tk.StringVar(value=\"0\")\n        self.raw_var = tk.StringVar(value=\"STATUS\")\n\n        # AIM 狀態（手動）\n        self.AIM_STEP = 1.0\n        self.m1_angle = 0.0\n        self.m2_angle = 0.0\n\n        # AIM 預設選擇\n        self.current_file_slot   = None  # 1..9\n        self.current_param_slot  = None  # 1..10\n\n        self._ensure_preset_dir()\n        self._build_ui()\n        self._bind_keys()\n\n    # ===== 共用 UI =====\n    def _build_ui(self):\n        frm = ttk.Frame(self, padding=8)\n        frm.pack(fill=tk.BOTH, expand=True)\n\n        row = 0\n        # 連線區\n        ttk.Label(frm, text=\"Pi IP：\").grid(column=0, row=row, sticky=tk.W)\n        ttk.Entry(frm, textvariable=self.host_var, width=20).grid(column=1, row=row, sticky=tk.W)\n\n        ttk.Label(frm, text=\"Port：\").grid(column=2, row=row, sticky=tk.W)\n        ttk.Entry(frm, textvariable=self.port_var, width=8).grid(column=3, row=row, sticky=tk.W)\n\n        self.btn_connect = ttk.Button(frm, text=\"連線\", command=self._toggle_connect)\n        self.btn_connect.grid(column=4, row=row, padx=8, sticky=tk.W)\n\n        self.status_var = tk.StringVar(value=\"未連線\")\n        ttk.Label(frm, textvariable=self.status_var).grid(column=5, row=row, sticky=tk.W)\n\n        row += 1\n        # 底盤控制說明\n        ttk.Label(\n            frm,\n            text=\"底盤：W/S 前後  A/D 左右  ←/→ 旋轉    速度倍率：\"\n        ).grid(column=0, row=row, columnspan=4, sticky=tk.W, pady=(8, 0))\n\n        ttk.Scale(\n            frm, from_=0.0, to=1.0, orient=tk.HORIZONTAL,\n            variable=self.speed_scale, length=200,\n            command=lambda v: self._update_speed_label()\n        ).grid(column=4, row=row, columnspan=2, sticky=tk.W, pady=(8, 0))\n\n        self.sp_lbl = ttk.Label(frm, text=f\"{self.speed_scale.get():.2f}\")\n        self.sp_lbl.grid(column=6, row=row, sticky=tk.W, pady=(8, 0))\n\n        row += 1\n        # 目前 vx, vy, wz\n        cur = ttk.LabelFrame(frm, text=\"目前底盤指令\")\n        cur.grid(column=0, row=row, columnspan=7, sticky=tk.EW, pady=(8, 4))\n        self.vx_lbl = ttk.Label(cur, text=\"vx = 0.00\")\n        self.vy_lbl = ttk.Label(cur, text=\"vy = 0.00\")\n        self.wz_lbl = ttk.Label(cur, text=\"wz = 0.00\")\n        self.vx_lbl.grid(column=0, row=0, padx=8, pady=4, sticky=tk.W)\n        self.vy_lbl.grid(column=1, row=0, padx=8, pady=4, sticky=tk.W)\n        self.wz_lbl.grid(column=2, row=0, padx=8, pady=4, sticky=tk.W)\n\n        row += 1\n        # Shooter（步進 + Servo + NEO）\n        stp = ttk.LabelFrame(frm, text=\"Shooter 控制\")\n        stp.grid(column=0, row=row, columnspan=7, sticky=tk.EW, pady=(4, 4))\n\n        ttk.Label(stp, text=\"步進 (STEP)：F / R / X=停\").grid(column=0, row=0, padx=8, pady=4, sticky=tk.W)\n        ttk.Button(stp, text=\"F\", command=lambda: self._send_step(\"F\")).grid(column=1, row=0, padx=4, pady=4)\n        ttk.Button(stp, text=\"R\", command=lambda: self._send_step(\"R\")).grid(column=2, row=0, padx=4, pady=4)\n        ttk.Button(stp, text=\"S\", command=lambda: self._send_step(\"S\")).grid(column=3, row=0, padx=4, pady=4)\n\n        ttk.Label(stp, text=\"Servo：1 / 2 / 3 -> S1/S2/S3\").grid(column=0, row=1, padx=8, pady=4, sticky=tk.W)\n        ttk.Button(stp, text=\"S1\", command=lambda: self._send_servo(\"S1\")).grid(column=1, row=1, padx=4, pady=4)\n        ttk.Button(stp, text=\"S2\", command=lambda: self._send_servo(\"S2\")).grid(column=2, row=1, padx=4, pady=4)\n        ttk.Button(stp, text=\"S3\", command=lambda: self._send_servo(\"S3\")).grid(column=3, row=1, padx=4, pady=4)\n\n        ttk.Label(stp, text=\"NEO 速度 (-100..100)：\").grid(column=0, row=2, padx=8, pady=4, sticky=tk.W)\n        ttk.Entry(stp, textvariable=self.neo_var, width=8).grid(column=1, row=2, padx=4, pady=4, sticky=tk.W)\n        ttk.Button(stp, text=\"送出 NEO\", command=self._send_neo).grid(column=2, row=2, padx=4, pady=4, sticky=tk.W)\n\n        row += 1\n        # AIM 手動控制\n        aimf = ttk.LabelFrame(frm, text=\"AIM 控制（L/J 控 M1，I/K 控 M2，每步 1°）\")\n        aimf.grid(column=0, row=row, columnspan=7, sticky=tk.EW, pady=(4, 4))\n\n        self.m1_lbl = ttk.Label(aimf, text=\"M1 = 0.0°\")\n        self.m2_lbl = ttk.Label(aimf, text=\"M2 = 0.0°\")\n        self.m1_lbl.grid(column=0, row=0, padx=8, pady=4, sticky=tk.W)\n        self.m2_lbl.grid(column=0, row=1, padx=8, pady=4, sticky=tk.W)\n\n        ttk.Button(aimf, text=\"M1 -\", command=lambda: self._aim_delta(1, -self.AIM_STEP)).grid(column=1, row=0, padx=4, pady=4)\n        ttk.Button(aimf, text=\"M1 +\", command=lambda: self._aim_delta(1,  self.AIM_STEP)).grid(column=2, row=0, padx=4, pady=4)\n        ttk.Button(aimf, text=\"M1 設為原點\", command=lambda: self._aim_reset_origin(1)).grid(column=3, row=0, padx=4, pady=4)\n        ttk.Button(aimf, text=\"M1 回原點\", command=lambda: self._aim_go_origin(1)).grid(column=4, row=0, padx=4, pady=4)\n\n        ttk.Button(aimf, text=\"M2 -\", command=lambda: self._aim_delta(2, -self.AIM_STEP)).grid(column=1, row=1, padx=4, pady=4)\n        ttk.Button(aimf, text=\"M2 +\", command=lambda: self._aim_delta(2,  self.AIM_STEP)).grid(column=2, row=1, padx=4, pady=4)\n        ttk.Button(aimf, text=\"M2 設為原點\", command=lambda: self._aim_reset_origin(2)).grid(column=3, row=1, padx=4, pady=4)\n        ttk.Button(aimf, text=\"M2 回原點\", command=lambda: self._aim_go_origin(2)).grid(column=4, row=1, padx=4, pady=4)\n\n        self._update_aim_labels()\n\n        row += 1\n        # AIM 預設角度（9 檔案槽 + 10 參數）\n        pf = ttk.LabelFrame(frm, text=\"AIM 預設角度（9 檔案槽 + 10 參數；preset_1~preset_9.json，每筆 [M1,M2]）\")\n        pf.grid(column=0, row=row, columnspan=7, sticky=tk.NSEW, pady=(4, 4))\n\n        file_frame = ttk.Frame(pf)\n        file_frame.pack(fill=\"x\", pady=(2, 2))\n        self.file_buttons = []\n        for i in range(9):\n            idx = i + 1\n            b = ttk.Button(\n                file_frame, text=f\"槽{idx}\",\n                command=lambda s=idx: self._select_file_slot(s),\n                width=6\n            )\n            b.grid(row=i // 3, column=i % 3, padx=2, pady=2)\n            self.file_buttons.append(b)\n\n        self.file_info_var  = tk.StringVar(value=\"未選擇檔案槽（預設檔名 preset_1.json~preset_9.json）\")\n        self.param_info_var = tk.StringVar(value=\"未選擇參數編號\")\n        ttk.Label(pf, textvariable=self.file_info_var).pack(anchor=\"w\", padx=4)\n        ttk.Label(pf, textvariable=self.param_info_var).pack(anchor=\"w\", padx=4, pady=(0, 2))\n\n        param_frame = ttk.Frame(pf)\n        param_frame.pack(fill=\"x\", pady=(2, 2))\n        self.param_buttons = []\n        for j in range(10):\n            idx = j + 1\n            b = ttk.Button(\n                param_frame, text=f\"P{idx}\",\n                command=lambda k=idx: self._param_click(k),\n                width=6\n            )\n            b.grid(row=j // 5, column=j % 5, padx=2, pady=2)\n            self.param_buttons.append(b)\n\n        row += 1\n        # Raw 指令區\n        raw = ttk.LabelFrame(frm, text=\"Raw 指令（直接傳給 Pi）\")\n        raw.grid(column=0, row=row, columnspan=7, sticky=tk.EW, pady=(4, 4))\n        ttk.Entry(raw, textvariable=self.raw_var, width=50).grid(column=0, row=0, padx=4, pady=4)\n        ttk.Button(raw, text=\"送出 RAW\", command=self._send_raw).grid(column=1, row=0, padx=4, pady=4)\n        ttk.Button(raw, text=\"STATUS\", command=self._send_status).grid(column=2, row=0, padx=4, pady=4)\n\n        row += 1\n        # Log\n        lf = ttk.LabelFrame(frm, text=\"Log (Pi 回覆 & 狀態)\")\n        lf.grid(column=0, row=row, columnspan=7, sticky=tk.NSEW, pady=(8, 0))\n        self.log = scrolledtext.ScrolledText(lf, height=10, width=94, state=\"disabled\", wrap=\"none\")\n        self.log.pack(fill=tk.BOTH, expand=True, padx=4, pady=4)\n\n        self.protocol(\"WM_DELETE_WINDOW\", self._on_close)\n\n    def _bind_keys(self):\n        self.bind(\"<KeyPress>\", self._on_key_press)\n        self.bind(\"<KeyRelease>\", self._on_key_release)\n        self.after(200, lambda: self.focus_force())\n\n    def _ensure_preset_dir(self):\n        if not os.path.isdir(PRESET_DIR):\n            try:\n                os.makedirs(PRESET_DIR, exist_ok=True)\n            except Exception:\n                pass\n\n    # ===== 連線控制 =====\n    def _toggle_connect(self):\n        if self.connected:\n            self._disconnect()\n        else:\n            self._connect()\n\n    def _connect(self):\n        host = self.host_var.get().strip()\n        port = int(self.port_var.get())\n        if not host:\n            messagebox.showwarning(\"提示\", \"請輸入 Pi IP\")\n            return\n        try:\n            self.client.connect(host, port)\n        except Exception as e:\n            messagebox.showerror(\"連線失敗\", str(e))\n            self.status_var.set(\"連線失敗\")\n            return\n        self.connected = True\n        self.status_var.set(f\"已連線：{host}:{port}\")\n        self.btn_connect.config(text=\"斷線\")\n        self._append_log(\"[INFO] connected\")\n\n    def _disconnect(self):\n        self.client.close()\n        self.connected = False\n        self.status_var.set(\"未連線\")\n        self.btn_connect.config(text=\"連線\")\n        self._append_log(\"[INFO] disconnected\")\n\n    # ===== Log =====\n    def _append_log(self, txt):\n        self.log.config(state=\"normal\")\n        self.log.insert(tk.END, txt + \"\\n\")\n        self.log.see(tk.END)\n        self.log.config(state=\"disabled\")\n\n    def _on_recv(self, line: str):\n        self.after(0, lambda: self._append_log(\"[Pi] \" + line))\n\n    # ===== 底盤控制 =====\n    def _update_speed_label(self):\n        self.sp_lbl.config(text=f\"{self.speed_scale.get():.2f}\")\n        self._update_chassis_from_keys()\n\n    def _on_key_press(self, ev):\n        if not self.connected:\n            return\n        k = ev.keysym.lower()\n\n        # 底盤\n        if k in (\"w\", \"a\", \"s\", \"d\", \"left\", \"right\"):\n            if not self.keys.get(k, False):\n                self.keys[k] = True\n                self._update_chassis_from_keys()\n            return\n\n        # Shooter\n        if k == \"f\":\n            self._send_step(\"F\"); return\n        if k == \"r\":\n            self._send_step(\"R\"); return\n        if k == \"x\":\n            self._send_step(\"S\"); return\n\n        # Servo\n        if k == \"1\":\n            self._send_servo(\"S1\"); return\n        if k == \"2\":\n            self._send_servo(\"S2\"); return\n        if k == \"3\":\n            self._send_servo(\"S3\"); return\n\n        # AIM 手動\n        if k == \"l\":\n            self._aim_delta(1, self.AIM_STEP); return\n        if k == \"j\":\n            self._aim_delta(1, -self.AIM_STEP); return\n        if k == \"i\":\n            self._aim_delta(2, self.AIM_STEP); return\n        if k == \"k\":\n            self._aim_delta(2, -self.AIM_STEP); return\n\n    def _on_key_release(self, ev):\n        if not self.connected:\n            return\n        k = ev.keysym.lower()\n        if k in (\"w\", \"a\", \"s\", \"d\", \"left\", \"right\"):\n            if self.keys.get(k, False):\n                self.keys[k] = False\n                self._update_chassis_from_keys()\n\n    def _update_chassis_from_keys(self):\n        vx = vy = wz = 0.0\n        if self.keys[\"w\"] and not self.keys[\"s\"]:\n            vx = 1.0\n        elif self.keys[\"s\"] and not self.keys[\"w\"]:\n            vx = -1.0\n\n        if self.keys[\"d\"] and not self.keys[\"a\"]:\n            vy = 1.0\n        elif self.keys[\"a\"] and not self.keys[\"d\"]:\n            vy = -1.0\n\n        if self.keys[\"left\"] and not self.keys[\"right\"]:\n            wz = -1.0\n        elif self.keys[\"right\"] and not self.keys[\"left\"]:\n            wz = 1.0\n\n        sp = float(self.speed_scale.get())\n        self.vx = vx * sp\n        self.vy = vy * sp\n        self.wz = wz * sp\n\n        self.vx_lbl.config(text=f\"vx = {self.vx:.2f}\")\n        self.vy_lbl.config(text=f\"vy = {self.vy:.2f}\")\n        self.wz_lbl.config(text=f\"wz = {self.wz:.2f}\")\n\n        if self.connected:\n            try:\n                cmd = f\"CHASSIS {self.vx:.2f} {self.vy:.2f} {self.wz:.2f}\"\n                self.client.send_line(cmd)\n                self._append_log(\"[PC] \" + cmd)\n            except Exception as e:\n                self._append_log(f\"[ERR] send CHASSIS: {e}\")\n                self._disconnect()\n\n    # ===== Shooter / RAW =====\n    def _send_step(self, sub):\n        if not self.connected:\n            return\n        cmd = f\"STEP {sub}\"\n        try:\n            self.client.send_line(cmd)\n            self._append_log(\"[PC] \" + cmd)\n        except Exception as e:\n            self._append_log(f\"[ERR] send STEP: {e}\")\n            self._disconnect()\n\n    def _send_servo(self, sname):\n        if not self.connected:\n            return\n        cmd = f\"SERVO {sname}\"\n        try:\n            self.client.send_line(cmd)\n            self._append_log(\"[PC] \" + cmd)\n        except Exception as e:\n            self._append_log(f\"[ERR] send SERVO: {e}\")\n            self._disconnect()\n\n    def _send_neo(self):\n        if not self.connected:\n            return\n        s = self.neo_var.get().strip()\n        try:\n            v = int(s)\n        except:\n            messagebox.showwarning(\"警告\", \"NEO 速度必須為整數 -100..100\")\n            return\n        if v < -100: v = -100\n        if v > 100:  v = 100\n        cmd = f\"NEO {v}\"\n        try:\n            self.client.send_line(cmd)\n            self._append_log(\"[PC] \" + cmd)\n        except Exception as e:\n            self._append_log(f\"[ERR] send NEO: {e}\")\n            self._disconnect()\n\n    def _send_raw(self):\n        if not self.connected:\n            return\n        txt = self.raw_var.get().strip()\n        if not txt:\n            return\n        cmd = f\"RAW {txt}\"\n        try:\n            self.client.send_line(cmd)\n            self._append_log(\"[PC] \" + cmd)\n        except Exception as e:\n            self._append_log(f\"[ERR] send RAW: {e}\")\n            self._disconnect()\n\n    def _send_status(self):\n        if not self.connected:\n            return\n        try:\n            self.client.send_line(\"STATUS\")\n            self._append_log(\"[PC] STATUS\")\n        except Exception as e:\n            self._append_log(f\"[ERR] send STATUS: {e}\")\n            self._disconnect()\n\n    # ===== AIM 手動 =====\n    def _update_aim_labels(self):\n        self.m1_lbl.config(text=f\"M1 = {self.m1_angle:.1f}°\")\n        self.m2_lbl.config(text=f\"M2 = {self.m2_angle:.1f}°\")\n\n    def _aim_send(self, axis, angle):\n        if not self.connected:\n            return\n        cmd = f\"AIM {axis} {angle:.3f}\"\n        try:\n            self.client.send_line(cmd)\n            self._append_log(\"[PC] \" + cmd)\n        except Exception as e:\n            self._append_log(f\"[ERR] send AIM: {e}\")\n            self._disconnect()\n\n    def _aim_delta(self, axis, delta):\n        if axis == 1:\n            self.m1_angle += delta\n            angle = self.m1_angle\n        else:\n            self.m2_angle += delta\n            angle = self.m2_angle\n        self._update_aim_labels()\n        self._aim_send(axis, angle)\n\n    def _aim_reset_origin(self, axis):\n        if axis == 1:\n            self.m1_angle = 0.0\n        else:\n            self.m2_angle = 0.0\n        self._update_aim_labels()\n        self._append_log(f\"[INFO] AIM M{axis} 設為原點 (UI 角度歸零，不送命令)\")\n\n    def _aim_go_origin(self, axis):\n        if axis == 1:\n            self.m1_angle = 0.0\n        else:\n            self.m2_angle = 0.0\n        self._update_aim_labels()\n        self._aim_send(axis, 0.0)\n        self._append_log(f\"[INFO] AIM M{axis} 回原點 (送 AIM {axis} 0)\")\n\n    # ===== AIM 預設：檔案槽 + 參數 =====\n    def _select_file_slot(self, slot):\n        self.current_file_slot = slot\n        self.current_param_slot = None\n        fname = f\"preset_{slot}.json\"\n        path = os.path.join(PRESET_DIR, fname)\n        if os.path.exists(path):\n            self.file_info_var.set(f\"檔案槽 {slot} → {fname}\")\n        else:\n            self.file_info_var.set(f\"檔案槽 {slot} → {fname}（檔案不存在）\")\n        self.param_info_var.set(\"未選擇參數編號\")\n\n    def _load_preset_value(self, file_slot, param_slot, verbose=True):\n        fname = f\"preset_{file_slot}.json\"\n        path = os.path.join(PRESET_DIR, fname)\n        try:\n            with open(path, \"r\", encoding=\"utf-8\") as f:\n                data = json.load(f)\n        except Exception as e:\n            if verbose:\n                messagebox.showwarning(\"讀取 JSON 失敗\", f\"{path}\\n{e}\")\n            return None\n\n        if not isinstance(data, list):\n            if verbose:\n                messagebox.showwarning(\"JSON 格式錯誤\", f\"{path}\\n最外層必須為 list。\")\n            return None\n\n        idx = param_slot - 1\n        if idx < 0 or idx >= len(data):\n            if verbose:\n                messagebox.showwarning(\"索引錯誤\", f\"{path}\\n沒有第 {param_slot} 筆資料。\")\n            return None\n\n        item = data[idx]\n        if isinstance(item, (list, tuple)) and len(item) >= 2:\n            m1, m2 = item[0], item[1]\n        elif isinstance(item, dict):\n            m1 = item.get(\"m1\", item.get(\"M1\"))\n            m2 = item.get(\"m2\", item.get(\"M2\"))\n        else:\n            if verbose:\n                messagebox.showwarning(\"資料格式錯誤\", f\"{path}\\n第 {param_slot} 筆無法解析。\")\n            return None\n\n        try:\n            m1 = float(m1)\n            m2 = float(m2)\n        except Exception:\n            if verbose:\n                messagebox.showwarning(\"資料格式錯誤\", f\"{path}\\n第 {param_slot} 筆不是數值。\")\n            return None\n\n        return m1, m2\n\n    def _param_click(self, idx):\n        if self.current_file_slot is None:\n            messagebox.showwarning(\"尚未選擇檔案槽\", \"請先按上面的其中一個『槽1~槽9』。\")\n            return\n\n        self.current_param_slot = idx\n        res = self._load_preset_value(self.current_file_slot, idx, verbose=True)\n        if res is None:\n            self.param_info_var.set(f\"參數編號 P{idx}（讀取失敗）\")\n            return\n\n        m1, m2 = res\n        self.m1_angle = m1\n        self.m2_angle = m2\n        self._update_aim_labels()\n        self.param_info_var.set(f\"參數編號 P{idx} → M1={m1:.3f}, M2={m2:.3f}\")\n\n        if not self.connected:\n            self._append_log(\n                f\"[INFO] 槽{self.current_file_slot} P{idx} → 更新 UI，未連線：M1={m1:.3f}, M2={m2:.3f}\"\n            )\n            return\n\n        self._aim_send(1, m1)\n        self._aim_send(2, m2)\n        self._append_log(\n            f\"[INFO] 槽{self.current_file_slot} P{idx} → 已送出：M1={m1:.3f}, M2={m2:.3f}\"\n        )\n\n    # ===== 關閉 =====\n    def _on_close(self):\n        self._disconnect()\n        self.destroy()\n\n\nif __name__ == \"__main__\":\n    app = App()\n    app.mainloop()\n"}
{"path": "pc_remote_qt.py", "extension": ".py", "size_bytes": 13806, "modified_time": "2025-11-24 21:31:55", "sha256": "f9ad31b1eb8ce8a2146b978ccb98ada3c7b570833a2b9dedd2ab4bb2ef28d60c", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "import sys\nimport socket\nimport threading\nimport json\nimport os\nfrom PyQt6 import uic, QtCore, QtGui\nfrom PyQt6.QtWidgets import QMainWindow, QApplication, QMessageBox, QPushButton\nfrom PyQt6.QtCore import pyqtSignal, Qt\n\nDEFAULT_HOST = \"10.254.97.208\"\nDEFAULT_PORT = 5000\nPRESET_DIR = \"presets\"\n\nclass RemoteClient:\n    \"\"\"\n    負責 TCP 連線的邏輯類別 (未變動)\n    \"\"\"\n    def __init__(self):\n        self.sock = None\n        self.lock = threading.Lock()\n        self.running = False\n        self.on_recv = None\n\n    def connect(self, host, port):\n        self.close()\n        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        s.settimeout(3.0)\n        s.connect((host, port))\n        s.settimeout(None)\n        self.sock = s\n        self.running = True\n        t = threading.Thread(target=self._recv_loop, daemon=True)\n        t.start()\n\n    def _recv_loop(self):\n        try:\n            f = self.sock.makefile(\"r\")\n            for line in f:\n                line = line.rstrip(\"\\r\\n\")\n                if self.on_recv:\n                    self.on_recv(line)\n            if self.on_recv:\n                self.on_recv(\"[INFO] Server closed connection\")\n        except Exception as e:\n            if self.on_recv and self.running:\n                self.on_recv(f\"[ERR] recv: {e}\")\n        finally:\n            self.close()\n\n    def send_line(self, text):\n        with self.lock:\n            if not self.sock:\n                raise RuntimeError(\"not connected\")\n            data = (text.strip() + \"\\n\").encode(\"utf-8\")\n            self.sock.sendall(data)\n\n    def close(self):\n        with self.lock:\n            self.running = False\n            if self.sock:\n                try:\n                    self.sock.close()\n                except:\n                    pass\n            self.sock = None\n\nclass MainWindow(QMainWindow):\n    log_signal = pyqtSignal(str)\n    \n    def __init__(self):\n        super().__init__()\n        # 載入 .ui 檔案\n        if not os.path.exists(\"remote_layout.ui\"):\n            QMessageBox.critical(self, \"錯誤\", \"找不到 remote_layout.ui\")\n            sys.exit(1)\n        uic.loadUi(\"remote_layout.ui\", self)\n        \n        # 初始化變數\n        self.client = RemoteClient()\n        self.client.on_recv = self._on_client_recv\n        self.log_signal.connect(self._append_log)\n\n        self.connected = False\n        self.keys = {k: False for k in [\"w\", \"a\", \"s\", \"d\", \"left\", \"right\"]}\n        self.vx = 0.0\n        self.vy = 0.0\n        self.wz = 0.0\n        \n        self.AIM_STEP = 1.0\n        self.m1_angle = 0.0\n        self.m2_angle = 0.0\n        \n        self.current_file_slot = None\n        self.current_param_slot = None\n\n        self._ensure_preset_dir()\n        self._setup_ui_logic()\n        \n        self.txt_log.setPlaceholderText(\"等待連線中... 系統就緒\")\n\n    def _setup_ui_logic(self):\n        \"\"\"綁定 UI 事件\"\"\"\n        self.btn_connect.clicked.connect(self._toggle_connect)\n        self.slider_speed.valueChanged.connect(self._update_speed_label)\n        \n        self.btn_step_f.clicked.connect(lambda: self._send_step(\"F\"))\n        self.btn_step_r.clicked.connect(lambda: self._send_step(\"R\"))\n        self.btn_step_s.clicked.connect(lambda: self._send_step(\"S\"))\n        \n        self.btn_servo_1.clicked.connect(lambda: self._send_servo(\"S1\"))\n        self.btn_servo_2.clicked.connect(lambda: self._send_servo(\"S2\"))\n        self.btn_servo_3.clicked.connect(lambda: self._send_servo(\"S3\"))\n        \n        # --- 修改處：NEO 改為三個按鈕 ---\n        self.btn_neo_0.clicked.connect(lambda: self._send_neo_val(0))\n        self.btn_neo_n50.clicked.connect(lambda: self._send_neo_val(-50))\n        self.btn_neo_n100.clicked.connect(lambda: self._send_neo_val(-100))\n        # ------------------------------\n        \n        self.btn_m1_dec.clicked.connect(lambda: self._aim_delta(1, -self.AIM_STEP))\n        self.btn_m1_inc.clicked.connect(lambda: self._aim_delta(1, self.AIM_STEP))\n        self.btn_m1_set0.clicked.connect(lambda: self._aim_reset_origin(1))\n        self.btn_m1_go0.clicked.connect(lambda: self._aim_go_origin(1))\n        \n        self.btn_m2_dec.clicked.connect(lambda: self._aim_delta(2, -self.AIM_STEP))\n        self.btn_m2_inc.clicked.connect(lambda: self._aim_delta(2, self.AIM_STEP))\n        self.btn_m2_set0.clicked.connect(lambda: self._aim_reset_origin(2))\n        self.btn_m2_go0.clicked.connect(lambda: self._aim_go_origin(2))\n        \n        self.btn_raw.clicked.connect(self._send_raw)\n        self.btn_status.clicked.connect(self._send_status)\n        self.input_raw.returnPressed.connect(self._send_raw)\n\n        # 動態生成 Presets 按鈕\n        for i in range(9):\n            btn = QPushButton(f\"槽{i+1}\")\n            btn.setCursor(Qt.CursorShape.PointingHandCursor)\n            btn.clicked.connect(lambda checked, idx=i+1: self._select_file_slot(idx))\n            self.grid_files.addWidget(btn, i // 3, i % 3)\n            \n        for j in range(10):\n            btn = QPushButton(f\"P{j+1}\")\n            btn.setCursor(Qt.CursorShape.PointingHandCursor)\n            btn.clicked.connect(lambda checked, idx=j+1: self._param_click(idx))\n            self.grid_params.addWidget(btn, j // 5, j % 5)\n\n    def _ensure_preset_dir(self):\n        if not os.path.isdir(PRESET_DIR):\n            try:\n                os.makedirs(PRESET_DIR, exist_ok=True)\n            except: pass\n\n    def keyPressEvent(self, event):\n        if event.isAutoRepeat(): return\n        self._handle_key(event, True)\n    \n    def keyReleaseEvent(self, event):\n        if event.isAutoRepeat(): return\n        self._handle_key(event, False)\n\n    def _handle_key(self, event, is_press):\n        key = event.key()\n        txt = event.text().lower()\n        updated = False\n        \n        if txt == 'w': self.keys['w'] = is_press; updated = True\n        elif txt == 's': self.keys['s'] = is_press; updated = True\n        elif txt == 'a': self.keys['a'] = is_press; updated = True\n        elif txt == 'd': self.keys['d'] = is_press; updated = True\n        elif key == Qt.Key.Key_Left: self.keys['left'] = is_press; updated = True\n        elif key == Qt.Key.Key_Right: self.keys['right'] = is_press; updated = True\n        \n        if updated:\n            self._update_chassis_from_keys()\n            return\n\n        if is_press:\n            if txt == 'f': self._send_step(\"F\")\n            elif txt == 'r': self._send_step(\"R\")\n            elif txt == 'x': self._send_step(\"S\")\n            elif txt == '1': self._send_servo(\"S1\")\n            elif txt == '2': self._send_servo(\"S2\")\n            elif txt == '3': self._send_servo(\"S3\")\n            elif txt == 'l': self._aim_delta(1, self.AIM_STEP)\n            elif txt == 'j': self._aim_delta(1, -self.AIM_STEP)\n            elif txt == 'i': self._aim_delta(2, self.AIM_STEP)\n            elif txt == 'k': self._aim_delta(2, -self.AIM_STEP)\n\n    def _toggle_connect(self):\n        if self.connected:\n            self.client.close()\n            self.connected = False\n            self.lbl_status.setText(\"未連線\")\n            self.lbl_status.setStyleSheet(\"color: #888888; font-weight: bold;\") \n            self.btn_connect.setText(\"連線\")\n            self.btn_connect.setStyleSheet(\"\")\n            self._append_log(\"[INFO] disconnected\")\n        else:\n            host = self.input_ip.text().strip()\n            try:\n                port = int(self.input_port.text())\n            except ValueError:\n                QMessageBox.warning(self, \"警告\", \"Port 必須是數字\")\n                return\n            try:\n                self.client.connect(host, port)\n                self.connected = True\n                self.lbl_status.setText(f\"已連線: {host}\")\n                self.lbl_status.setStyleSheet(\"color: #00e676; font-weight: bold;\")\n                self.btn_connect.setText(\"斷線\")\n                self.btn_connect.setStyleSheet(\"background-color: #444; border: 1px solid #f44336;\") \n                self._append_log(\"[INFO] connected\")\n                self.setFocus() \n            except Exception as e:\n                self._append_log(f\"[ERR] Connect fail: {e}\")\n                QMessageBox.critical(self, \"連線失敗\", str(e))\n\n    def _on_client_recv(self, msg):\n        self.log_signal.emit(f\"[Pi] {msg}\")\n\n    def _append_log(self, txt):\n        self.txt_log.append(txt)\n        sb = self.txt_log.verticalScrollBar()\n        sb.setValue(sb.maximum())\n\n    def _send_line_safe(self, cmd):\n        if not self.connected: return\n        try:\n            self.client.send_line(cmd)\n            self._append_log(f\"[PC] {cmd}\")\n        except Exception as e:\n            self._append_log(f\"[ERR] send: {e}\")\n            self._toggle_connect()\n\n    def _update_speed_label(self):\n        val = self.slider_speed.value() / 100.0\n        self.lbl_speed_val.setText(f\"{val:.2f}\")\n        self._update_chassis_from_keys()\n        self.setFocus()\n\n    def _update_chassis_from_keys(self):\n        vx = vy = wz = 0.0\n        if self.keys['w'] and not self.keys['s']: vx = 1.0\n        if self.keys['s'] and not self.keys['w']: vx = -1.0\n        if self.keys['d'] and not self.keys['a']: vy = 1.0\n        if self.keys['a'] and not self.keys['d']: vy = -1.0\n        if self.keys['left'] and not self.keys['right']: wz = -1.0\n        if self.keys['right'] and not self.keys['left']: wz = 1.0\n        \n        sp = self.slider_speed.value() / 100.0\n        self.vx = vx * sp\n        self.vy = vy * sp\n        self.wz = wz * sp\n        \n        style = \"color: #00e5ff; font-weight: bold;\"\n        self.lbl_vx.setText(f\"vx=<span style='{style}'>{self.vx:.2f}</span>\")\n        self.lbl_vy.setText(f\"vy=<span style='{style}'>{self.vy:.2f}</span>\")\n        self.lbl_wz.setText(f\"wz=<span style='{style}'>{self.wz:.2f}</span>\")\n        \n        if self.connected:\n            cmd = f\"CHASSIS {self.vx:.2f} {self.vy:.2f} {self.wz:.2f}\"\n            self._send_line_safe(cmd)\n\n    def _send_step(self, sub):\n        self._send_line_safe(f\"STEP {sub}\")\n\n    def _send_servo(self, sname):\n        self._send_line_safe(f\"SERVO {sname}\")\n\n    # --- 修改處：直接發送數值的函式 ---\n    def _send_neo_val(self, val):\n        self._send_line_safe(f\"NEO {val}\")\n    # ------------------------------\n\n    def _send_raw(self):\n        txt = self.input_raw.text().strip()\n        if txt:\n            self._send_line_safe(f\"RAW {txt}\")\n            self.input_raw.clear()\n\n    def _send_status(self):\n        self._send_line_safe(\"STATUS\")\n\n    def _aim_delta(self, axis, delta):\n        if axis == 1:\n            self.m1_angle += delta\n            val = self.m1_angle\n        else:\n            self.m2_angle += delta\n            val = self.m2_angle\n        self._update_aim_labels()\n        self._send_line_safe(f\"AIM {axis} {val:.3f}\")\n\n    def _aim_reset_origin(self, axis):\n        if axis == 1: self.m1_angle = 0.0\n        else: self.m2_angle = 0.0\n        self._update_aim_labels()\n        self._append_log(f\"[INFO] M{axis} Set Origin (UI reset)\")\n\n    def _aim_go_origin(self, axis):\n        if axis == 1: self.m1_angle = 0.0\n        else: self.m2_angle = 0.0\n        self._update_aim_labels()\n        self._send_line_safe(f\"AIM {axis} 0\")\n\n    def _update_aim_labels(self):\n        self.lbl_m1.setText(f\"M1 = {self.m1_angle:.1f}°\")\n        self.lbl_m2.setText(f\"M2 = {self.m2_angle:.1f}°\")\n\n    def _select_file_slot(self, slot):\n        self.current_file_slot = slot\n        fname = f\"preset_{slot}.json\"\n        path = os.path.join(PRESET_DIR, fname)\n        \n        if not os.path.exists(path):\n            self.lbl_file_info.setText(f\"已選: 槽{slot} (空)\")\n            self.lbl_file_info.setStyleSheet(\"color: #ff4444\")\n        else:\n            self.lbl_file_info.setText(f\"已選: 槽{slot} -> {fname}\")\n            self.lbl_file_info.setStyleSheet(\"color: #00e5ff\")\n            \n        self.lbl_param_info.setText(\"未選擇參數\")\n\n    def _param_click(self, idx):\n        if self.current_file_slot is None:\n            QMessageBox.warning(self, \"提示\", \"請先選擇檔案槽\")\n            return\n        \n        fname = f\"preset_{self.current_file_slot}.json\"\n        path = os.path.join(PRESET_DIR, fname)\n        \n        try:\n            with open(path, 'r', encoding='utf-8') as f:\n                data = json.load(f)\n            item = data[idx-1] \n            \n            m1 = m2 = 0\n            if isinstance(item, list) or isinstance(item, tuple):\n                m1, m2 = float(item[0]), float(item[1])\n            elif isinstance(item, dict):\n                m1 = float(item.get(\"m1\", item.get(\"M1\", 0)))\n                m2 = float(item.get(\"m2\", item.get(\"M2\", 0)))\n            \n            self.m1_angle = m1\n            self.m2_angle = m2\n            self._update_aim_labels()\n            self.lbl_param_info.setText(f\"P{idx}: M1={m1:.2f}, M2={m2:.2f}\")\n            self.lbl_param_info.setStyleSheet(\"color: #00e5ff; font-weight: bold;\")\n            \n            self._send_line_safe(f\"AIM 1 {m1:.3f}\")\n            self._send_line_safe(f\"AIM 2 {m2:.3f}\")\n            \n        except Exception as e:\n            self.lbl_param_info.setText(f\"讀取失敗: {e}\")\n            self.lbl_param_info.setStyleSheet(\"color: #ff4444;\")\n\n    def closeEvent(self, event):\n        self.client.close()\n        event.accept()\n\nif __name__ == \"__main__\":\n    app = QApplication(sys.argv)\n    window = MainWindow()\n    window.show()\n    sys.exit(app.exec())"}
{"path": "remote_layout.ui", "extension": ".ui", "size_bytes": 12625, "modified_time": "2025-11-24 21:34:32", "sha256": "ac01662ce7bdae0700b3c2e484066b6700751e39c61263c59f992e0fe420d18c", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<ui version=\"4.0\">\n <class>MainWindow</class>\n <widget class=\"QMainWindow\" name=\"MainWindow\">\n  <property name=\"geometry\">\n   <rect>\n    <x>0</x>\n    <y>0</y>\n    <width>850</width>\n    <height>800</height>\n   </rect>\n  </property>\n  <property name=\"windowTitle\">\n   <string>Laptop Remote Controller (Dark UI)</string>\n  </property>\n  <property name=\"styleSheet\">\n   <string notr=\"true\">\n/* 全域設定 */\nQMainWindow {\n    background-color: #1e1e1e;\n    color: #e0e0e0;\n    font-family: &quot;Segoe UI&quot;, &quot;Microsoft JhengHei&quot;, sans-serif;\n    font-size: 10pt;\n}\n\n/* 群組框 */\nQGroupBox {\n    border: 1px solid #444;\n    border-radius: 6px;\n    margin-top: 24px;\n    padding-top: 10px;\n    background-color: #252526;\n}\nQGroupBox::title {\n    subcontrol-origin: margin;\n    subcontrol-position: top left;\n    left: 10px;\n    padding: 0 5px;\n    color: #00e5ff;\n    font-weight: bold;\n    background-color: #1e1e1e;\n}\n\n/* 標籤 */\nQLabel {\n    color: #cccccc;\n}\n\n/* 輸入框 */\nQLineEdit {\n    background-color: #2d2d30;\n    border: 1px solid #3e3e42;\n    border-radius: 4px;\n    color: #ffffff;\n    padding: 4px;\n    font-family: &quot;Consolas&quot;, monospace;\n}\nQLineEdit:focus {\n    border: 1px solid #007acc;\n}\n\n/* 按鈕 - 通用 */\nQPushButton {\n    background-color: #3e3e42;\n    color: #ffffff;\n    border: 1px solid #555;\n    border-radius: 4px;\n    padding: 6px 12px;\n    min-width: 60px;\n}\nQPushButton:hover {\n    background-color: #505050;\n    border-color: #00e5ff;\n}\nQPushButton:pressed {\n    background-color: #007acc;\n    border-color: #007acc;\n}\n\n/* 特殊按鈕 ID 指定 */\nQPushButton#btn_connect {\n    background-color: #007acc;\n    font-weight: bold;\n}\nQPushButton#btn_connect:hover {\n    background-color: #0098ff;\n}\n\nQPushButton#btn_step_s {\n    background-color: #d32f2f;\n    font-weight: bold;\n}\nQPushButton#btn_step_s:hover {\n    background-color: #f44336;\n}\n\nQPushButton#btn_neo_0, QPushButton#btn_neo_n50, QPushButton#btn_neo_n100, QPushButton#btn_raw, QPushButton#btn_status {\n    background-color: #2d2d30;\n}\n\n/* 滑桿 */\nQSlider::groove:horizontal {\n    border: 1px solid #3e3e42;\n    height: 8px;\n    background: #2d2d30;\n    margin: 2px 0;\n    border-radius: 4px;\n}\nQSlider::handle:horizontal {\n    background: #00e5ff;\n    border: 1px solid #00e5ff;\n    width: 16px;\n    height: 16px;\n    margin: -5px 0;\n    border-radius: 8px;\n}\n\n/* Log 區域 */\nQTextEdit {\n    background-color: #000000;\n    color: #00ff00;\n    font-family: &quot;Consolas&quot;, &quot;Courier New&quot;, monospace;\n    border: 1px solid #333;\n    font-size: 9pt;\n}\n   </string>\n  </property>\n  <widget class=\"QWidget\" name=\"centralwidget\">\n   <layout class=\"QVBoxLayout\" name=\"verticalLayout\">\n    <item>\n     <layout class=\"QHBoxLayout\" name=\"layout_conn\">\n      <item>\n       <widget class=\"QLabel\" name=\"label_ip\">\n        <property name=\"text\">\n         <string>Pi IP:</string>\n        </property>\n       </widget>\n      </item>\n      <item>\n       <widget class=\"QLineEdit\" name=\"input_ip\">\n        <property name=\"text\">\n         <string>10.254.97.208</string>\n        </property>\n       </widget>\n      </item>\n      <item>\n       <widget class=\"QLabel\" name=\"label_port\">\n        <property name=\"text\">\n         <string>Port:</string>\n        </property>\n       </widget>\n      </item>\n      <item>\n       <widget class=\"QLineEdit\" name=\"input_port\">\n        <property name=\"text\">\n         <string>5000</string>\n        </property>\n        <property name=\"maximumWidth\">\n         <number>80</number>\n        </property>\n       </widget>\n      </item>\n      <item>\n       <widget class=\"QPushButton\" name=\"btn_connect\">\n        <property name=\"text\">\n         <string>連線</string>\n        </property>\n       </widget>\n      </item>\n      <item>\n       <widget class=\"QLabel\" name=\"lbl_status\">\n        <property name=\"text\">\n         <string>未連線</string>\n        </property>\n        <property name=\"styleSheet\">\n         <string>color: #888888; font-weight: bold;</string>\n        </property>\n       </widget>\n      </item>\n      <item>\n       <spacer name=\"horizontalSpacer\">\n        <property name=\"orientation\">\n         <enum>Qt::Horizontal</enum>\n        </property>\n        <property name=\"sizeHint\" stdset=\"0\">\n         <size>\n          <width>40</width>\n          <height>20</height>\n         </size>\n        </property>\n       </spacer>\n      </item>\n     </layout>\n    </item>\n\n    <item>\n     <widget class=\"QGroupBox\" name=\"grp_chassis\">\n      <property name=\"title\">\n       <string>底盤控制 (W/A/S/D + Arrows)</string>\n      </property>\n      <layout class=\"QHBoxLayout\" name=\"horizontalLayout_2\">\n       <item>\n        <widget class=\"QLabel\" name=\"label_speed\">\n         <property name=\"text\">\n          <string>速度倍率:</string>\n         </property>\n        </widget>\n       </item>\n       <item>\n        <widget class=\"QSlider\" name=\"slider_speed\">\n         <property name=\"orientation\">\n          <enum>Qt::Horizontal</enum>\n         </property>\n         <property name=\"minimum\">\n          <number>0</number>\n         </property>\n         <property name=\"maximum\">\n          <number>100</number>\n         </property>\n         <property name=\"value\">\n          <number>60</number>\n         </property>\n        </widget>\n       </item>\n       <item>\n        <widget class=\"QLabel\" name=\"lbl_speed_val\">\n         <property name=\"text\">\n          <string>0.60</string>\n         </property>\n         <property name=\"minimumWidth\">\n            <number>40</number>\n         </property>\n        </widget>\n       </item>\n       <item>\n        <widget class=\"Line\" name=\"line\">\n         <property name=\"orientation\">\n          <enum>Qt::Vertical</enum>\n         </property>\n        </widget>\n       </item>\n       <item>\n        <widget class=\"QLabel\" name=\"lbl_vx\">\n         <property name=\"text\">\n          <string>vx=0.00</string>\n         </property>\n        </widget>\n       </item>\n       <item>\n        <widget class=\"QLabel\" name=\"lbl_vy\">\n         <property name=\"text\">\n          <string>vy=0.00</string>\n         </property>\n        </widget>\n       </item>\n       <item>\n        <widget class=\"QLabel\" name=\"lbl_wz\">\n         <property name=\"text\">\n          <string>wz=0.00</string>\n         </property>\n        </widget>\n       </item>\n      </layout>\n     </widget>\n    </item>\n\n    <item>\n     <widget class=\"QGroupBox\" name=\"grp_shooter\">\n      <property name=\"title\">\n       <string>Shooter 控制</string>\n      </property>\n      <layout class=\"QGridLayout\" name=\"gridLayout_shooter\">\n       <item row=\"0\" column=\"0\">\n        <widget class=\"QLabel\" name=\"label_step\"><property name=\"text\"><string>步進 (F/R/X):</string></property></widget>\n       </item>\n       <item row=\"0\" column=\"1\">\n        <widget class=\"QPushButton\" name=\"btn_step_f\"><property name=\"text\"><string>F</string></property></widget>\n       </item>\n       <item row=\"0\" column=\"2\">\n        <widget class=\"QPushButton\" name=\"btn_step_r\"><property name=\"text\"><string>R</string></property></widget>\n       </item>\n       <item row=\"0\" column=\"3\">\n        <widget class=\"QPushButton\" name=\"btn_step_s\"><property name=\"text\"><string>Stop (X)</string></property></widget>\n       </item>\n\n       <item row=\"1\" column=\"0\">\n        <widget class=\"QLabel\" name=\"label_servo\"><property name=\"text\"><string>Servo (1/2/3):</string></property></widget>\n       </item>\n       <item row=\"1\" column=\"1\">\n        <widget class=\"QPushButton\" name=\"btn_servo_1\"><property name=\"text\"><string>S1</string></property></widget>\n       </item>\n       <item row=\"1\" column=\"2\">\n        <widget class=\"QPushButton\" name=\"btn_servo_2\"><property name=\"text\"><string>S2</string></property></widget>\n       </item>\n       <item row=\"1\" column=\"3\">\n        <widget class=\"QPushButton\" name=\"btn_servo_3\"><property name=\"text\"><string>S3</string></property></widget>\n       </item>\n\n       <item row=\"2\" column=\"0\">\n        <widget class=\"QLabel\" name=\"label_neo\"><property name=\"text\"><string>NEO 速度:</string></property></widget>\n       </item>\n       <item row=\"2\" column=\"1\">\n        <widget class=\"QPushButton\" name=\"btn_neo_0\"><property name=\"text\"><string>0 (Stop)</string></property></widget>\n       </item>\n       <item row=\"2\" column=\"2\">\n        <widget class=\"QPushButton\" name=\"btn_neo_n50\"><property name=\"text\"><string>-50</string></property></widget>\n       </item>\n       <item row=\"2\" column=\"3\">\n        <widget class=\"QPushButton\" name=\"btn_neo_n100\"><property name=\"text\"><string>-100</string></property></widget>\n       </item>\n      </layout>\n     </widget>\n    </item>\n\n    <item>\n     <widget class=\"QGroupBox\" name=\"grp_aim\">\n      <property name=\"title\">\n       <string>AIM 手動控制 (L/J -> M1, I/K -> M2)</string>\n      </property>\n      <layout class=\"QGridLayout\" name=\"gridLayout_aim\">\n       <item row=\"0\" column=\"0\"><widget class=\"QLabel\" name=\"lbl_m1\"><property name=\"text\"><string>M1 = 0.0°</string></property></widget></item>\n       <item row=\"0\" column=\"1\"><widget class=\"QPushButton\" name=\"btn_m1_dec\"><property name=\"text\"><string>M1 -</string></property></widget></item>\n       <item row=\"0\" column=\"2\"><widget class=\"QPushButton\" name=\"btn_m1_inc\"><property name=\"text\"><string>M1 +</string></property></widget></item>\n       <item row=\"0\" column=\"3\"><widget class=\"QPushButton\" name=\"btn_m1_set0\"><property name=\"text\"><string>設為原點</string></property></widget></item>\n       <item row=\"0\" column=\"4\"><widget class=\"QPushButton\" name=\"btn_m1_go0\"><property name=\"text\"><string>回原點</string></property></widget></item>\n\n       <item row=\"1\" column=\"0\"><widget class=\"QLabel\" name=\"lbl_m2\"><property name=\"text\"><string>M2 = 0.0°</string></property></widget></item>\n       <item row=\"1\" column=\"1\"><widget class=\"QPushButton\" name=\"btn_m2_dec\"><property name=\"text\"><string>M2 -</string></property></widget></item>\n       <item row=\"1\" column=\"2\"><widget class=\"QPushButton\" name=\"btn_m2_inc\"><property name=\"text\"><string>M2 +</string></property></widget></item>\n       <item row=\"1\" column=\"3\"><widget class=\"QPushButton\" name=\"btn_m2_set0\"><property name=\"text\"><string>設為原點</string></property></widget></item>\n       <item row=\"1\" column=\"4\"><widget class=\"QPushButton\" name=\"btn_m2_go0\"><property name=\"text\"><string>回原點</string></property></widget></item>\n      </layout>\n     </widget>\n    </item>\n\n    <item>\n     <widget class=\"QGroupBox\" name=\"grp_presets\">\n      <property name=\"title\">\n       <string>AIM 預設角度 (9 檔案槽 + 10 參數)</string>\n      </property>\n      <layout class=\"QVBoxLayout\" name=\"layout_presets\">\n        <item>\n            <widget class=\"QLabel\" name=\"lbl_file_info\">\n                <property name=\"text\"><string>未選擇檔案槽</string></property>\n            </widget>\n        </item>\n        <item>\n            <widget class=\"QWidget\" name=\"container_file_btns\" native=\"true\">\n                <layout class=\"QGridLayout\" name=\"grid_files\"/>\n            </widget>\n        </item>\n        <item>\n            <widget class=\"QLabel\" name=\"lbl_param_info\">\n                <property name=\"text\"><string>未選擇參數</string></property>\n                </widget>\n        </item>\n        <item>\n            <widget class=\"QWidget\" name=\"container_param_btns\" native=\"true\">\n                <layout class=\"QGridLayout\" name=\"grid_params\"/>\n            </widget>\n        </item>\n      </layout>\n     </widget>\n    </item>\n\n    <item>\n      <layout class=\"QHBoxLayout\" name=\"layout_raw\">\n        <item><widget class=\"QLineEdit\" name=\"input_raw\"><property name=\"placeholderText\"><string>RAW 指令...</string></property></widget></item>\n        <item><widget class=\"QPushButton\" name=\"btn_raw\"><property name=\"text\"><string>送出 RAW</string></property></widget></item>\n        <item><widget class=\"QPushButton\" name=\"btn_status\"><property name=\"text\"><string>STATUS</string></property></widget></item>\n      </layout>\n    </item>\n\n    <item>\n     <widget class=\"QTextEdit\" name=\"txt_log\">\n      <property name=\"readOnly\">\n       <bool>true</bool>\n      </property>\n     </widget>\n    </item>\n   </layout>\n </widget>\n</widget>\n <resources/>\n <connections/>\n</ui>"}
{"path": "scan_folder.py", "extension": ".py", "size_bytes": 8738, "modified_time": "2025-11-25 19:46:55", "sha256": "bc1436736ba0d6b2e222642e19287fe1c12a17ee1ea45d2ea73d6a90245af202", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "# scan_folder.py\n# -*- coding: utf-8 -*-\nimport os, sys, csv, time, json, base64, hashlib\nfrom collections import defaultdict\n\nDEFAULT_TARGET = r\"C:\\Users\\user\\OneDrive - 中原大學\\桌面\\大學作品集\\東京威力\\TEL2025_MainCode\"\n\n# 略過的資料夾\nSKIP_DIRS = {\n    \".git\",\"__pycache__\",\"node_modules\",\".venv\",\"venv\",\"env\",\n    \"build\",\"dist\",\".idea\",\".vscode\",\".pytest_cache\",\".mypy_cache\",\".cache\"\n}\n\n# 當作文字檔處理（小寫副檔名）\nTEXT_EXTS = {\n    \".py\"\n    #,\".c\",\".cpp\",\".h\",\".hpp\",\".java\",\".js\",\".ts\",\".sh\",\".bat\",\".ps1\",\".ino\",\n    #\".go\",\".rb\",\".php\",\".swift\",\".kt\",\".m\",\".cs\",\".json\",\".yml\",\".yaml\",\".toml\",\n    #\".ini\",\".md\",\".txt\",\".csv\",\".xml\",\".html\",\".css\"\n}\n\n# 內容輸出控制\nMAX_TEXT_BYTES = 512 * 1024      # 單一文字檔最多讀 512 KB 內容\nMAX_BINARY_BYTES = 0             # 二進位檔是否輸出 base64（0=不輸出，只記錄雜湊與中繼資料）\nENCODING = \"utf-8\"               # 文字讀取編碼（失敗則用 errors='replace'）\n\ndef is_probably_binary(path, ext) -> bool:\n    if ext.lower() in TEXT_EXTS:\n        return False\n    try:\n        with open(path, \"rb\") as f:\n            head = f.read(4096)\n        # 有 NUL 或太多非可列印控制字 → 視為二進位\n        if b\"\\x00\" in head:\n            return True\n        nontext = sum(1 for b in head if b < 9 or (13 < b < 32) or b == 127)\n        return nontext / max(1, len(head)) > 0.30\n    except Exception:\n        return True\n\ndef human_size(n: int) -> str:\n    units = [\"B\",\"KB\",\"MB\",\"GB\",\"TB\"]\n    i, f = 0, float(n)\n    while f >= 1024 and i < len(units)-1:\n        f /= 1024; i += 1\n    return f\"{f:.2f} {units[i]}\"\n\ndef sha256_file(path: str) -> str:\n    h = hashlib.sha256()\n    with open(path, \"rb\") as f:\n        for chunk in iter(lambda: f.read(1024 * 1024), b\"\"):\n            h.update(chunk)\n    return h.hexdigest()\n\ndef gen_tree(root: str, skip_dirs=SKIP_DIRS, max_files_per_dir=200) -> str:\n    lines = []\n    root = os.path.abspath(root)\n    for current_root, dirs, files in os.walk(root):\n        rel = os.path.relpath(current_root, root)\n        depth = 0 if rel == \".\" else rel.count(os.sep) + 1\n        indent = \"    \" * depth\n        lines.append((os.path.basename(root) if rel == \".\" else f\"{'    '*(depth-1)}└─ {os.path.basename(current_root)}\"))\n        dirs[:] = [d for d in dirs if d not in skip_dirs]\n        shown = 0\n        for name in sorted(files):\n            if shown >= max_files_per_dir:\n                lines.append(f\"{indent}└─ ... ({len(files)-shown} more files)\")\n                break\n            lines.append(f\"{indent}└─ {name}\")\n            shown += 1\n    return \"\\n\".join(lines)\n\ndef main():\n    target = sys.argv[1] if len(sys.argv) >= 2 else DEFAULT_TARGET\n    target = os.path.abspath(os.path.expanduser(target))\n    if not os.path.isdir(target):\n        print(f\"❌ 找不到資料夾：{target}\")\n        sys.exit(1)\n\n    out_csv  = os.path.join(target, \"files_report.csv\")\n    out_tree = os.path.join(target, \"files_tree.txt\")\n    out_jsonl = os.path.join(target, \"files_content.jsonl\")\n    out_alltxt = os.path.join(target, \"ALL_TEXTS.txt\")\n\n    by_ext_count = defaultdict(int)\n    by_ext_size = defaultdict(int)\n    total_files = total_bytes = 0\n\n    # 先寫 CSV（中繼資料）\n    with open(out_csv, \"w\", newline=\"\", encoding=\"utf-8-sig\") as fcsv, \\\n         open(out_jsonl, \"w\", encoding=\"utf-8\") as fjsonl, \\\n         open(out_alltxt, \"w\", encoding=\"utf-8\", errors=\"replace\") as falltxt:\n\n        writer = csv.writer(fcsv)\n        writer.writerow([\n            \"relative_path\", \"extension\", \"size_bytes\", \"size_human\",\n            \"modified_time\", \"is_text\", \"line_count\", \"sha256\"\n        ])\n\n        for root_dir, dirs, files in os.walk(target):\n            dirs[:] = [d for d in dirs if d not in SKIP_DIRS]\n            for fname in files:\n                fpath = os.path.join(root_dir, fname)\n                rel = os.path.relpath(fpath, target)\n                ext = os.path.splitext(fname)[1].lower()\n\n                try:\n                    stat = os.stat(fpath)\n                except OSError:\n                    continue\n\n                size = stat.st_size\n                mtime = time.strftime(\"%Y-%m-%d %H:%M:%S\", time.localtime(stat.st_mtime))\n                is_bin = is_probably_binary(fpath, ext)\n                sha256 = sha256_file(fpath)\n\n                line_count = \"\"\n                text_preview = \"\"\n                encoding_used = None\n\n                if not is_bin:\n                    # 讀部分文字內容（限制大小）\n                    try:\n                        with open(fpath, \"r\", encoding=ENCODING, errors=\"replace\") as fr:\n                            content = fr.read(min(MAX_TEXT_BYTES, size))\n                            encoding_used = ENCODING\n                            text_preview = content\n                            line_count = content.count(\"\\n\") + (1 if content and not content.endswith(\"\\n\") else 0)\n                    except Exception:\n                        pass\n\n                    # 寫入 ALL_TEXTS 匯總\n                    falltxt.write(\"\\n\" + \"=\"*80 + \"\\n\")\n                    falltxt.write(f\"FILE: {rel}\\n\")\n                    falltxt.write(\"=\"*80 + \"\\n\")\n                    if text_preview:\n                        falltxt.write(text_preview)\n                        if size > MAX_TEXT_BYTES:\n                            falltxt.write(\"\\n[... TRUNCATED ...]\\n\")\n                    else:\n                        falltxt.write(\"[[EMPTY OR UNREADABLE TEXT]]\\n\")\n\n                    # JSONL：文字\n                    json.dump({\n                        \"path\": rel,\n                        \"extension\": ext or \"(noext)\",\n                        \"size_bytes\": size,\n                        \"modified_time\": mtime,\n                        \"sha256\": sha256,\n                        \"is_text\": True,\n                        \"encoding\": encoding_used or \"utf-8\",\n                        \"truncated\": bool(size > MAX_TEXT_BYTES),\n                        \"content\": text_preview\n                    }, fjsonl, ensure_ascii=False)\n                    fjsonl.write(\"\\n\")\n\n                else:\n                    # JSONL：二進位（預設不含內容，只記雜湊與中繼資料；需要可改 MAX_BINARY_BYTES）\n                    b64 = None\n                    if MAX_BINARY_BYTES > 0:\n                        try:\n                            with open(fpath, \"rb\") as fb:\n                                raw = fb.read(min(MAX_BINARY_BYTES, size))\n                            b64 = base64.b64encode(raw).decode(\"ascii\")\n                        except Exception:\n                            b64 = None\n\n                    json.dump({\n                        \"path\": rel,\n                        \"extension\": ext or \"(noext)\",\n                        \"size_bytes\": size,\n                        \"modified_time\": mtime,\n                        \"sha256\": sha256,\n                        \"is_text\": False,\n                        \"base64_bytes\": b64,\n                        \"truncated\": bool(size > MAX_BINARY_BYTES) if MAX_BINARY_BYTES > 0 else None\n                    }, fjsonl)\n                    fjsonl.write(\"\\n\")\n\n                # CSV（中繼資料一覽）\n                writer.writerow([\n                    rel, ext or \"(noext)\", size, human_size(size), mtime,\n                    int(not is_bin), line_count, sha256\n                ])\n\n                by_ext_count[ext] += 1\n                by_ext_size[ext] += size\n                total_files += 1\n                total_bytes += size\n\n    # 產生樹狀\n    with open(out_tree, \"w\", encoding=\"utf-8\") as ftree:\n        ftree.write(gen_tree(target))\n\n    # 摘要\n    print(\"📁 掃描完成：\", target)\n    print(f\"   檔案總數：{total_files}\")\n    print(f\"   總大小  ：{human_size(total_bytes)}\")\n    print(\"   依副檔名統計（前 15 名）：\")\n    top = sorted(by_ext_count.items(), key=lambda kv: by_ext_size[kv[0]], reverse=True)[:15]\n    for ext, cnt in top:\n        print(f\"   {ext or '(noext)':>8}  {cnt:>6} 檔  {human_size(by_ext_size[ext]):>10}\")\n\n    print(f\"\\n✅ 已輸出：\\n  - {out_csv}\\n  - {out_tree}\\n  - {out_jsonl}\\n  - {out_alltxt}\")\n    print(\"\\n⚙️ 參數：MAX_TEXT_BYTES={}, MAX_BINARY_BYTES={}（可在檔頭調整）\".format(MAX_TEXT_BYTES, MAX_BINARY_BYTES))\n    print(\"💡 JSONL 可被 jq / pandas / BigQuery / Elasticsearch 等直接使用；ALL_TEXTS.txt 方便人工檢視。\")\n\nif __name__ == \"__main__\":\n    main()\n"}
{"path": "yolo11n.pt", "extension": ".pt", "size_bytes": 5613764, "modified_time": "2025-11-25 16:12:51", "sha256": "0ebbc80d4a7680d14987a577cd21342b65ecfd94632bd9a8da63ae6417644ee1", "is_text": false, "base64_bytes": null, "truncated": null}
{"path": "yolotest.py", "extension": ".py", "size_bytes": 1755, "modified_time": "2025-11-25 12:14:40", "sha256": "fda04451abbacdd0084f56ec3ccc36d004c70cf0b5843d54a970c47fe57d98b3", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "from ultralytics import YOLO\nimport cv2\nimport os\n\n# 1. 設定 ONNX 模型路徑\n# 這裡直接指向你剛剛轉好的 onnx 檔案\nonnx_path = r\"C:\\Users\\user\\OneDrive - 中原大學\\桌面\\大學作品集\\東京威力\\TEL.v2i\\runs\\detect\\train15\\weights\\best.onnx\"\n\nprint(f\"正在檢查路徑: {onnx_path}\")\nif not os.path.exists(onnx_path):\n    print(\"錯誤：找不到 .onnx 檔案！請確認第一步的轉檔是否成功。\")\n    exit()\n\n# 2. 載入 ONNX 模型\n# task='detect' 是選填的，但明確指定可以避免部分警告\nprint(\"正在載入 ONNX 模型 (這可能需要幾秒鐘)...\")\ntry:\n    model = YOLO(onnx_path, task='detect')\n    print(\"ONNX 模型載入成功！\")\nexcept Exception as e:\n    print(f\"載入失敗: {e}\")\n    print(\"請確認你有安裝 onnxruntime: pip install onnx onnxruntime\")\n    exit()\n\n# 3. 開啟鏡頭\ncap = cv2.VideoCapture(0)\ncap.set(cv2.CAP_PROP_FRAME_WIDTH, 640)\ncap.set(cv2.CAP_PROP_FRAME_HEIGHT, 480)\n\nif not cap.isOpened():\n    print(\"無法開啟攝影機\")\n    exit()\n\nprint(\"=== ONNX 推論測試開始 (按 'q' 離開) ===\")\n\nwhile True:\n    success, frame = cap.read()\n    if not success:\n        break\n\n    # 4. 推論\n    # 使用 ONNX 時，Ultralytics 內部會自動呼叫 onnxruntime\n    results = model.predict(frame, conf=0.4, verbose=False)\n\n    # 5. 繪圖與顯示\n    annotated_frame = results[0].plot()\n    \n    # 加上標示確認我們正在用 ONNX\n    cv2.putText(annotated_frame, \"Mode: ONNX\", (10, 30), \n                cv2.FONT_HERSHEY_SIMPLEX, 1, (0, 255, 0), 2)\n\n    cv2.imshow(\"YOLOv8 ONNX Test\", annotated_frame)\n\n    if cv2.waitKey(1) & 0xFF == ord('q'):\n        break\n\ncap.release()\ncv2.destroyAllWindows()"}
{"path": "aim\\aim.ino", "extension": ".ino", "size_bytes": 5850, "modified_time": "2025-11-25 17:23:06", "sha256": "b7019ab46b4cbb329160d4ab7a0f01d21cb7a830137a1f38095f19b571500c32", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "/*******************************************************\n * Arduino：雙軸步進控制 (修正版)\n * 格式1：1,角度 或 2,角度 (絕對座標定位)\n * 格式2：left,速度 或 right,速度 (M1 連續旋轉，直到 stop 或 +-80度)\n * 指令 stop：停止連續旋轉\n * 輸出：轉動時持續回傳 degree:M1角度,M2角度\n *******************************************************/\n#include <Arduino.h>\n\nstruct StepperAxis {\n  int PUL, DIR, ENA;\n  bool DIR_INVERT;        // true=反向\n  bool ENA_ACTIVE_HIGH;   // true=HIGH為使能\n  double currentAngle;    // 目前角度\n  long stepsPerRev;       // 每圈步數\n  int speed_us;           // 預設速度\n};\n\n// === 腳位 ===\nconst int M1_PUL = 13, M1_DIR = 12, M1_ENA = 11;\nconst int M2_PUL = 10, M2_DIR = 9,  M2_ENA = 8;\n\n// === 參數 ===\nconst long M1_STEPS_PER_REV = 42667L;\nconst long M2_STEPS_PER_REV = 57600L;\nconst float LIMIT_MAX = 80.0;\nconst float LIMIT_MIN = -80.0;\n\nStepperAxis m1 = { M1_PUL, M1_DIR, M1_ENA, false,  true, 0.0, M1_STEPS_PER_REV, 100 };\nStepperAxis m2 = { M2_PUL, M2_DIR, M2_ENA, true,  true, 0.0, M2_STEPS_PER_REV, 100 };\n\nunsigned long lastPrintTime = 0; \n\n// === 函式宣告 (這裡修正了) ===\n// C++ 規則：預設參數只能在宣告時寫一次\nvoid reportStatus(bool force = false); \nstatic inline void holdEnable(const StepperAxis& ax, bool on);\nvoid setupAxis(const StepperAxis& ax);\nvoid stepOnePulse(StepperAxis& ax, int currentSpeedUs);\nvoid runContinuous(StepperAxis& ax, int direction, int speedVal);\nvoid moveToAngle(StepperAxis& ax, float targetAngle);\n\nvoid setup() {\n  Serial.begin(115200);\n  setupAxis(m1);\n  setupAxis(m2);\n  Serial.println(F(\"就緒：\"));\n  Serial.println(F(\"1. 定位模式: 1,角度 或 2,角度\"));\n  Serial.println(F(\"2. 連續模式: left,50 或 right,50 (M1移動)\"));\n  Serial.println(F(\"3. 停止: stop\"));\n}\n\nvoid loop() {\n  if (!Serial.available()) return;\n  String cmd = Serial.readStringUntil('\\n');\n  cmd.trim();\n  if (cmd.length() == 0) return;\n\n  // 1. 處理 stop\n  if (cmd.equalsIgnoreCase(\"stop\")) {\n    Serial.println(F(\"Stopped.\"));\n    return;\n  }\n\n  // 2. 處理 left/right (連續移動模式)\n  if (cmd.startsWith(\"left\") || cmd.startsWith(\"right\")) {\n    int comma = cmd.indexOf(',');\n    int spd = 50; \n    if (comma > 0) {\n      spd = cmd.substring(comma + 1).toInt();\n    }\n    \n    bool goRight = cmd.startsWith(\"right\");\n    int direction = goRight ? 1 : -1;\n    \n    runContinuous(m1, direction, spd);\n    return;\n  }\n\n  // 3. 處理 1,角度 或 2,角度 (絕對定位)\n  int comma = cmd.indexOf(',');\n  if (comma > 0) {\n    int axisId = cmd.substring(0, comma).toInt();\n    float targetAngle = cmd.substring(comma + 1).toFloat();\n\n    if (axisId == 1) {\n      moveToAngle(m1, targetAngle);\n      Serial.println(F(\"M1 OK\"));\n    } else if (axisId == 2) {\n      moveToAngle(m2, targetAngle);\n      Serial.println(F(\"M2 OK\"));\n    }\n  } else {\n    Serial.println(F(\"❌ 格式錯誤\"));\n  }\n}\n\n// === 輔助功能 ===\n\n// 回報角度 (修正：這裡拿掉 = false)\nvoid reportStatus(bool force) {\n  if (force || (millis() - lastPrintTime > 200)) {\n    Serial.print(\"degree:\");\n    Serial.print(m1.currentAngle, 2);\n    Serial.print(\",\");\n    Serial.println(m2.currentAngle, 2);\n    lastPrintTime = millis();\n  }\n}\n\nstatic inline void holdEnable(const StepperAxis& ax, bool on) {\n  digitalWrite(ax.ENA, on ? (ax.ENA_ACTIVE_HIGH ? HIGH : LOW)\n                          : (ax.ENA_ACTIVE_HIGH ? LOW  : HIGH));\n}\n\nvoid setupAxis(const StepperAxis& ax) {\n  pinMode(ax.PUL, OUTPUT);\n  pinMode(ax.DIR, OUTPUT);\n  pinMode(ax.ENA, OUTPUT);\n  holdEnable(ax, true); \n}\n\nvoid stepOnePulse(StepperAxis& ax, int currentSpeedUs) {\n  digitalWrite(ax.PUL, HIGH);\n  delayMicroseconds(currentSpeedUs);\n  digitalWrite(ax.PUL, LOW);\n  delayMicroseconds(currentSpeedUs);\n}\n\n// === 核心運動邏輯 ===\n\n// 模式 A: 連續旋轉\nvoid runContinuous(StepperAxis& ax, int direction, int speedVal) {\n  Serial.println(F(\"Start Continuous Move...\"));\n  \n  bool dirPinState = (direction > 0); \n  if (ax.DIR_INVERT) dirPinState = !dirPinState;\n  digitalWrite(ax.DIR, dirPinState ? HIGH : LOW);\n  \n  holdEnable(ax, true);\n\n  double anglePerStep = 360.0 / (double)ax.stepsPerRev;\n  \n  while (true) {\n    if (Serial.available()) {\n      String stopCmd = Serial.readStringUntil('\\n');\n      stopCmd.trim();\n      if (stopCmd.equalsIgnoreCase(\"stop\")) {\n        Serial.println(F(\"Command Stop received.\"));\n        break;\n      }\n    }\n\n    if (ax.currentAngle >= LIMIT_MAX && direction > 0) {\n      Serial.println(F(\"Limit +80 reached.\"));\n      break;\n    }\n    if (ax.currentAngle <= LIMIT_MIN && direction < 0) {\n      Serial.println(F(\"Limit -80 reached.\"));\n      break;\n    }\n\n    stepOnePulse(ax, speedVal);\n    ax.currentAngle += (direction * anglePerStep);\n\n    reportStatus(); // 這裡使用預設參數\n  }\n}\n\n// 模式 B: 絕對定位\nvoid moveToAngle(StepperAxis& ax, float targetAngle) {\n  float diff = targetAngle - ax.currentAngle;\n  long stepsToMove = (long)(fabs(diff) * ((double)ax.stepsPerRev / 360.0) + 0.5);\n  \n  if (stepsToMove <= 0) { \n    ax.currentAngle = targetAngle; \n    return; \n  }\n\n  bool dirLogical = (diff >= 0);\n  int direction = dirLogical ? 1 : -1;\n\n  if (ax.DIR_INVERT) dirLogical = !dirLogical;\n  digitalWrite(ax.DIR, dirLogical ? HIGH : LOW);\n\n  holdEnable(ax, true);\n\n  double anglePerStep = 360.0 / (double)ax.stepsPerRev;\n\n  for (long i = 0; i < stepsToMove; i++) {\n    stepOnePulse(ax, ax.speed_us);\n    ax.currentAngle += (direction * anglePerStep);\n    \n    if (Serial.available()) {\n       String s = Serial.peek() != -1 ? Serial.readStringUntil('\\n') : \"\";\n       if (s.indexOf(\"stop\") >= 0) {\n         Serial.println(F(\"Interrupted by stop\"));\n         break;\n       }\n    }\n\n    reportStatus();\n  }\n  ax.currentAngle = targetAngle;\n  reportStatus(true);\n}"}
{"path": "chassis_shooter\\chassis_shooter.ino", "extension": ".ino", "size_bytes": 13779, "modified_time": "2025-11-17 13:36:06", "sha256": "df6e464741cb03eadea82e82a8893735941695f2bab69356f1ccd03fb8d8de31", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "// chassis_shooter.ino\n// 單一韌體，板上分流兩種模式以降低負荷：\n//   模式 CHASSIS：只跑麥輪底盤（vx,vy,wz）\n//   模式 SHOOTER：只跑 NEO + 步進（整數 -100..100, F/R/S）\n//\n// 串列指令 (無 TOKEN；相容舊有 <11323310> 前綴會自動剝除) ：\n//   MODE CHASSIS          切換到底盤模式（並關閉發射模組）\n//   MODE SHOOTER          切換到發射模式（並關閉底盤）\n//   STATUS                顯示目前模式與該模式的狀態\n//   STOP                  依模式停當前子系統：CHASSIS 停車；SHOOTER 停步進+NEO=0\n//   vx,vy,wz              僅 CHASSIS 模式有效 (範圍建議 -1..1)\n//   F / R / S             僅 SHOOTER 模式有效（步進 前/反/停(抱死)）\n//   -100..100             僅 SHOOTER 模式有效（NEO 速度）\n//\n// 新增：\n//   S1 / S2 / S3          僅 SHOOTER 模式有效（pin10 Servo 轉到 60 / 90 / 120 度）\n//\n// 降負荷重點：\n//  - 僅在 CHASSIS 模式執行 rampUpdateAndApply() 與底盤 telemetry\n//  - 僅在 SHOOTER 模式執行 serviceStepper()（步進脈衝）與 NEO Servo（attach）\n//  - 切到 CHASSIS 會 detach Servo（釋放計時器中斷），步進 ENA=HIGH（抱死、停脈衝）\n//  - 切到 SHOOTER 會 stopAll() 關閉所有底盤 PWM\n//  - Telemetry 僅輸出當前模式的必要資訊\n\n#include <Arduino.h>\n#include <math.h>\n#include <Servo.h>\n\n// ================== 角度 Servo（pin10，新增） ==================\nServo servoAngle;   // 專門控制 pin10 的 Servo（S1/S2/S3）\n\n// ================== 模式定義 ==================\nenum Mode { MODE_CHASSIS = 0, MODE_SHOOTER = 1 };\nvolatile Mode g_mode = MODE_CHASSIS;\n\n// ================== CHASSIS（麥輪） ==================\n// Pins (MEGA)\nconst uint8_t M1_PWM_A_PIN = 2;  // 前左 index 0\nconst uint8_t M1_PWM_B_PIN = 3;\nconst uint8_t M2_PWM_A_PIN = 4;  // 左後 index 1\nconst uint8_t M2_PWM_B_PIN = 5;\nconst uint8_t M3_PWM_A_PIN = 7;  // 右前 index 2\nconst uint8_t M3_PWM_B_PIN = 6;\nconst uint8_t M4_PWM_A_PIN = 8;  // 右後 index 3\nconst uint8_t M4_PWM_B_PIN = 9;\nconst uint8_t servo = 10;\n\nconst int   MIN_PWM   = 80;\nconst int   MAX_PWM   = 255;\nconst float RAMP_STEP = 6.0;\nconst float DEAD_BAND = 0.02;\nconst float K_OMEGA   = 0.5;\n\nfloat currentPWMvals[4] = {0,0,0,0};\nfloat targetPWMvals[4]  = {0,0,0,0};\nbool  motorActive       = false;\n\n// ================== SHOOTER（NEO + 步進） ==================\nServo sparkMax;\nconst int SPARK_PWM_PIN = 13;     // NEO (Spark MAX) PWM\nbool servoAttached = false;\nint  neoSpeed = 0;                // -100..100（僅作狀態記錄）\n\nconst int PUL = 53;\nconst int DIR = 52;\nconst int ENA = 51;\nconst unsigned int PULSE_US = 25;\n\nenum StepState { STEP_STOP=0, STEP_FWD, STEP_REV };\nvolatile StepState stepState = STEP_STOP;\nunsigned long lastToggleMicros = 0;\nbool pulseLevel = false;\n\n// ================== 共用 ==================\nString serialBuf = \"\";\nunsigned long lastTelemetryMs = 0;\nconst unsigned long TELE_CHASSIS_MS = 200UL;\nconst unsigned long TELE_SHOOTER_MS = 400UL; // 發射端資訊較少，頻率可放慢\nunsigned long lastTeleBudgetMs = 0;\n\nbool equalsIgnoreCase(const String& a, const char* b) {\n  String t=a; t.toUpperCase(); String u=String(b); u.toUpperCase(); return t==u;\n}\n\n// ------------------ CHASSIS 函式 ------------------\nvoid stopAllChassis() {\n  analogWrite(M1_PWM_A_PIN,0); analogWrite(M1_PWM_B_PIN,0);\n  analogWrite(M2_PWM_A_PIN,0); analogWrite(M2_PWM_B_PIN,0);\n  analogWrite(M3_PWM_A_PIN,0); analogWrite(M3_PWM_B_PIN,0);\n  analogWrite(M4_PWM_A_PIN,0); analogWrite(M4_PWM_B_PIN,0);\n  for (int i=0;i<4;i++){ currentPWMvals[i]=0; targetPWMvals[i]=0; }\n  motorActive=false;\n  Serial.println(\"🛑 CHASSIS stop\");\n}\n\nvoid applyMotorDirect(int idx, int pwm_abs, bool forward) {\n  switch(idx){\n    case 0: if(forward){ analogWrite(M1_PWM_A_PIN,pwm_abs); analogWrite(M1_PWM_B_PIN,0);} else { analogWrite(M1_PWM_A_PIN,0); analogWrite(M1_PWM_B_PIN,pwm_abs);} break;\n    case 1: if(forward){ analogWrite(M2_PWM_A_PIN,pwm_abs); analogWrite(M2_PWM_B_PIN,0);} else { analogWrite(M2_PWM_A_PIN,0); analogWrite(M2_PWM_B_PIN,pwm_abs);} break;\n    case 2: if(forward){ analogWrite(M3_PWM_A_PIN,pwm_abs); analogWrite(M3_PWM_B_PIN,0);} else { analogWrite(M3_PWM_A_PIN,0); analogWrite(M3_PWM_B_PIN,pwm_abs);} break;\n    case 3: if(forward){ analogWrite(M4_PWM_A_PIN,pwm_abs); analogWrite(M4_PWM_B_PIN,0);} else { analogWrite(M4_PWM_A_PIN,0); analogWrite(M4_PWM_B_PIN,pwm_abs);} break;\n  }\n}\n\nvoid applyWheelCommand(float w0,float w1,float w2,float w3){\n  float a[4]={w0,w1,w2,w3}; float maxv=0.0001f;\n  // 固定反向（依你的接線）：前左、右前反向\n  a[0]=-a[0]; a[2]=-a[2];\n  for(int i=0;i<4;i++){ if(fabs(a[i])<DEAD_BAND) a[i]=0; if(fabs(a[i])>maxv) maxv=fabs(a[i]); }\n  if(maxv>1.0f) for(int i=0;i<4;i++) a[i]/=maxv;\n  for(int i=0;i<4;i++){\n    float mag=fabs(a[i]);\n    if(mag<DEAD_BAND) targetPWMvals[i]=0;\n    else {\n      float pwm=MIN_PWM+(MAX_PWM-MIN_PWM)*mag;\n      targetPWMvals[i]=(a[i]>=0)?pwm:-pwm;\n    }\n  }\n  motorActive=true;\n}\n\nvoid rampUpdateAndApply(){\n  if (g_mode != MODE_CHASSIS) return; // 非底盤模式，不做任何 PWM 更新\n  for(int i=0;i<4;i++){\n    float cur=currentPWMvals[i], tgt=targetPWMvals[i];\n    if (fabs(tgt-cur)<=RAMP_STEP) cur=tgt; else cur += (tgt>cur)?RAMP_STEP:-RAMP_STEP;\n    currentPWMvals[i]=cur;\n    if (fabs(cur)<1.0){\n      switch(i){\n        case 0: analogWrite(M1_PWM_A_PIN,0); analogWrite(M1_PWM_B_PIN,0); break;\n        case 1: analogWrite(M2_PWM_A_PIN,0); analogWrite(M2_PWM_B_PIN,0); break;\n        case 2: analogWrite(M3_PWM_A_PIN,0); analogWrite(M3_PWM_B_PIN,0); break;\n        case 3: analogWrite(M4_PWM_A_PIN,0); analogWrite(M4_PWM_B_PIN,0); break;\n      }\n    }else{\n      applyMotorDirect(i,(int)fabs(cur),(cur>0));\n    }\n  }\n}\n\nvoid mecanum_from_cmd(float vx,float vy,float wz,float out[4]){\n  // 機體朝向補償：等效順時針 +90° → (vx_r,vy_r)=(-vy, vx)\n  float vx_r=-vy, vy_r=vx;\n  float wFL=vx_r - vy_r - K_OMEGA*wz;\n  float wFR=vx_r + vy_r + K_OMEGA*wz;\n  float wRL=vx_r + vy_r - K_OMEGA*wz;\n  float wRR=vx_r - vy_r + K_OMEGA*wz;\n  float m=max(max(fabs(wFL),fabs(wFR)),max(fabs(wRL),fabs(wRR)));\n  if(m>1.0f){ wFL/=m; wFR/=m; wRL/=m; wRR/=m; }\n  out[0]=wFL; out[1]=wFR; out[2]=wRL; out[3]=wRR;\n}\n\n// ------------------ SHOOTER 函式 ------------------\nvoid ensureServo(bool wantAttach){\n  if (wantAttach && !servoAttached){\n    sparkMax.attach(SPARK_PWM_PIN);\n    servoAttached = true;\n  } else if (!wantAttach && servoAttached){\n    sparkMax.detach();\n    servoAttached = false;\n  }\n}\n\nvoid setSparkSpeed(int speed){\n  neoSpeed = speed;\n  if (!servoAttached) return; // 非 SHOOTER 模式時不送脈衝\n  int us = map(speed, -100, 100, 1000, 2000);\n  sparkMax.writeMicroseconds(us);\n  Serial.print(\"NEO=\"); Serial.print(speed);\n  Serial.print(\" pwm(us)=\"); Serial.println(us);\n}\n\nvoid startForward(){ digitalWrite(DIR,HIGH); stepState=STEP_FWD; Serial.println(\"STEP=F\"); }\nvoid startReverse(){ digitalWrite(DIR,LOW);  stepState=STEP_REV; Serial.println(\"STEP=R\"); }\nvoid stopStepper(){ stepState=STEP_STOP; pulseLevel=false; digitalWrite(PUL,LOW); digitalWrite(ENA,HIGH); Serial.println(\"STEP=S (hold)\"); }\n\nvoid serviceStepper(){\n  if (g_mode != MODE_SHOOTER) return;           // 非發射模式，不產生脈衝\n  if (stepState == STEP_STOP) return;           // 停止狀態不占用 CPU\n  unsigned long now=micros();\n  if ((unsigned long)(now - lastToggleMicros) >= PULSE_US){\n    pulseLevel=!pulseLevel;\n    digitalWrite(PUL, pulseLevel?HIGH:LOW);\n    lastToggleMicros=now;\n  }\n}\n\n// ------------------ Telemetry ------------------\nvoid tele_chassis(){\n  Serial.print(\"TELE-CH: cur[\");\n  for(int i=0;i<4;i++){ if(i) Serial.print(\",\"); Serial.print(currentPWMvals[i],1); }\n  Serial.print(\"] tgt[\");\n  for(int i=0;i<4;i++){ if(i) Serial.print(\",\"); Serial.print(targetPWMvals[i],1); }\n  Serial.println(\"]\");\n}\nvoid tele_shooter(){\n  Serial.print(\"TELE-SH: NEO=\"); Serial.print(neoSpeed);\n  Serial.print(\" STEP=\");\n  Serial.println(stepState==STEP_STOP?\"STOP\":(stepState==STEP_FWD?\"FWD\":\"REV\"));\n}\n\n// ------------------ 模式切換 ------------------\nvoid enterChassisMode(){\n  // 關閉發射子系統\n  stopStepper();                 // ENA=HIGH 抱死\n  ensureServo(false);            // detach Servo，釋放計時器中斷\n  setSparkSpeed(0);              // 更新邏輯值，實際輸出因已 detach 不會送\n  // 底盤安全歸零\n  stopAllChassis();\n  g_mode = MODE_CHASSIS;\n  lastTelemetryMs = millis();\n  Serial.println(\">> MODE=CHASSIS\");\n}\n\nvoid enterShooterMode(){\n  // 關閉底盤輸出\n  stopAllChassis();\n  // 啟動發射子系統\n  ensureServo(true);             // attach Servo\n  digitalWrite(ENA,HIGH);        // 上電預設抱死\n  g_mode = MODE_SHOOTER;\n  lastTelemetryMs = millis();\n  Serial.println(\">> MODE=SHOOTER\");\n}\n\n// ------------------ 狀態印出 ------------------\nvoid print_status(){\n  Serial.println(\"=== STATUS ===\");\n  Serial.print(\"MODE: \"); Serial.println(g_mode==MODE_CHASSIS?\"CHASSIS\":\"SHOOTER\");\n  if (g_mode==MODE_CHASSIS){\n    Serial.print(\"motorActive: \"); Serial.println(motorActive?\"YES\":\"NO\");\n    for (int i=0;i<4;i++){\n      Serial.print(\"cur[\");Serial.print(i);Serial.print(\"]=\");Serial.print(currentPWMvals[i],1);\n      Serial.print(\" tgt[\");Serial.print(i);Serial.print(\"]=\");Serial.println(targetPWMvals[i],1);\n    }\n  } else {\n    Serial.print(\"NEO speed: \"); Serial.println(neoSpeed);\n    Serial.print(\"STEP state: \"); Serial.println(stepState==STEP_STOP?\"STOP\":(stepState==STEP_FWD?\"FWD\":\"REV\"));\n  }\n  Serial.println(\"=============\");\n}\n\n// ------------------ 指令處理 ------------------\nvoid process_cmd_vel(String &msg){\n  // 僅 CHASSIS 模式有效\n  if (g_mode != MODE_CHASSIS) { Serial.println(\"IGNORED: vx,vy,wz (MODE!=CHASSIS)\"); return; }\n  char buf[128]; msg.toCharArray(buf,sizeof(buf));\n  char *p=strtok(buf,\",\"); float vx=0,vy=0,wz=0;\n  if(p) vx=atof(p);\n  p=strtok(NULL,\",\"); if(p) vy=atof(p);\n  p=strtok(NULL,\",\"); if(p) wz=atof(p);\n  float out[4]; mecanum_from_cmd(vx,vy,wz,out); applyWheelCommand(out[0],out[1],out[2],out[3]);\n}\n\nvoid handle_line(String line){\n  line.trim();\n  if (!line.length()) return;\n\n  // 相容舊 TOKEN：若前綴 <11323310>，剝掉\n  const String LEGACY = \"<11323310>\";\n  if (line.startsWith(LEGACY)) { line = line.substring(LEGACY.length()); line.trim(); }\n\n  // 模式切換\n  if (line.equalsIgnoreCase(\"MODE CHASSIS\")) { enterChassisMode(); return; }\n  if (line.equalsIgnoreCase(\"MODE SHOOTER\")) { enterShooterMode(); return; }\n\n  // 通用\n  if (line.equalsIgnoreCase(\"STATUS\")) { print_status(); return; }\n  if (line.equalsIgnoreCase(\"STOP\")) {\n    if (g_mode==MODE_CHASSIS) stopAllChassis();\n    else { stopStepper(); setSparkSpeed(0); if (servoAttached) sparkMax.writeMicroseconds(1500); }\n    Serial.println(\"🛑 STOP (current mode)\");\n    return;\n  }\n\n  // 依模式解譯\n  if (g_mode==MODE_CHASSIS){\n    // 只處理 vx,vy,wz\n    if (line.indexOf(',')>=0) { process_cmd_vel(line); return; }\n    Serial.println(\"IGNORED (CHASSIS): not vx,vy,wz\");\n    return;\n  } else {\n    // SHOOTER：F/R/S / S1/S2/S3 / 整數\n    if (equalsIgnoreCase(line,\"F\")) { startForward(); return; }\n    if (equalsIgnoreCase(line,\"R\")) { startReverse(); return; }\n    if (equalsIgnoreCase(line,\"S\")) { stopStepper();  return; }\n\n    // ★ 新增：S1 / S2 / S3 控制 pin10 的 Servo 角度\n    if (equalsIgnoreCase(line,\"S1\")) { servoAngle.write(60);  Serial.println(\"SERVO=60\");  return; }\n    if (equalsIgnoreCase(line,\"S2\")) { servoAngle.write(90);  Serial.println(\"SERVO=90\");  return; }\n    if (equalsIgnoreCase(line,\"S3\")) { servoAngle.write(120); Serial.println(\"SERVO=120\"); return; }\n\n    // 其餘視為 NEO 速度\n    long spd = line.toInt();\n    if (spd>100) spd=100; if (spd<-100) spd=-100;\n    setSparkSpeed((int)spd);\n    return;\n  }\n}\n\n// ================== setup / loop ==================\nvoid setup(){\n  Serial.begin(115200);\n  delay(200);\n  Serial.println(\"\\n=== MEGA Multiplex (CHASSIS / SHOOTER) NoToken ===\");\n\n  // 底盤腳位\n  pinMode(M1_PWM_A_PIN, OUTPUT); pinMode(M1_PWM_B_PIN, OUTPUT);\n  pinMode(M2_PWM_A_PIN, OUTPUT); pinMode(M2_PWM_B_PIN, OUTPUT);\n  pinMode(M3_PWM_A_PIN, OUTPUT); pinMode(M3_PWM_B_PIN, OUTPUT);\n  pinMode(M4_PWM_A_PIN, OUTPUT); pinMode(M4_PWM_B_PIN, OUTPUT);\n  pinMode(servo, OUTPUT);\n\n  // 步進腳位\n  pinMode(PUL,OUTPUT); pinMode(DIR,OUTPUT); pinMode(ENA,OUTPUT);\n  digitalWrite(PUL,LOW); digitalWrite(ENA,HIGH); // 先抱死\n\n  // 初始進 CHASSIS，並確保發射子系統關閉\n  ensureServo(false);\n  enterChassisMode();\n\n  // ★ 新增：pin10 Servo 初始化\n  servoAngle.attach(servo);   // 或直接寫 10\n  servoAngle.write(90);       // 預設 90 度\n\n  Serial.println(\"用法：MODE CHASSIS / MODE SHOOTER / STATUS / STOP / vx,vy,wz / F/R/S / S1/S2/S3 / -100..100\");\n}\n\nvoid loop(){\n  // 只跑當前模式的服務\n  if (g_mode==MODE_CHASSIS){\n    // 無需處理步進；NEO Servo 已 detach\n  } else {\n    // 發射模式：處理步進脈衝\n    serviceStepper();\n  }\n\n  // 收指令（\\n 為一行）\n  while (Serial.available()){\n    char c=(char)Serial.read(); if (c=='\\r') continue;\n    if (c=='\\n'){ String line=serialBuf; serialBuf=\"\"; handle_line(line); }\n    else {\n      serialBuf += c;\n      if (serialBuf.length()>200) serialBuf=serialBuf.substring(serialBuf.length()-200);\n    }\n  }\n\n  // 僅在 CHASSIS 模式更新 PWM\n  if (g_mode==MODE_CHASSIS) rampUpdateAndApply();\n\n  // Telemetry（各模式各自頻率）\n  unsigned long now = millis();\n  if (g_mode==MODE_CHASSIS){\n    if (now - lastTelemetryMs >= TELE_CHASSIS_MS){ lastTelemetryMs = now; tele_chassis(); }\n  } else {\n    if (now - lastTelemetryMs >= TELE_SHOOTER_MS){ lastTelemetryMs = now; tele_shooter(); }\n  }\n}\n"}
{"path": "presets\\preset_1.json", "extension": ".json", "size_bytes": 126, "modified_time": "2025-11-25 10:08:00", "sha256": "dacca3709ba17ff95cc37c009e834d15b1011c7ce47bf49c221c04d6d0cd7891", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "[\n  [20, 20],\n  [-20, 30],\n  [35, 10],\n  [-35, 35],\n  [15, 8],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0]\n]\n"}
{"path": "presets\\preset_2.json", "extension": ".json", "size_bytes": 115, "modified_time": "2025-11-17 18:17:56", "sha256": "06dc24e99aee682b0da11406aa25448516a55659000c67a8c099eb39e223e277", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "[\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0]\n]\n"}
{"path": "presets\\preset_3.json", "extension": ".json", "size_bytes": 115, "modified_time": "2025-11-17 18:17:50", "sha256": "06dc24e99aee682b0da11406aa25448516a55659000c67a8c099eb39e223e277", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "[\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0]\n]\n"}
{"path": "presets\\preset_4.json", "extension": ".json", "size_bytes": 115, "modified_time": "2025-11-17 18:17:51", "sha256": "06dc24e99aee682b0da11406aa25448516a55659000c67a8c099eb39e223e277", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "[\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0]\n]\n"}
{"path": "presets\\preset_5.json", "extension": ".json", "size_bytes": 115, "modified_time": "2025-11-17 18:17:53", "sha256": "06dc24e99aee682b0da11406aa25448516a55659000c67a8c099eb39e223e277", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "[\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0]\n]\n"}
{"path": "presets\\preset_6.json", "extension": ".json", "size_bytes": 115, "modified_time": "2025-11-17 18:17:51", "sha256": "06dc24e99aee682b0da11406aa25448516a55659000c67a8c099eb39e223e277", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "[\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0]\n]\n"}
{"path": "presets\\preset_7.json", "extension": ".json", "size_bytes": 115, "modified_time": "2025-11-17 18:17:52", "sha256": "06dc24e99aee682b0da11406aa25448516a55659000c67a8c099eb39e223e277", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "[\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0]\n]\n"}
{"path": "presets\\preset_8.json", "extension": ".json", "size_bytes": 115, "modified_time": "2025-11-17 18:17:53", "sha256": "06dc24e99aee682b0da11406aa25448516a55659000c67a8c099eb39e223e277", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "[\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0]\n]\n"}
{"path": "presets\\preset_9.json", "extension": ".json", "size_bytes": 115, "modified_time": "2025-11-17 18:17:49", "sha256": "06dc24e99aee682b0da11406aa25448516a55659000c67a8c099eb39e223e277", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "[\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0],\n  [0, 0]\n]\n"}
{"path": "runs\\detect\\tel_nano\\args.yaml", "extension": ".yaml", "size_bytes": 1693, "modified_time": "2025-11-25 16:12:51", "sha256": "98458dc3c240d6128e8ae9c0aaac6dad755c28f35c495e19de12a5e723c0cf79", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "task: detect\nmode: train\nmodel: yolo11n.pt\ndata: C:\\Users\\user\\OneDrive - 中原大學\\桌面\\大學作品集\\東京威力\\TEL.v2i\\data.yaml\nepochs: 100\ntime: null\npatience: 100\nbatch: 16\nimgsz: 640\nsave: true\nsave_period: -1\ncache: false\ndevice: '0'\nworkers: 8\nproject: null\nname: tel_nano\nexist_ok: false\npretrained: true\noptimizer: auto\nverbose: true\nseed: 0\ndeterministic: true\nsingle_cls: false\nrect: false\ncos_lr: false\nclose_mosaic: 10\nresume: false\namp: true\nfraction: 1.0\nprofile: false\nfreeze: null\nmulti_scale: false\noverlap_mask: true\nmask_ratio: 4\ndropout: 0.0\nval: true\nsplit: val\nsave_json: false\nconf: null\niou: 0.7\nmax_det: 300\nhalf: false\ndnn: false\nplots: true\nsource: null\nvid_stride: 1\nstream_buffer: false\nvisualize: false\naugment: false\nagnostic_nms: false\nclasses: null\nretina_masks: false\nembed: null\nshow: false\nsave_frames: false\nsave_txt: false\nsave_conf: false\nsave_crop: false\nshow_labels: true\nshow_conf: true\nshow_boxes: true\nline_width: null\nformat: torchscript\nkeras: false\noptimize: false\nint8: false\ndynamic: false\nsimplify: true\nopset: null\nworkspace: null\nnms: false\nlr0: 0.01\nlrf: 0.01\nmomentum: 0.937\nweight_decay: 0.0005\nwarmup_epochs: 3.0\nwarmup_momentum: 0.8\nwarmup_bias_lr: 0.1\nbox: 7.5\ncls: 0.5\ndfl: 1.5\npose: 12.0\nkobj: 1.0\nnbs: 64\nhsv_h: 0.015\nhsv_s: 0.7\nhsv_v: 0.4\ndegrees: 0.0\ntranslate: 0.1\nscale: 0.5\nshear: 0.0\nperspective: 0.0\nflipud: 0.0\nfliplr: 0.5\nbgr: 0.0\nmosaic: 1.0\nmixup: 0.0\ncutmix: 0.0\ncopy_paste: 0.0\ncopy_paste_mode: flip\nauto_augment: randaugment\nerasing: 0.4\ncfg: null\ntracker: botsort.yaml\nsave_dir: runs\\detect\\tel_nano\n"}
{"path": "沒用的檔案\\aim.py", "extension": ".py", "size_bytes": 9061, "modified_time": "2025-10-18 22:36:45", "sha256": "dfe791ba217d14a7ebf53a59566136f0660d5f2cd9e4fe1838a8d21e0cff3a26", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "# -*- coding: utf-8 -*-\n\"\"\"\naim.py\n- Aimer（保持不動）\n- 追加 AimWindow（PyQt5 GUI），預設 BAUD=115200、預選 COM18\n  * 套用：各送一行 '1,<x>'、'2,<y>'\n  * 新增「Arduino 輸出」視窗區塊：持續讀取序列埠並顯示回傳訊息\n\"\"\"\nfrom __future__ import annotations\nfrom typing import Optional, Tuple, TYPE_CHECKING\nimport time\n\ntry:\n    import serial as pyserial\nexcept Exception:\n    pyserial = None  # type: ignore\n\nif TYPE_CHECKING:\n    from serial import Serial as SerialT\nelse:\n    class SerialT: pass\n\ndef _clamp(x, a, b): return a if x < a else b if x > b else x\n\n\nclass Aimer:\n    def __init__(self, port=\"COM18\", baud=115200, send_interval_ms=80, verbose=True,\n                 x_min_deg=-30.0, x_max_deg=+30.0, y_min_deg=+10.0, y_max_deg=+80.0,\n                 x_sens_deg_s=60.0, y_sens_deg_s=60.0):\n        self.port, self.baud, self.verbose = port, baud, verbose\n        self._ser: Optional[SerialT] = None\n        self._interval = send_interval_ms / 1000.0\n        self._last_send = 0.0\n        self._x_rng = (float(x_min_deg), float(x_max_deg))\n        self._y_rng = (float(y_min_deg), float(y_max_deg))\n        self._x = (x_min_deg + x_max_deg) / 2.0\n        self._y = (y_min_deg + y_max_deg) / 2.0\n        self._last_xy: Tuple[float, float] = (9999, 9999)\n        self._sx = float(x_sens_deg_s)\n        self._sy = float(y_sens_deg_s)\n        self._connect()\n\n    def _connect(self):\n        if pyserial is None:\n            if self.verbose: print(\"[AIM] pyserial 未安裝，dryrun\")\n            return\n        try:\n            self._ser = pyserial.Serial(self.port, self.baud, timeout=0.02)\n            if self.verbose: print(f\"[AIM] OPEN {self.port} @ {self.baud}\")\n            time.sleep(1.2)\n        except Exception as e:\n            self._ser = None\n            if self.verbose: print(f\"[AIM] 開啟失敗：{e}（dryrun）\")\n\n    def _send_line(self, s: str):\n        if not s.endswith(\"\\n\"): s += \"\\n\"\n        if self._ser:\n            try: self._ser.write(s.encode(\"utf-8\"))\n            except Exception as e:\n                if self.verbose: print(f\"[AIM] 寫入失敗：{e}\")\n        else:\n            if self.verbose: print(f\"[AIM] (drysend) {s.strip()}\")\n\n    def nudge_from_stick(self, rx: float, ry: float, dt: float):\n        if dt <= 0: return\n        dx = float(rx) * self._sx * dt\n        dy = float(-ry) * self._sy * dt\n        self._x = _clamp(self._x + dx, *self._x_rng)\n        self._y = _clamp(self._y + dy, *self._y_rng)\n        self._maybe_send()\n\n    def _maybe_send(self):\n        now = time.time()\n        if now - self._last_send < self._interval: return\n        cur = (round(self._x, 3), round(self._y, 3))\n        if cur == self._last_xy: return\n        self._last_send = now; self._last_xy = cur\n        self._send_line(f\"1,{cur[0]:.3f}\")\n        self._send_line(f\"2,{cur[1]:.3f}\")\n\n    def home_center(self):\n        self._x = sum(self._x_rng) * 0.5\n        self._y = sum(self._y_rng) * 0.5\n        self._maybe_send()\n\n    def set_xy_deg(self, x_deg: float, y_deg: float):\n        self._x = _clamp(float(x_deg), *self._x_rng)\n        self._y = _clamp(float(y_deg), *self._y_rng)\n        self._maybe_send()\n\n    def close(self):\n        if self._ser:\n            try: self._ser.close()\n            finally: self._ser = None\n            if self.verbose: print(\"[AIM] CLOSED\")\n\n\n# =======================\n# 追加：AimWindow（含 Arduino 輸出顯示）\n# =======================\ntry:\n    from PyQt5.QtCore import QTimer\n    from PyQt5.QtWidgets import QWidget, QVBoxLayout, QHBoxLayout, QLabel, QSpinBox, QPushButton, QGroupBox, QComboBox, QTextEdit\n    import serial\n    import serial.tools.list_ports as list_ports\n\n    class AimWindow(QWidget):\n        BAUD = 115200\n        DEFAULT_PORT = \"COM18\"\n\n        def __init__(self, parent=None):\n            super().__init__(parent)\n            self.setWindowTitle(\"Aim 視窗（未連線）\")\n            self.resize(520, 320)\n\n            # 連線列\n            self.port_combo = QComboBox(); self._refresh_ports(); self._preselect_port(self.DEFAULT_PORT)\n            btn_refresh = QPushButton(\"刷新\"); btn_refresh.clicked.connect(self._refresh_ports)\n            self.btn_conn = QPushButton(\"連線\"); self.btn_disc = QPushButton(\"斷線\")\n            self.btn_conn.clicked.connect(self._connect); self.btn_disc.clicked.connect(self._disconnect)\n            self.btn_disc.setEnabled(False)\n            top = QHBoxLayout(); top.addWidget(QLabel(\"COM：\")); top.addWidget(self.port_combo, 1)\n            top.addWidget(btn_refresh); top.addWidget(self.btn_conn); top.addWidget(self.btn_disc)\n\n            # 角度\n            self.x_spin = QSpinBox(); self.x_spin.setRange(-180, 180); self.x_spin.setSingleStep(1)\n            self.y_spin = QSpinBox(); self.y_spin.setRange(-180, 180); self.y_spin.setSingleStep(1)\n            grp = QGroupBox(\"角度 (°)\")\n            gl = QHBoxLayout(grp); gl.addWidget(QLabel(\"X：\")); gl.addWidget(self.x_spin); gl.addSpacing(12)\n            gl.addWidget(QLabel(\"Y：\")); gl.addWidget(self.y_spin); gl.addStretch(1)\n\n            self.btn_apply = QPushButton(\"套用\"); self.btn_zero = QPushButton(\"歸零\")\n            self.btn_apply.clicked.connect(self.on_apply); self.btn_zero.clicked.connect(self.on_zero)\n            row = QHBoxLayout(); row.addWidget(self.btn_apply); row.addWidget(self.btn_zero); row.addStretch(1)\n\n            # 底部：Arduino 輸出\n            out_grp = QGroupBox(\"Arduino 輸出\")\n            vg = QVBoxLayout(out_grp)\n            self.out_view = QTextEdit(); self.out_view.setReadOnly(True)\n            vg.addWidget(self.out_view)\n\n            root = QVBoxLayout(self); root.addLayout(top); root.addWidget(grp); root.addLayout(row); root.addWidget(out_grp, 1)\n\n            self._ser = None; self._cur_port = \"\"; self._rxbuf = b\"\"\n            self._rx_timer = QTimer(self); self._rx_timer.timeout.connect(self._poll_rx); self._rx_timer.start(50)\n\n        # connect\n        def _refresh_ports(self):\n            self.port_combo.clear()\n            try:\n                for p in list_ports.comports():\n                    self.port_combo.addItem(p.device)\n            except Exception:\n                pass\n\n        def _preselect_port(self, name: str):\n            idx = self.port_combo.findText(name)\n            if idx >= 0: self.port_combo.setCurrentIndex(idx)\n\n        def _connect(self):\n            if self._ser: return\n            port = self.port_combo.currentText().strip()\n            if not port: return\n            try:\n                self._ser = serial.Serial(port=port, baudrate=self.BAUD, timeout=0.0)  # 非阻塞\n                self._cur_port = port\n                self.btn_conn.setEnabled(False); self.btn_disc.setEnabled(True)\n                self._log(f\"[Connected] {port} @ {self.BAUD}\")\n                self.setWindowTitle(f\"Aim 視窗（{port}）\")\n            except Exception as e:\n                self._log(f\"[連線失敗] {e}\")\n\n        def _disconnect(self):\n            if self._ser:\n                try: self._ser.close()\n                except Exception: pass\n            self._ser = None; self._cur_port = \"\"; self._rxbuf = b\"\"\n            self.btn_conn.setEnabled(True); self.btn_disc.setEnabled(False)\n            self._log(\"[Disconnected]\")\n            self.setWindowTitle(\"Aim 視窗（未連線）\")\n\n        # io\n        def _write_line(self, s: str):\n            if not self._ser: self._log(\"尚未連線 Arduino\"); return\n            try:\n                self._ser.write((s+\"\\n\").encode(\"utf-8\")); self._log(f\">> {s}\")\n            except Exception as e:\n                self._log(f\"[TX 失敗] {e}\")\n\n        def _poll_rx(self):\n            if not self._ser: return\n            try:\n                n = self._ser.in_waiting\n                if n:\n                    data = self._ser.read(n)\n                    self._rxbuf += data\n                    while b\"\\n\" in self._rxbuf:\n                        line, self._rxbuf = self._rxbuf.split(b\"\\n\", 1)\n                        text = line.decode(\"utf-8\", \"ignore\").rstrip(\"\\r\")\n                        self._log(text)\n            except Exception:\n                pass\n\n        def _log(self, s: str):\n            self.out_view.append(s)\n\n        # actions\n        def on_apply(self):\n            x = int(self.x_spin.value()); y = int(self.y_spin.value())\n            self._write_line(f\"1,{x}\"); self._write_line(f\"2,{y}\")\n            if self._cur_port:\n                self.setWindowTitle(f\"Aim 視窗（{self._cur_port}）  X={x}  Y={y}\")\n\n        def on_zero(self):\n            self.x_spin.setValue(0); self.y_spin.setValue(0); self.on_apply()\n\n        def closeEvent(self, e):\n            try:\n                if self._ser: self._ser.close()\n            except Exception: pass\n            super().closeEvent(e)\nexcept Exception:\n    pass\n"}
{"path": "沒用的檔案\\main.py", "extension": ".py", "size_bytes": 817, "modified_time": "2025-10-18 22:36:58", "sha256": "4bba552fada5382f8bc649c6af191e97f79f0d4a5a690b85adeeb247f7d022da", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "# -*- coding: utf-8 -*-\nimport sys\nfrom PyQt5.QtWidgets import QApplication\n\nfrom mega1_controller import ControllerWindow\nfrom aim import AimWindow\nfrom xboxGUI import XboxWindow\nfrom system_status_gui import SystemStatusWindow\n\ndef main():\n    app = QApplication(sys.argv)\n\n    syswin = SystemStatusWindow()\n    ctrl   = ControllerWindow()\n    aim    = AimWindow()\n    xbox   = XboxWindow()\n\n    # 把 Controller 的狀態與訊息同步到 SystemStatus\n    try:\n        ctrl.arduino_conn_changed.connect(syswin.update_arduino_status)\n        ctrl.message.connect(syswin.append_log)\n    except Exception:\n        pass\n\n    # 一次顯示所有視窗\n    syswin.show()\n    ctrl.show()\n    aim.show()\n    xbox.show()\n\n    sys.exit(app.exec_())\n\nif __name__ == \"__main__\":\n    main()\n"}
{"path": "沒用的檔案\\mega1_controller.py", "extension": ".py", "size_bytes": 10243, "modified_time": "2025-10-18 22:36:28", "sha256": "a652178666c6c5ddae097218caa38d47d6ddff25a2cec1dc398b7d8c9bc1cb46", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "# -*- coding: utf-8 -*-\n\"\"\"\nmega1_controller.py\n- MegaController（維持不動）\n- 追加 ControllerWindow（PyQt5 GUI）\n  * 預設 BAUD=115200、預選 COM19\n  * 送指令：數字（NEO），F/R/S（步進；S=後退）\n  * 新增「Arduino 輸出」視窗區塊：持續讀取序列埠並顯示回傳訊息\n\"\"\"\nfrom __future__ import annotations\nimport threading, time\nfrom typing import Optional, TYPE_CHECKING\n\ntry:\n    import serial as pyserial\nexcept Exception:\n    pyserial = None  # type: ignore\n\nif TYPE_CHECKING:\n    from serial import Serial as SerialT\nelse:\n    class SerialT: pass\n\n\nclass MegaController:\n    MODE_CHASSIS = \"CHASSIS\"\n    MODE_SHOOTER = \"SHOOTER\"\n\n    def __init__(self, port=\"COM19\", baud=115200, send_interval_s=0.08, verbose=True):\n        self.port, self.baud, self.verbose = port, baud, verbose\n        self._ser: Optional[SerialT] = None\n        self._vx = 0.0; self._vy = 0.0; self._wz = 0.0\n        self._interval = max(0.01, float(send_interval_s))\n        self._mode = self.MODE_CHASSIS\n        self._stop = threading.Event()\n        self._lock = threading.Lock()\n        self._connect()\n        self._start_tx_loop()\n\n    def _connect(self):\n        if pyserial is None:\n            if self.verbose: print(\"[Mega] pyserial 未安裝，dryrun\")\n            return\n        try:\n            self._ser = pyserial.Serial(self.port, self.baud, timeout=0.0, write_timeout=0.0)\n            if self.verbose: print(f\"[Mega] OPEN {self.port} @ {self.baud}\")\n            time.sleep(1.5)\n            self._send_line(f\"MODE {self._mode}\")\n        except Exception as e:\n            self._ser = None\n            if self.verbose: print(f\"[Mega] 開啟失敗：{e}（dryrun）\")\n\n    def _close(self):\n        if self._ser:\n            try: self._ser.close()\n            finally: self._ser = None\n            if self.verbose: print(\"[Mega] CLOSED\")\n\n    def _send_line(self, s: str):\n        if not s.endswith(\"\\n\"): s += \"\\n\"\n        if self._ser:\n            try: self._ser.write(s.encode(\"ascii\"))\n            except Exception as e:\n                if self.verbose: print(f\"[Mega] 寫入失敗：{e}\")\n        else:\n            if self.verbose: print(f\"[Mega] (drysend) {s.strip()}\")\n\n    def _start_tx_loop(self):\n        def loop():\n            next_t = 0.0\n            while not self._stop.is_set():\n                now = time.monotonic()\n                if now >= next_t:\n                    with self._lock:\n                        mode, vx, vy, wz = self._mode, self._vx, self._vy, self._wz\n                    if mode == self.MODE_CHASSIS:\n                        self._send_line(f\"{vx:.2f},{vy:.2f},{wz:.2f}\")\n                    next_t = now + self._interval\n                time.sleep(0.002)\n        threading.Thread(target=loop, daemon=True).start()\n\n    # ---- 公開 API ----\n    def move_forward(self, percent: int):\n        p = max(-100, min(100, int(percent)))\n        with self._lock: self._vx = p / 100.0\n        if abs(p) > 0: self.set_mode(self.MODE_CHASSIS)\n\n    def move_XY(self, percent: int):\n        p = max(-100, min(100, int(percent)))\n        with self._lock: self._vy = p / 100.0\n        if abs(p) > 0: self.set_mode(self.MODE_CHASSIS)\n    move_xy = move_XY\n\n    def rotate(self, percent: int):\n        p = max(-100, min(100, int(percent)))\n        with self._lock: self._wz = p / 100.0\n        if abs(p) > 0: self.set_mode(self.MODE_CHASSIS)\n\n    # 射手端\n    def feed(self):    self.set_mode(self.MODE_SHOOTER); self._send_line(\"R\")\n    def reverse(self): self.set_mode(self.MODE_SHOOTER); self._send_line(\"F\")\n    def set_neo(self, speed: int):\n        v = int(max(-100, min(100, speed)))\n        self.set_mode(self.MODE_SHOOTER); self._send_line(str(v))\n\n    def set_mode(self, mode: str):\n        if mode not in (self.MODE_CHASSIS, self.MODE_SHOOTER): return\n        with self._lock:\n            if mode == self._mode: return\n            self._mode = mode\n        self._send_line(f\"MODE {mode}\")\n        time.sleep(0.2)\n\n    def close(self):\n        self._stop.set(); time.sleep(0.05); self._close()\n\n\n# ============================\n# 追加：Controller 視窗 GUI（含 Arduino 輸出顯示）\n# ============================\ntry:\n    from PyQt5.QtCore import QTimer, pyqtSignal\n    from PyQt5.QtWidgets import QWidget, QVBoxLayout, QHBoxLayout, QLabel, QPushButton, QComboBox, QLineEdit, QGroupBox, QTextEdit\n    import serial\n    import serial.tools.list_ports as list_ports\n\n    class ControllerWindow(QWidget):\n        \"\"\"\n        Arduino 控制視窗\n        - 預設 BAUD=115200、預選 COM19\n        - 指令：數字（NEO）、F/R/S（步進；S=後退）\n        - 下方文字框顯示 Arduino 回傳（非阻塞輪詢）\n        \"\"\"\n        BAUD = 115200\n        DEFAULT_PORT = \"COM19\"\n\n        arduino_conn_changed = pyqtSignal(bool, str)\n        message = pyqtSignal(str)\n\n        def __init__(self, parent=None):\n            super().__init__(parent)\n            self.setWindowTitle(\"Arduino 控制\")\n            self.resize(520, 360)\n\n            # 連線列\n            self.port_combo = QComboBox(); self._refresh_ports(); self._preselect_port(self.DEFAULT_PORT)\n            btn_refresh = QPushButton(\"刷新\"); btn_refresh.clicked.connect(self._refresh_ports)\n            self.btn_conn = QPushButton(\"連線\"); self.btn_disc = QPushButton(\"斷線\")\n            self.btn_conn.clicked.connect(self._connect); self.btn_disc.clicked.connect(self._disconnect)\n            self.btn_disc.setEnabled(False)\n\n            top = QHBoxLayout()\n            top.addWidget(QLabel(\"COM：\")); top.addWidget(self.port_combo, 1)\n            top.addWidget(btn_refresh); top.addWidget(self.btn_conn); top.addWidget(self.btn_disc)\n\n            # 指令列\n            self.inp = QLineEdit(); self.inp.setPlaceholderText(\"輸入數字→Enter 直接送給 Arduino（NEO）\")\n            self.inp.returnPressed.connect(self._send_text)\n            bF = QPushButton(\"F\"); bR = QPushButton(\"R\"); bS = QPushButton(\"S\")\n            bF.clicked.connect(lambda: self._send_literal(\"F\"))\n            bR.clicked.connect(lambda: self._send_literal(\"R\"))\n            bS.clicked.connect(lambda: self._send_literal(\"S\"))\n            grp = QGroupBox(\"指令\")\n            g = QVBoxLayout(grp)\n            g.addWidget(self.inp)\n            row = QHBoxLayout(); row.addWidget(bF); row.addWidget(bR); row.addWidget(bS)\n            g.addLayout(row)\n\n            # 底部：Arduino 輸出\n            out_grp = QGroupBox(\"Arduino 輸出\")\n            vg = QVBoxLayout(out_grp)\n            self.out_view = QTextEdit(); self.out_view.setReadOnly(True)\n            vg.addWidget(self.out_view)\n\n            root = QVBoxLayout(self)\n            root.addLayout(top)\n            root.addWidget(grp)\n            root.addWidget(out_grp, 1)\n\n            self._ser = None; self._cur_port = \"\"; self._rxbuf = b\"\"\n\n            # 非阻塞輪詢 RX\n            self._rx_timer = QTimer(self); self._rx_timer.timeout.connect(self._poll_rx); self._rx_timer.start(50)\n\n        # --- 連線 ---\n        def _refresh_ports(self):\n            self.port_combo.clear()\n            try:\n                for p in list_ports.comports():\n                    self.port_combo.addItem(p.device)\n            except Exception:\n                pass\n\n        def _preselect_port(self, name: str):\n            idx = self.port_combo.findText(name)\n            if idx >= 0: self.port_combo.setCurrentIndex(idx)\n\n        def _connect(self):\n            if self._ser: return\n            port = self.port_combo.currentText().strip()\n            if not port: return\n            try:\n                self._ser = serial.Serial(port=port, baudrate=self.BAUD, timeout=0.0)  # 非阻塞\n                self._cur_port = port\n                self.btn_conn.setEnabled(False); self.btn_disc.setEnabled(True)\n                self.arduino_conn_changed.emit(True, port)\n                self._log(f\"[Connected] {port} @ {self.BAUD}\")\n                self.setWindowTitle(f\"Arduino 控制（{port}）\")\n            except Exception as e:\n                self._log(f\"[連線失敗] {e}\")\n\n        def _disconnect(self):\n            if self._ser:\n                try: self._ser.close()\n                except Exception: pass\n            port = self._cur_port\n            self._ser = None; self._cur_port = \"\"; self._rxbuf = b\"\"\n            self.btn_conn.setEnabled(True); self.btn_disc.setEnabled(False)\n            self.arduino_conn_changed.emit(False, port)\n            self._log(f\"[Disconnected] {('from '+port) if port else ''}\")\n            self.setWindowTitle(\"Arduino 控制（未連線）\")\n\n        # --- TX/RX ---\n        def _write_line(self, s: str):\n            if not self._ser:\n                self._log(\"尚未連線 Arduino\"); return\n            try:\n                self._ser.write((s+\"\\n\").encode(\"utf-8\"))\n                self._log(f\">> {s}\")\n            except Exception as e:\n                self._log(f\"[TX 失敗] {e}\")\n\n        def _send_text(self):\n            s = self.inp.text().strip()\n            if not s: return\n            self._write_line(s); self.inp.clear()\n\n        def _send_literal(self, token: str):\n            self._write_line(token)\n\n        def _poll_rx(self):\n            if not self._ser: return\n            try:\n                n = self._ser.in_waiting\n                if n:\n                    data = self._ser.read(n)\n                    self._rxbuf += data\n                    while b\"\\n\" in self._rxbuf:\n                        line, self._rxbuf = self._rxbuf.split(b\"\\n\", 1)\n                        text = line.decode(\"utf-8\", \"ignore\").rstrip(\"\\r\")\n                        self._log(text)\n            except Exception:\n                pass\n\n        def _log(self, s: str):\n            self.out_view.append(s)\n            self.message.emit(s)\n\n        def closeEvent(self, e):\n            try:\n                if self._ser: self._ser.close()\n            except Exception: pass\n            super().closeEvent(e)\nexcept Exception:\n    pass\n"}
{"path": "沒用的檔案\\system_status_gui.py", "extension": ".py", "size_bytes": 3156, "modified_time": "2025-10-18 22:31:50", "sha256": "3384f83f9336718851729132f906703ee852b8c19006353f839fe2de0af52f71", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "# -*- coding: utf-8 -*-\nfrom PyQt5.QtCore import QTimer, pyqtSlot\nfrom PyQt5.QtWidgets import QWidget, QVBoxLayout, QHBoxLayout, QLabel, QListWidget, QGroupBox, QTextEdit\n\ntry:\n    import psutil\nexcept Exception:\n    psutil = None\ntry:\n    import serial.tools.list_ports as list_ports\nexcept Exception:\n    list_ports = None\n\n\nclass SystemStatusWindow(QWidget):\n    def __init__(self, parent=None):\n        super().__init__(parent)\n        self.setWindowTitle(\"System Status / Arduino 狀態\")\n        self.resize(520, 440)\n\n        self.cpu_label = QLabel(\"CPU：- %\")\n        self.mem_label = QLabel(\"RAM：- %\")\n        self.ard_label = QLabel(\"Arduino：未連線\")\n        self.ard_label.setStyleSheet(\"color:#dc2626; font-weight:bold;\")\n\n        # 系統\n        sys_box = QGroupBox(\"系統資源\")\n        v = QVBoxLayout(sys_box); v.addWidget(self.cpu_label); v.addWidget(self.mem_label)\n\n        # COM\n        com_box = QGroupBox(\"可用序列埠 (COM)\")\n        v2 = QVBoxLayout(com_box); self.com_list = QListWidget(); v2.addWidget(self.com_list)\n\n        # Arduino\n        ard_box = QGroupBox(\"Arduino 狀態\")\n        v3 = QVBoxLayout(ard_box); v3.addWidget(self.ard_label)\n\n        # Log\n        log_box = QGroupBox(\"系統訊息\")\n        v4 = QVBoxLayout(log_box); self.log = QTextEdit(); self.log.setReadOnly(True); v4.addWidget(self.log)\n\n        root = QVBoxLayout(self)\n        top = QHBoxLayout()\n        left = QVBoxLayout(); left.addWidget(sys_box); left.addWidget(ard_box)\n        top.addLayout(left, 1); top.addWidget(com_box, 1)\n        root.addLayout(top, 2); root.addWidget(log_box, 1)\n\n        self.t_sys = QTimer(self); self.t_sys.timeout.connect(self._refresh_system); self.t_sys.start(1000)\n        self.t_com = QTimer(self); self.t_com.timeout.connect(self._refresh_coms);  self.t_com.start(2000)\n        self._refresh_system(); self._refresh_coms()\n\n    def append_log(self, s: str): self.log.append(s)\n\n    @pyqtSlot(bool, str)\n    def update_arduino_status(self, connected: bool, port: str):\n        if connected:\n            self.ard_label.setText(f\"Arduino：已連線（{port}）\")\n            self.ard_label.setStyleSheet(\"color:#16a34a; font-weight:bold;\")\n            self.append_log(f\"[Arduino] Connected on {port}\")\n        else:\n            self.ard_label.setText(\"Arduino：未連線\")\n            self.ard_label.setStyleSheet(\"color:#dc2626; font-weight:bold;\")\n            self.append_log(f\"[Arduino] Disconnected{(' from '+port) if port else ''}\")\n\n    def _refresh_system(self):\n        if not psutil:\n            self.cpu_label.setText(\"CPU：psutil 未安裝\"); self.mem_label.setText(\"RAM：psutil 未安裝\"); return\n        self.cpu_label.setText(f\"CPU：{psutil.cpu_percent():.1f} %\")\n        self.mem_label.setText(f\"RAM：{psutil.virtual_memory().percent:.1f} %\")\n\n    def _refresh_coms(self):\n        self.com_list.clear()\n        if not list_ports:\n            self.com_list.addItem(\"pyserial 未安裝\"); return\n        for p in list_ports.comports():\n            self.com_list.addItem(f\"{p.device} | {p.description}\")\n"}
{"path": "沒用的檔案\\xboxGUI.py", "extension": ".py", "size_bytes": 4504, "modified_time": "2025-10-18 22:43:36", "sha256": "a4ae3964892791e82cce5409096af38d8b9d17510a6208b0013953b12f8e33dd", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "# === 追加：可相容 Qt6 .ui 的 Xbox 視窗（載入失敗時不影響原本 run()） ===\nimport os, io, re\ntry:\n    from PyQt5 import uic\n    from PyQt5.QtCore import QTimer, pyqtSignal\n    from PyQt5.QtWidgets import QWidget\n    import pygame as _pg\n\n    def _fix_qt6_enums(ui_text: str) -> str:\n        rep = {\n            \"Qt::Orientation::Horizontal\": \"Qt::Horizontal\",\n            \"Qt::Orientation::Vertical\": \"Qt::Vertical\",\n            \"Qt::AlignmentFlag::AlignLeft\": \"Qt::AlignLeft\",\n            \"Qt::AlignmentFlag::AlignRight\": \"Qt::AlignRight\",\n            \"Qt::AlignmentFlag::AlignHCenter\": \"Qt::AlignHCenter\",\n            \"Qt::AlignmentFlag::AlignVCenter\": \"Qt::AlignVCenter\",\n            \"Qt::AlignmentFlag::AlignCenter\": \"Qt::AlignCenter\",\n            \"Qt::CheckState::Unchecked\": \"Qt::Unchecked\",\n            \"Qt::CheckState::PartiallyChecked\": \"Qt::PartiallyChecked\",\n            \"Qt::CheckState::Checked\": \"Qt::Checked\",\n        }\n        for k, v in rep.items():\n            ui_text = ui_text.replace(k, v)\n        ui_text = re.sub(r'(Qt|QSizePolicy|QFrame|QAbstractItemView|QTabWidget|QToolButton|QDialogButtonBox)::[A-Za-z_]+::',\n                         r'\\1::', ui_text)\n        return ui_text\n\n    class XboxWindow(QWidget):\n        axisChanged = pyqtSignal(float, float, float, float, float, float)\n        buttonsChanged = pyqtSignal(bool, bool, bool, bool, bool, bool)\n\n        def __init__(self, parent=None, deadzone=0.15):\n            super().__init__(parent)\n            self._dz = float(deadzone)\n            self._status_lbl = None\n\n            # 優先載入 XboxGUI_V2.ui；若失敗→顯示簡易空殼視窗（不影響功能）\n            try:\n                ui_path = os.path.join(os.path.dirname(__file__), \"XboxGUI_V2.ui\")\n                with open(ui_path, \"r\", encoding=\"utf-8\") as f:\n                    patched = _fix_qt6_enums(f.read())\n                uic.loadUi(io.StringIO(patched), self)\n                for name in (\"labelStatus\",\"statusLabel\",\"infoLabel\",\"lblStatus\"):\n                    w = getattr(self, name, None)\n                    if w is not None:\n                        self._status_lbl = w\n                        break\n            except Exception as e:\n                from PyQt5.QtWidgets import QVBoxLayout, QLabel\n                self.setWindowTitle(\"Xbox 視窗\")\n                lay = QVBoxLayout(self)\n                self._status_lbl = QLabel(f\"(未載入 .ui：{e})\", self)\n                lay.addWidget(self._status_lbl)\n\n            self.setWindowTitle(\"Xbox 視窗\")\n            _pg.init(); _pg.joystick.init()\n            self._js = None\n            if _pg.joystick.get_count() > 0:\n                self._js = _pg.joystick.Joystick(0); self._js.init()\n                self._set_status(\"已偵測到搖桿 0 號\")\n            else:\n                self._set_status(\"找不到搖桿（請插上手把）\")\n\n            self._timer = QTimer(self)\n            self._timer.timeout.connect(self._tick)\n            self._timer.start(100)\n\n        def _set_status(self, text: str):\n            if self._status_lbl is not None: self._status_lbl.setText(text)\n            else: self.setWindowTitle(f\"Xbox 視窗 - {text}\")\n\n        def _dead(self, x): \n            x=float(x); return 0.0 if abs(x) < 0.15 else x\n\n        def _tick(self):\n            for _ in _pg.event.get(): pass\n            if not self._js:\n                self._set_status(\"找不到搖桿\"); return\n\n            lx = self._dead(self._js.get_axis(0))\n            ly = self._dead(self._js.get_axis(1))\n            rx = self._dead(self._js.get_axis(2))\n            ry = self._dead(self._js.get_axis(3))\n            lt = float(self._js.get_axis(4))\n            rt = float(self._js.get_axis(5))\n\n            a = bool(self._js.get_button(0)); b = bool(self._js.get_button(1))\n            x = bool(self._js.get_button(2)); y = bool(self._js.get_button(3))\n            lb = bool(self._js.get_button(4)); rb = bool(self._js.get_button(5))\n\n            self.axisChanged.emit(lx, ly, rx, ry, lt, rt)\n            self.buttonsChanged.emit(a, b, x, y, lb, rb)\n            self._set_status(f\"L({lx:+.2f},{ly:+.2f}) R({rx:+.2f},{ry:+.2f}) LT:{lt:+.2f} RT:{rt:+.2f} \"\n                             f\"A{int(a)} B{int(b)} X{int(x)} Y{int(y)} LB{int(lb)} RB{int(rb)}\")\nexcept Exception:\n    # 沒有 PyQt5 時，只保留原本的 pygame 版本 run()，完全不受影響\n    pass\n"}
{"path": "沒用的檔案\\XboxGUI_V1.ui", "extension": ".ui", "size_bytes": 7033, "modified_time": "2025-10-17 16:28:46", "sha256": "c9d4ce43947f17b3b79866116d178e127666698723d5b705dc37e2cb72d1b32d", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<ui version=\"4.0\">\n <class>Form</class>\n <widget class=\"QWidget\" name=\"Form\">\n  <property name=\"geometry\">\n   <rect>\n    <x>0</x>\n    <y>0</y>\n    <width>999</width>\n    <height>575</height>\n   </rect>\n  </property>\n  <property name=\"windowTitle\">\n   <string>Form</string>\n  </property>\n  <widget class=\"QSlider\" name=\"Move_X\">\n   <property name=\"geometry\">\n    <rect>\n     <x>80</x>\n     <y>420</y>\n     <width>160</width>\n     <height>22</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Horizontal</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Move_Y\">\n   <property name=\"geometry\">\n    <rect>\n     <x>150</x>\n     <y>350</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Left_rotation\">\n   <property name=\"geometry\">\n    <rect>\n     <x>150</x>\n     <y>70</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Right_rotation\">\n   <property name=\"geometry\">\n    <rect>\n     <x>440</x>\n     <y>70</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton\">\n   <property name=\"geometry\">\n    <rect>\n     <x>110</x>\n     <y>240</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Aim_X lock</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_2\">\n   <property name=\"geometry\">\n    <rect>\n     <x>410</x>\n     <y>240</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Aim_Y lock</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label\">\n   <property name=\"geometry\">\n    <rect>\n     <x>120</x>\n     <y>50</y>\n     <width>71</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Left rotation</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_2\">\n   <property name=\"geometry\">\n    <rect>\n     <x>410</x>\n     <y>50</y>\n     <width>81</width>\n     <height>20</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Right rotation</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_3\">\n   <property name=\"geometry\">\n    <rect>\n     <x>130</x>\n     <y>520</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Move_Y</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_4\">\n   <property name=\"geometry\">\n    <rect>\n     <x>20</x>\n     <y>420</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Move_X</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_5\">\n   <property name=\"geometry\">\n    <rect>\n     <x>420</x>\n     <y>520</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Aim_Y</string>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Aim_X\">\n   <property name=\"geometry\">\n    <rect>\n     <x>370</x>\n     <y>420</y>\n     <width>160</width>\n     <height>22</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Horizontal</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Aim_Y\">\n   <property name=\"geometry\">\n    <rect>\n     <x>440</x>\n     <y>350</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_6\">\n   <property name=\"geometry\">\n    <rect>\n     <x>310</x>\n     <y>420</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>Aim_X</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_3\">\n   <property name=\"geometry\">\n    <rect>\n     <x>610</x>\n     <y>160</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"mouseTracking\">\n    <bool>false</bool>\n   </property>\n   <property name=\"text\">\n    <string>低轉速</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_4\">\n   <property name=\"geometry\">\n    <rect>\n     <x>840</x>\n     <y>160</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>高轉速</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_5\">\n   <property name=\"geometry\">\n    <rect>\n     <x>730</x>\n     <y>250</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>吐料</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_6\">\n   <property name=\"geometry\">\n    <rect>\n     <x>730</x>\n     <y>70</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"text\">\n    <string>進料</string>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Left_rotation_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>200</x>\n     <y>50</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Right_rotation_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>490</x>\n     <y>50</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Move_X_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>10</x>\n     <y>440</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Move_Y_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>190</x>\n     <y>520</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Aim_X_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>300</x>\n     <y>440</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Aim_Y_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>470</x>\n     <y>520</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n </widget>\n <resources/>\n <connections/>\n</ui>\n"}
{"path": "沒用的檔案\\XboxGUI_V2.ui", "extension": ".ui", "size_bytes": 13635, "modified_time": "2025-10-18 21:16:59", "sha256": "3e2d91a3c8aecf783b4fe3519a28cfc964e3b0a222768d1cc86531b80e5e4ef0", "is_text": true, "encoding": "utf-8", "truncated": false, "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<ui version=\"4.0\">\n <class>Form</class>\n <widget class=\"QWidget\" name=\"Form\">\n  <property name=\"geometry\">\n   <rect>\n    <x>0</x>\n    <y>0</y>\n    <width>953</width>\n    <height>560</height>\n   </rect>\n  </property>\n  <property name=\"windowTitle\">\n   <string>Xbox Controller GUI</string>\n  </property>\n  <property name=\"styleSheet\">\n   <string>/* ===== 主背景 ===== */\nQWidget {\n    background: qlineargradient(x1:0, y1:0, x2:1, y2:1, stop:0 #212d7aff, stop:0.5 #000001, stop:1 #000000);\n}\n\n/* ===== 水平滑桿 ===== */\nQSlider::groove:horizontal {\n    border: 1px solid #ffffffff;\n    height: 10px;\n    background: #0a0a0a;\n    border-radius: 5px;\n}\nQSlider::handle:horizontal {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #16d946, stop:1 #0aa62c);\n    border: 2px solid #ffffffff;\n    width: 18px;\n    margin: -5px 0;\n    border-radius: 9px;\n}\nQSlider::handle:horizontal:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #2dc759, stop:1 #16d946);\n    border: 2px solid #16d946;\n}\n\n/* ===== 垂直滑桿 ===== */\nQSlider::groove:vertical {\n    border: 1px solid #ffffffff;\n    width: 10px;\n    background: #0a0a0a;\n    border-radius: 5px;\n}\nQSlider::handle:vertical {\n    background: qlineargradient(x1:0, y1:0, x2:1, y2:0, stop:0 #16d946, stop:1 #0aa62c);\n    border: 2px solid #ffffffff;\n    height: 18px;\n    margin: 0 -5px;\n    border-radius: 9px;\n}\nQSlider::handle:vertical:hover {\n    background: qlineargradient(x1:0, y1:0, x2:1, y2:0, stop:0 #2dc759, stop:1 #16d946);\n    border: 2px solid #16d946;\n}\n\n/* ===== 標籤 ===== */\nQLabel {\n    color: #16d946;\n    font-weight: bold;\n    font-size: 11px;\n}\n\n/* ===== LCD 數字顯示 ===== */\nQLCDNumber {\n    background: #0a0a0a;\n    color: #16d946;\n    border: 2px solid #ffffffff;\n    border-radius: 4px;\n    font-weight: bold;\n}</string>\n  </property>\n  <widget class=\"QSlider\" name=\"Move_X\">\n   <property name=\"geometry\">\n    <rect>\n     <x>80</x>\n     <y>420</y>\n     <width>160</width>\n     <height>22</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Orientation::Horizontal</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Move_Y\">\n   <property name=\"geometry\">\n    <rect>\n     <x>150</x>\n     <y>350</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Orientation::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Left_rotation\">\n   <property name=\"geometry\">\n    <rect>\n     <x>150</x>\n     <y>70</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Orientation::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Right_rotation\">\n   <property name=\"geometry\">\n    <rect>\n     <x>440</x>\n     <y>70</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Orientation::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton\">\n   <property name=\"geometry\">\n    <rect>\n     <x>100</x>\n     <y>240</y>\n     <width>131</width>\n     <height>41</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>12</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"styleSheet\">\n    <string>/* Aim_X lock - 紅色系 */\nQPushButton {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #f69797ff, stop:1 #e81828);\n    border: 2px solid #ff4444;\n    color: #ffffff;\n    border-radius: 6px;\n    font-weight: bold;\n}\nQPushButton:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #ff7777, stop:1 #f69797ff);\n    border: 2px solid #ffaaaa;\n}\nQPushButton:pressed {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #c40c0c, stop:1 #a00808);\n    border: 2px solid #ff0000;\n}</string>\n   </property>\n   <property name=\"text\">\n    <string>Aim_X lock</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_2\">\n   <property name=\"geometry\">\n    <rect>\n     <x>380</x>\n     <y>240</y>\n     <width>141</width>\n     <height>41</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>12</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"styleSheet\">\n    <string>/* Aim_Y lock - 紅色系 */\nQPushButton {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #f69797ff, stop:1 #e81828);\n    border: 2px solid #ff4444;\n    color: #ffffff;\n    border-radius: 6px;\n    font-weight: bold;\n}\nQPushButton:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #ff7777, stop:1 #f69797ff);\n    border: 2px solid #ffaaaa;\n}\nQPushButton:pressed {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #c40c0c, stop:1 #a00808);\n    border: 2px solid #ff0000;\n}</string>\n   </property>\n   <property name=\"text\">\n    <string>Aim_Y lock</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label\">\n   <property name=\"geometry\">\n    <rect>\n     <x>120</x>\n     <y>50</y>\n     <width>71</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>-1</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"text\">\n    <string>Left rotation</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_2\">\n   <property name=\"geometry\">\n    <rect>\n     <x>410</x>\n     <y>50</y>\n     <width>81</width>\n     <height>20</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>-1</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"text\">\n    <string>Right rotation</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_3\">\n   <property name=\"geometry\">\n    <rect>\n     <x>130</x>\n     <y>520</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>-1</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"text\">\n    <string>Move_Y</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_4\">\n   <property name=\"geometry\">\n    <rect>\n     <x>20</x>\n     <y>420</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>-1</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"text\">\n    <string>Move_X</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_5\">\n   <property name=\"geometry\">\n    <rect>\n     <x>420</x>\n     <y>520</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>-1</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"text\">\n    <string>Aim_Y</string>\n   </property>\n  </widget>\n  <widget class=\"QLabel\" name=\"label_6\">\n   <property name=\"geometry\">\n    <rect>\n     <x>310</x>\n     <y>420</y>\n     <width>51</width>\n     <height>16</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>Coburn</family>\n     <pointsize>-1</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"text\">\n    <string>Aim_X</string>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Aim_X\">\n   <property name=\"geometry\">\n    <rect>\n     <x>370</x>\n     <y>420</y>\n     <width>160</width>\n     <height>22</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Orientation::Horizontal</enum>\n   </property>\n  </widget>\n  <widget class=\"QSlider\" name=\"Aim_Y\">\n   <property name=\"geometry\">\n    <rect>\n     <x>440</x>\n     <y>350</y>\n     <width>22</width>\n     <height>160</height>\n    </rect>\n   </property>\n   <property name=\"orientation\">\n    <enum>Qt::Orientation::Vertical</enum>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_3\">\n   <property name=\"geometry\">\n    <rect>\n     <x>610</x>\n     <y>160</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>標楷體</family>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"mouseTracking\">\n    <bool>true</bool>\n   </property>\n   <property name=\"styleSheet\">\n    <string>/* 低轉速 - 綠色系（補給類） */\nQPushButton {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #22dd55, stop:1 #16d946);\n    border: 2px solid #16d946;\n    color: #ffffff;\n    border-radius: 6px;\n    font-weight: bold;\n}\nQPushButton:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #2dc759, stop:1 #22dd55);\n    border: 2px solid #2dc759;\n}\nQPushButton:pressed {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #0d5a0d, stop:1 #0a450a);\n    border: 2px solid #ffffffff;\n}</string>\n   </property>\n   <property name=\"text\">\n    <string>低轉速</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_4\">\n   <property name=\"geometry\">\n    <rect>\n     <x>840</x>\n     <y>160</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>標楷體</family>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"styleSheet\">\n    <string>/* 高轉速 - 黃色系（動力類） */\nQPushButton {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #ffee22, stop:1 #ffc400);\n    border: 2px solid #ffff00;\n    color: #000000;\n    border-radius: 6px;\n    font-weight: bold;\n}\nQPushButton:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #ffff44, stop:1 #ffee22);\n    border: 2px solid #ffff88;\n}\nQPushButton:pressed {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #ff9d00, stop:1 #ff8800);\n    border: 2px solid #ff6600;\n}</string>\n   </property>\n   <property name=\"text\">\n    <string>高轉速</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_5\">\n   <property name=\"geometry\">\n    <rect>\n     <x>730</x>\n     <y>250</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>標楷體</family>\n     <pointsize>10</pointsize>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"styleSheet\">\n    <string>/* 退彈 - 藍色系（發射類） */\nQPushButton {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #0088ff, stop:1 #0066cc);\n    border: 2px solid #0066cc;\n    color: #ffffff;\n    border-radius: 6px;\n    font-weight: bold;\n}\nQPushButton:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #33aaff, stop:1 #0088ff);\n    border: 2px solid #33aaff;\n}\nQPushButton:pressed {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #000aa6, stop:1 #000578);\n    border: 2px solid #0033ff;\n}</string>\n   </property>\n   <property name=\"text\">\n    <string>退彈</string>\n   </property>\n  </widget>\n  <widget class=\"QPushButton\" name=\"pushButton_6\">\n   <property name=\"geometry\">\n    <rect>\n     <x>730</x>\n     <y>70</y>\n     <width>93</width>\n     <height>28</height>\n    </rect>\n   </property>\n   <property name=\"font\">\n    <font>\n     <family>標楷體</family>\n     <bold>true</bold>\n    </font>\n   </property>\n   <property name=\"styleSheet\">\n    <string>/* 進彈 - 藍綠色系（提示不同功能） */\nQPushButton {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #00dd99, stop:1 #00b388);\n    border: 2px solid #00cc88;\n    color: #ffffff;\n    border-radius: 6px;\n    font-weight: bold;\n}\nQPushButton:hover {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #00ffaa, stop:1 #00dd99);\n    border: 2px solid #00ffaa;\n}\nQPushButton:pressed {\n    background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #008866, stop:1 #005544);\n    border: 2px solid #009977;\n}</string>\n   </property>\n   <property name=\"text\">\n    <string>進彈</string>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Left_rotation_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>200</x>\n     <y>50</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Right_rotation_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>490</x>\n     <y>50</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Move_X_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>10</x>\n     <y>440</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Move_Y_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>190</x>\n     <y>520</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Aim_X_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>300</x>\n     <y>440</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n  <widget class=\"QLCDNumber\" name=\"Aim_Y_val\">\n   <property name=\"geometry\">\n    <rect>\n     <x>470</x>\n     <y>520</y>\n     <width>64</width>\n     <height>23</height>\n    </rect>\n   </property>\n  </widget>\n </widget>\n <resources/>\n <connections/>\n</ui>\n"}
